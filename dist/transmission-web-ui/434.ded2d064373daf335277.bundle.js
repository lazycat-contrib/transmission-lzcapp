"use strict";(self.webpackChunktrguing=self.webpackChunktrguing||[]).push([[434,457],{4462:(e,t,n)=>{n.d(t,{Z:()=>o});var r,a=n(7294);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}const o=function(e){return a.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 6.3 6.3"},e),r||(r=a.createElement("g",{strokeWidth:.3,fontFamily:"sans-serif",fontWeight:400},a.createElement("text",{x:2.6,y:5.3,fontSize:5.8},"A"),a.createElement("text",{x:.3,y:5.3,fontSize:4.2},"A"))))}},1333:(e,t,n)=>{n.d(t,{Z:()=>o});var r,a=n(7294);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}const o=function(e){return a.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 6.35 6.35"},e),r||(r=a.createElement("path",{d:"M3.17 0c-.1 0-.21.04-.3.13L.13 2.87a.43.43 0 0 0 0 .6l2.74 2.75c.17.17.44.17.6 0l2.75-2.74a.43.43 0 0 0 0-.6L3.48.12a.43.43 0 0 0-.3-.13Zm0 1.01a.43.43 0 0 1 .44.43v2.02a.43.43 0 0 1-.43.44.43.43 0 0 1-.44-.44V1.44a.43.43 0 0 1 .44-.43Zm0 3.46a.43.43 0 0 1 .44.44.43.43 0 0 1-.44.43.43.43 0 0 1-.43-.43.43.43 0 0 1 .43-.44"})))}},9687:()=>{},6154:()=>{},7129:(e,t,n)=>{n.d(t,{l:()=>l,o:()=>a});var r=n(9362);function a(e){return"files"in e}class l{tree;torrenthash;torrentId;files;filePathToIndex;initialized;constructor(e,t){this.torrenthash=e,this.torrentId=t,this._reset()}_reset(){this.tree={name:"",level:0,fullpath:"",size:0,want:!0,priority:0,done:0,percent:0,subdirs:new Map,files:new Map,isSelected:!1,wantedUpdating:!1},this.files=[],this.filePathToIndex={},this.initialized=!1}findEntry(e){const t=e.split("/");let n=this.tree;t[0]===this.tree.fullpath&&t.shift();for(let e=0;e<t.length;e++){if(!n.subdirs.has(t[e]))return n.files.has(t[e])?n.files.get(t[e]):void 0;n=n.subdirs.get(t[e])}return n}recalcTree(e){e.subdirs.forEach((e=>{this.recalcTree(e)}));let t=0,n=0;const r=new Set,a=new Set,l=e=>{t+=e.size,n+=e.done,r.add(e.want),a.add(e.priority)};e.subdirs.forEach(l),e.files.forEach(l),e.size=t,e.done=n,e.percent=100*n/t,e.want=1===r.size?[...r][0]:void 0,e.priority=1===a.size?[...a][0]:void 0}parse(e,t){this.torrenthash=e.hashString,this.files=e.files.map(((n,r)=>{const a=n.name.replace(/\\/g,"/");return{index:r,name:a.substring(a.lastIndexOf("/")+1),level:0,fullpath:a,size:n.length,want:!!t||e.fileStats[r].wanted,done:t?0:e.fileStats[r].bytesCompleted,percent:t?0:100*e.fileStats[r].bytesCompleted/n.length,priority:t?0:e.fileStats[r].priority,isSelected:!1,wantedUpdating:!1}}));const n=(0,r.DO)(e.name);(this.files.length>1||this.files.length>0&&this.files[0].fullpath.startsWith(n+"/"))&&(this.tree.fullpath=n);const a=this.files.map(((e,t)=>[e.fullpath,t])).sort(((e,t)=>e[0]<t[0]?-1:e[0]>t[0]?1:0));this.filePathToIndex={},a.forEach((([e,t])=>{this.filePathToIndex[e]=t;const n=e.split("/");let r=this.tree,a=r.fullpath;n[0]===a&&n.shift();for(let e=0;e<n.length-1;e++){const t=n[e];a=""===a?t:a+"/"+t;const l=r.subdirs.get(t);if(void 0===l){const n={name:t,level:e,fullpath:a,size:0,done:0,percent:0,subdirs:new Map,files:new Map,parent:r,isSelected:!1,wantedUpdating:!1};r.subdirs.set(t,n),r=n}else r=l}r.files.set(n[n.length-1],this.files[t]),this.files[t].parent=r,this.files[t].level=n.length-1})),this.recalcTree(this.tree),e.files.length>0&&(this.initialized=!0)}update(e){e.files.forEach(((t,n)=>{const r=t.name.replace(/\\/g,"/");if(this.files[n].fullpath!==r)return this._reset(),void this.parse(e,!1);this.files[n].want=e.fileStats[n].wanted,this.files[n].priority=e.fileStats[n].priority,this.files[n].done=e.fileStats[n].bytesCompleted,this.files[n].percent=100*this.files[n].done/this.files[n].size}));const t=e=>{e.wantedUpdating=!1,e.files.forEach((e=>{e.wantedUpdating=!1})),e.subdirs.forEach(t)};t(this.tree),this.recalcTree(this.tree)}updatePath(e,t){const n=this.findEntry(e);if(void 0===n)return;const r=n.fullpath.split("/");r.pop(),r.push(t);const l={...n,name:t,fullpath:r.join("/")};a(n)?(n.parent.subdirs.delete(n.name),n.parent.subdirs.set(t,l)):(n.parent.files.delete(n.name),n.parent.files.set(t,l))}setWanted(e,t,n){const r=this.findEntry(e);if(void 0===r)return;const l=e=>{e.subdirs.forEach((e=>{l(e)})),e.want=t,e.wantedUpdating=n,e.files.forEach((e=>{e.want=t,e.wantedUpdating=n}))};a(r)?l(r):(r.want=t,r.wantedUpdating=n),this.recalcTree(this.tree)}getChildFilesIndexes(e){const t=[],n=this.findEntry(e);if(void 0===n)return t;if(!a(n))return[n.index];const r=e=>{e.subdirs.forEach((e=>{r(e)})),e.files.forEach((e=>{t.push(e.index)}))};return r(n),t}getUnwanted(){const e=[],t=n=>{n.subdirs.forEach((e=>{t(e)})),n.files.forEach((t=>{t.want||e.push(t.index)}))};return t(this.tree),e}getWantedSize(){return this.files.reduce(((e,t)=>t.want?e+t.size:e),0)}setSelection(e,t){e.subdirs.forEach((e=>{this.setSelection(e,t)})),e.files.forEach((e=>{e.isSelected=t})),e.isSelected=t}deselectAllAncestors(e){let t=e.parent;for(;null!=t;)t.isSelected=!1,t=t.parent}updateAncestorSelectionStates(e){let t=e;for(;null!=t&&t!==this.tree;){t.isSelected=!0;for(const e of(0,r.wy)(t.subdirs.values(),t.files.values()))if(!e.isSelected)return t.isSelected=!1,void this.deselectAllAncestors(t);t=t.parent}}selectAction({verb:e,ids:t}){const n=new Set;"set"===e&&this.setSelection(this.tree,!1),t.forEach((t=>{const r=this.findEntry(t);void 0!==r?(null!=r.parent&&n.add(r.parent),"toggle"===e&&r.isSelected?a(r)?this.setSelection(r,!1):r.isSelected=!1:a(r)?this.setSelection(r,!0):r.isSelected=!0):console.log("What the horse?",t)})),n.forEach((e=>{this.updateAncestorSelectionStates(e)}))}getSelected(){const e=[],t=n=>{n.isSelected&&e.push(n.fullpath),n.files.forEach((t=>{t.isSelected&&e.push(t.fullpath)})),n.subdirs.forEach(t)};return t(this.tree),e}getView(e){const t=[],n=t=>e&&t.fullpath!==t.name?t.fullpath.split("/").slice(1).join("/"):t.name,r=(t,r)=>({name:n(t),level:e?0:t.level,fullpath:t.fullpath,size:t.size,done:t.done,percent:t.percent,wantedUpdating:t.wantedUpdating,want:t.want,priority:t.priority,subrows:r});if(e){const e=n=>{if(a(n)){for(const t of n.subdirs.values())e(t);t.push(...Array.from(n.files.values()).map((e=>r(e,[]))))}else t.push(r(n,[]))};e(this.tree)}else{const e=t=>{const n=[];return a(t)&&(n.push(...Array.from(t.subdirs.values()).map(e)),n.push(...Array.from(t.files.values()).map(e))),r(t,n)};t.push(...Array.from(this.tree.subdirs.values()).map(e)),t.push(...Array.from(this.tree.files.values()).map(e))}return t}}},8732:(e,t,n)=>{n.d(t,{l:()=>a});var r=n(2969);class a{clients=new Map;config;constructor(e){this.config=e}open(e,t,n){if(this.clients.has(e))return;const a=this.config.getServer(e),l=new r.Xm(a.connection,t,n);this.clients.set(e,l)}close(e){this.clients.delete(e)}getClient(e){return this.clients.get(e)}getHostname(e){return this.getClient(e).hostname}}},1434:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.r(t),n.d(t,{App:()=>P,default:()=>F});var a=n(8913),l=n(7294),o=n(874),s=n(8732),i=n(6972),c=n(2160),m=n(3515),d=n(5157),u=n(2691),p=n(1938),f=n(5945),h=n(41),E=n(3847),g=n(542),v=n(2969),b=n(5877),w=n(3795),y=n(1759),C=n(9114),k=n(7932),S=n(9362),x=n(6612),T=n(6090),I=e([a,E,T,b,x,o]);[a,E,T,b,x,o]=I.then?(await I)():I;const{appWindow:z,invoke:D,makeCreateTorrentView:M}=await Promise.resolve().then(n.bind(n,4637));function R(){const e=(0,l.useContext)(a.E_),{colorScheme:t}=(0,i.X)();(0,l.useEffect)((()=>{const n=z.listen("pass-from-window",(({payload:n})=>{"ready"===n.payload&&D("pass_to_window",{to:n.from,payload:JSON.stringify({colorScheme:t,defaultTrackers:e.values.interface.defaultTrackers})})}));return()=>{n.then((e=>{e()}))}}),[t,e]);const n=(0,l.useCallback)((()=>{M()}),[]);return(0,w.A)([["mod + T",n]]),l.createElement(c.A,{variant:"default",size:"lg",onClick:n,title:`创建种子 (${(0,S.Qh)()} + T)`,my:"auto"},l.createElement(C.Z,{size:"1.1rem"}))}function P(e){return l.createElement(f.aH,{client:E.Eh},l.createElement(g.T,{limit:5,style:{bottom:"2.5rem"}}),e.children,l.createElement(h.t,{toggleButtonProps:{style:{marginBottom:"2rem"}}}))}function F(){const e=(0,l.useContext)(a.E_),t=(0,l.useMemo)((()=>{const t=new s.l(e);return e.getOpenTabs().forEach((n=>{t.open(n,e.values.app.toastNotifications,e.values.app.toastNotificationSound)})),t}),[e]),n=(0,l.useRef)(null),[r,i]=(0,l.useState)(e.getServer(e.getLastOpenTab())),[f,h]=(0,l.useState)(e.getServers()),[E,g]=(0,y.q)(!1),w=(0,l.useCallback)((t=>{h(t),e.setServers(t)}),[e]);return l.createElement(P,null,l.createElement(T.w,{onSave:w,opened:E,close:g.close}),l.createElement(m.k,{direction:"column",h:"100%",w:"100%"},l.createElement(b.V,{ref:n,clientManager:t,servers:f,setCurrentServer:i},l.createElement(x.eM,{btn:"lg"}),l.createElement(x.eo,{btn:"lg"}),l.createElement(x.lv,{btn:"lg"}),l.createElement(R,null),l.createElement(c.A,{size:"lg",variant:"default",my:"auto",title:"应用设置",onClick:g.open},l.createElement(k.Z,{size:"1.1rem"}))),void 0!==r?l.createElement(a.Dk.Provider,{value:r},l.createElement(v.RY.Provider,{value:t.getClient(r.name)},l.createElement(o.x,{hostname:t.getHostname(r.name),tabsRef:n}))):l.createElement(m.k,{justify:"center",align:"center",w:"100%",h:"100%"},l.createElement(d.K,{mih:"20rem"},f.map(((e,t)=>l.createElement(u.z,{key:t,variant:"subtle",onClick:()=>n.current?.openTab(e.name)},e.name))),l.createElement(p.x,{sx:{flexGrow:1}}),l.createElement(u.z,{onClick:g.open},"Configure servers")))))}r()}catch(Z){r(Z)}}),1)},7300:(e,t,n)=>{n.d(t,{Z:()=>m});var r=n(6172),a=n(8093),l=n(2160),o=n(8752),s=n(7532),i=n(7294);const c=[0,1,2,3,4,5,6,7,8,9];function m(e){const t=(0,r.rZ)(),[n,m]=(0,i.useState)(!1),d="dark"===t.colorScheme?t.colors.gray[7]:t.colors.dark[6];return i.createElement(a.J,{width:"20rem",position:"right-start",withArrow:!0,withinPortal:!0,shadow:"md",opened:n,onChange:m},i.createElement(a.J.Target,null,i.createElement(l.A,{onClick:()=>{m((e=>!e))}},i.createElement(o.b,{color:t.colors[e.value.color][e.value.shade],sx:{border:`1px solid ${d}`}}))),i.createElement(a.J.Dropdown,null,i.createElement(l.A,{p:"lg",onClick:()=>{e.onChange(void 0),m(!1)}},"还原"),i.createElement(s.r,{columns:10},Object.keys(t.colors).map((n=>c.map((r=>i.createElement(s.r.Col,{key:`${n}:${r}`,span:1,p:"0.1rem"},i.createElement(l.A,{onClick:()=>{e.onChange({color:n,shade:r,computed:t.colors[n][r]}),m(!1)}},i.createElement(o.b,{color:t.colors[n][r]}))))))))))}},4095:(e,t,n)=>{n.d(t,{a:()=>i,x:()=>c});var r=n(4340),a=n(254),l=n(2691),o=n(7203),s=n(7294);function i(){const[e,t]=(0,s.useState)({x:0,y:0,opened:!1}),n=(0,s.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),t({x:e.clientX,y:e.clientY,opened:!0})}),[t]);return[e,t,n]}function c({contextMenuInfo:e,containerRef:t,closeOnClickOutside:n=!0,setContextMenuInfo:i,children:c,...m}){const d=(0,s.useCallback)((()=>{i({...e,opened:!1})}),[e,i]),[u,p]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{p(e.opened)}),[e.opened]),s.createElement(r.v,{...m,opened:u,onClose:d,offset:0,middlewares:{shift:!0,flip:!0},position:"right-start",closeOnClickOutside:n},s.createElement(a.h,{innerRef:t},s.createElement(r.v.Target,null,s.createElement(l.z,{unstyled:!0,sx:{position:"absolute",width:0,height:0,padding:0,border:0},style:{left:e.x,top:e.y}})),s.createElement(r.v.Dropdown,null,s.createElement(o.x.Autosize,{type:"auto",mah:"calc(100vh - 0.5rem)",offsetScrollbars:!0,styles:{viewport:{paddingBottom:0}}},c))))}},773:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{f:()=>oe});var a=n(7294),l=n(9362),o=n(2298),s=n(1649),i=n(6716),c=n(4572),m=n(1202),d=n(7554),u=n(8328),p=n(1938),f=n(6172),h=n(7532),E=n(3515),g=n(9724),v=n(3285),b=n(61),w=n(1972),y=n(7353),C=n(384),k=n(5663),S=n(8397),x=n(6554),T=n(8128),I=n(1963),z=n(5544),D=n(6268),M=n(7129),R=n(3847),P=n(8913),F=n(2185),Z=n(7279),N=n(4095),A=e([c,R,o,d,m,P]);function L(e){let t="",n=e.torrent.percentDone;e.torrent.status===u.qb.verifying?(t="已校验",n=e.torrent.recheckProgress):e.torrent.status===u.qb.downloading&&0===e.torrent.pieceCount?(t="下载元数据",n=e.torrent.metadataPercentComplete):t=e.torrent.status===u.qb.stopped?"已暂停":"已下载";const r=Math.floor(1e3*n),l=`${t}: ${r/10}%`;return a.createElement(p.x,{w:"100%",my:"0.5rem"},a.createElement(i.k,{now:r,max:1e3,label:l}))}function O({name:e,children:t}){const n=(0,f.rZ)();return a.createElement(h.r.Col,{span:1,sx:{borderBottom:"1px solid",borderColor:"dark"===n.colorScheme?n.colors.dark[5]:n.colors.gray[3],padding:"1px 0.4em 0 0.4em",lineHeight:1.4}},a.createElement(E.k,null,a.createElement(p.x,{sx:{flex:"0 0 7em"}},a.createElement("span",{style:{float:"right",marginRight:"0.4em"}},e)),t))}function $(e){const t=e.torrent.pieceSize>0?e.torrent.corruptEver/e.torrent.pieceSize:0;return a.createElement(a.Fragment,null,`${(0,l.Iy)(e.torrent.corruptEver)} (${t} 异常)`)}function q(e){const t=e.torrent.secondsDownloading,n=`${(0,l.Iy)(e.torrent.rateDownload)}/s`;return t>0?a.createElement(a.Fragment,null,`${n} (average: ${(0,l.Iy)(e.torrent.downloadedEver/t)}/s)`):a.createElement(a.Fragment,null,n)}function U(e){if(!0!==("download"===e.field?e.torrent.downloadLimited:e.torrent.uploadLimited))return a.createElement(a.Fragment,null,"-");const t="download"===e.field?e.torrent.downloadLimit:e.torrent.uploadLimit;return t<0?a.createElement(a.Fragment,null,"∞"):a.createElement(a.Fragment,null,`${(0,l.Iy)(1024*t)}/s`)}function V(e){const t=e.torrent.peersSendingToUs,n=e.torrent.cachedSeedsTotal;return n<0?a.createElement(a.Fragment,null,t):a.createElement(a.Fragment,null,`${t} (${n})`)}function _(e){const t=e.torrent.peersGettingFromUs,n=e.torrent.cachedPeersTotal;return n<0?a.createElement(a.Fragment,null,t):a.createElement(a.Fragment,null,`${t} (${n})`)}function j(e){if(0===e.torrent.trackerStats.length)return a.createElement(a.Fragment,null);const t=e.torrent.trackerStats[0],n=t.announceState;return a.createElement(a.Fragment,null,2===n||3===n?"-":(0,l.dh)(t.nextAnnounceTime))}function W(e){const t=(0,l.e$)(e.torrent.secondsSeeding),n=`${e.torrent.uploadRatio} ${""!==t?`(${t})`:""}`,[r,o]=(0,F.y)();return a.createElement(g.W,{fluid:!0},a.createElement(h.r,{ref:r,my:"sm",sx:{maxWidth:"100em"},columns:o.width>850?3:1},a.createElement(O,{name:"状态:"},a.createElement(c.F9,{...e,fieldName:"status"})),a.createElement(O,{name:"错误:"},e.torrent.cachedError),a.createElement(O,{name:"剩余:"},`${(0,l.e$)(e.torrent.eta)} (${(0,l.Iy)(e.torrent.leftUntilDone)})`),a.createElement(O,{name:"已下载:"},(0,l.Iy)(e.torrent.downloadedEver)),a.createElement(O,{name:"已上传:"},(0,l.Iy)(e.torrent.uploadedEver)),a.createElement(O,{name:"丢弃:"},a.createElement($,{...e})),a.createElement(O,{name:"下载速度:"},a.createElement(q,{...e})),a.createElement(O,{name:"上传速度:"},`${(0,l.Iy)(e.torrent.rateUpload)}/s`),a.createElement(O,{name:"分享率:"},n),a.createElement(O,{name:"下载限速:"},a.createElement(U,{...e,field:"download"})),a.createElement(O,{name:"上传限速:"},a.createElement(U,{...e,field:"upload"})),a.createElement(O,{name:"备用带宽:"},e.torrent.group),a.createElement(O,{name:"种子|活跃:"},a.createElement(V,{...e})),a.createElement(O,{name:"下载|活跃:"},a.createElement(_,{...e})),a.createElement(O,{name:"最大链接数:"},e.torrent.maxConnectedPeers),a.createElement(O,{name:"Tracker:"},a.createElement(c.it,{...e,fieldName:"trackerStats"})),a.createElement(O,{name:"下次汇报时间:"},a.createElement(j,{...e})),a.createElement(O,{name:"最后活动时间:"},a.createElement(c.Nn,{...e,fieldName:"activityDate"}))))}function G(e){if(e.torrent.totalSize<=0)return a.createElement(a.Fragment,null,"?");const t=(0,l.Iy)(e.torrent.totalSize),n=(0,l.Iy)(e.torrent.sizeWhenDone-e.torrent.leftUntilDone);return a.createElement(a.Fragment,null,`${t} (已下载 ${n})`)}function X(e){if(e.torrent.totalSize<=0)return a.createElement(a.Fragment,null,"?");const t=(0,l.Iy)(e.torrent.pieceSize);let n=0;return n=e.torrent.totalSize===e.torrent.haveValid?e.torrent.pieceCount:e.torrent.haveValid/(e.torrent.pieceSize>0?e.torrent.pieceSize:1),a.createElement(a.Fragment,null,`${e.torrent.pieceCount} x ${t} (已完成 ${Math.round(n)})`)}[c,R,o,d,m,P]=A.then?(await A)():A;const B=/https?:\/\//,K=/(https?:\/\/[^\s]+)/;function Y(e){if(!B.test(e.text))return a.createElement(a.Fragment,null,e.text);const t=e.text.split(K).filter((e=>e.length>0));return a.createElement(a.Fragment,null,t.map(((e,t)=>B.test(e)?a.createElement(v.e,{key:t,href:e,target:"_blank",rel:"noreferrer"},e):a.createElement("span",{key:t},e))))}const Q=e=>({root:{backgroundColor:"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[2],height:"1.25rem",flexGrow:1},input:{minHeight:"1.25rem",height:"1.25rem",lineHeight:"1rem",cursor:"text"}});function H(e){const t=(0,l.Nw)(e.torrent.downloadDir)+(0,l.DO)(e.torrent.name),[n,r]=(0,F.y)();return a.createElement(g.W,{fluid:!0},a.createElement(h.r,{ref:n,my:"sm",sx:{maxWidth:"100em"},columns:r.width>850?2:1},a.createElement(O,{name:"保存路径:"},a.createElement(b.o,{styles:Q,variant:"unstyled",readOnly:!0,value:t})),a.createElement(O,{name:"创建日期:"},a.createElement("div",null,a.createElement("span",null,e.torrent.dateCreated>0?(0,l.dh)(e.torrent.dateCreated):""),a.createElement("span",null,void 0===e.torrent.creator||""===e.torrent.creator?"":` by ${e.torrent.creator}`))),a.createElement(O,{name:"总大小:"},a.createElement(G,{...e})),a.createElement(O,{name:"块:"},a.createElement(X,{...e})),a.createElement(O,{name:"Hash:"},a.createElement(b.o,{styles:Q,variant:"unstyled",readOnly:!0,value:e.torrent.hashString})),a.createElement(O,{name:"注释:"},a.createElement(Y,{text:e.torrent.comment})),a.createElement(O,{name:"添加时间:"},a.createElement(c.Nn,{...e,fieldName:"addedDate"})),a.createElement(O,{name:"完成时间:"},a.createElement(c.Nn,{...e,fieldName:"doneDate"})),a.createElement(O,{name:"磁力链接:"},a.createElement(b.o,{styles:Q,variant:"unstyled",readOnly:!0,value:e.torrent.magnetLink})),a.createElement(O,{name:"用户标签:"},a.createElement(c.XW,{...e,fieldName:"labels"}))))}function J(e){return a.createElement(w.Z,{grow:!0},a.createElement(p.x,{px:"md",sx:e=>({backgroundColor:"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3],fontSize:"1.25rem",fontWeight:"bolder"})},e.children))}function ee(e){return a.createElement(E.k,{direction:"column",h:"100%",w:"100%"},a.createElement(g.W,{fluid:!0,mx:0},a.createElement(L,{...e})),a.createElement("div",{style:{flexGrow:1}},a.createElement("div",{className:"scrollable"},a.createElement(g.W,{fluid:!0},a.createElement(J,null,"传输信息"),a.createElement(W,{...e}),a.createElement(J,null,"种子信息"),a.createElement(H,{...e})))))}function te(e){const t=(0,a.useMemo)((()=>new M.l(e.torrent.hashString,e.torrent.id)),[e.torrent.hashString,e.torrent.id]),{data:n,refetch:r}=(0,R.f$)("filetree",t);(0,a.useEffect)((()=>{t.initialized?t.update(e.torrent):t.parse(e.torrent,!1),r()}),[e.torrent,t,r]);const{mutate:l}=(0,R.n5)(),s=(0,o.R)(t,!0),i=(0,a.useCallback)(((n,r)=>{s(n,r),l({torrentIds:[e.torrent.id],fields:{[r?"files-wanted":"files-unwanted"]:t.getChildFilesIndexes(n)}})}),[t,l,s,e.torrent.id]);return a.createElement(o.r,{fileTree:t,data:n,downloadDir:e.torrent.downloadDir,onCheckboxChange:i})}function ne(e){return a.createElement(y.i,{mb:"sm",sx:{maxWidth:"25em"}},a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,"已上传"),a.createElement("td",null,(0,l.Iy)(e.stats.uploadedBytes))),a.createElement("tr",null,a.createElement("td",{style:{width:"10em"}},"已下载"),a.createElement("td",null,(0,l.Iy)(e.stats.downloadedBytes))),a.createElement("tr",null,a.createElement("td",null,"分享率"),a.createElement("td",null,0===e.stats.downloadedBytes?"∞":(e.stats.uploadedBytes/e.stats.downloadedBytes).toFixed(2))),a.createElement("tr",null,a.createElement("td",null,"添加文件"),a.createElement("td",null,e.stats.filesAdded)),e.stats.sessionCount>1&&a.createElement("tr",null,a.createElement("td",null,"会话次数"),a.createElement("td",null,e.stats.sessionCount)),a.createElement("tr",null,a.createElement("td",null,"活动时间"),a.createElement("td",null,(0,l.e$)(e.stats.secondsActive,!1)))))}function re(){const{data:e}=(0,R.ZC)(!0);return a.createElement(E.k,{direction:"column",h:"100%",w:"100%"},a.createElement("div",{style:{flexGrow:1}},a.createElement("div",{className:"scrollable"},void 0!==e?a.createElement(g.W,{fluid:!0},a.createElement(J,null,"累计"),a.createElement(ne,{stats:e["cumulative-stats"]}),a.createElement(J,null,"当前会话"),a.createElement(ne,{stats:e["current-stats"]})):a.createElement(a.Fragment,null))))}const ae=a.memo((function({torrent:e}){return a.createElement(a.Fragment,null,a.createElement(C.m.Panel,{value:"常规",h:"100%"},void 0!==e?a.createElement(ee,{torrent:e}):a.createElement(a.Fragment,null)),a.createElement(C.m.Panel,{value:"文件",h:"100%"},void 0!==e?a.createElement(te,{torrent:e}):a.createElement(a.Fragment,null)),a.createElement(C.m.Panel,{value:"块",h:"100%"},void 0!==e?a.createElement(s.T,{torrent:e}):a.createElement(a.Fragment,null)),a.createElement(C.m.Panel,{value:"用户",h:"100%"},void 0!==e?a.createElement(d.g,{torrent:e}):a.createElement(a.Fragment,null)),a.createElement(C.m.Panel,{value:"Tracker",h:"100%"},void 0!==e?a.createElement(m.I,{torrent:e}):a.createElement(a.Fragment,null)),a.createElement(C.m.Panel,{value:"数据统计",h:"100%"},a.createElement(re,null)))}));function le(e){const t=(0,a.useContext)(P.E_),n=t.getTableColumnVisibility("peers").country??!0,{data:r,isLoading:l}=(0,R.if)(e.torrentId??-1,void 0!==e.torrentId&&e.updates,n),[o,s]=(0,a.useState)();(0,a.useEffect)((()=>{void 0===e.torrentId?s(void 0):void 0!==r&&s(r)}),[r,e.torrentId]);const[i,c]=(0,a.useState)(t.values.interface.detailsTabs),[m,d]=(0,a.useState)((0,Z.s)(i));(0,a.useEffect)((()=>{t.values.interface.detailsTabs=i,d((0,Z.s)(i))}),[t,i]);const u=(0,a.useMemo)((()=>i.find((e=>e.visible))?.section??""),[i]),[f,h,E]=(0,N.a)();return a.createElement(C.m,{variant:"outline",defaultValue:u,keepMounted:!1,h:"100%",w:"100%",styles:e=>({root:{display:"flex",flexDirection:"column"},tab:{borderColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[2],"&[data-active]":{borderColor:"dark"===e.colorScheme?e.colors.dark[3]:e.colors.gray[5]}}})},a.createElement(C.m.List,{px:"sm",pt:"xs",onContextMenu:E},a.createElement(Z.D,{sections:i,setSections:c,contextMenuInfo:f,setContextMenuInfo:h}),i[m["常规"]].visible&&a.createElement(C.m.Tab,{value:"常规",disabled:void 0===o,style:{order:m["常规"]}},a.createElement(w.Z,null,a.createElement(S.Z,{size:"1.1rem"}),"常规")),i[m["文件"]].visible&&a.createElement(C.m.Tab,{value:"文件",disabled:void 0===o,style:{order:m["文件"]}},a.createElement(w.Z,null,a.createElement(x.Z,{size:"1.1rem"}),"文件"+(void 0!==o?` (${o.files.length})`:""))),i[m["块"]].visible&&a.createElement(C.m.Tab,{value:"块",disabled:void 0===o,style:{order:m["块"]}},a.createElement(w.Z,null,a.createElement(T.Z,{size:"1.1rem"}),"块"+(void 0!==o?` (${o.pieceCount})`:""))),i[m["用户"]].visible&&a.createElement(C.m.Tab,{value:"用户",disabled:void 0===o,style:{order:m["用户"]}},a.createElement(w.Z,null,a.createElement(I.Z,{size:"1.1rem"}),"用户")),i[m.Tracker].visible&&a.createElement(C.m.Tab,{value:"Tracker",disabled:void 0===o,style:{order:m.Tracker}},a.createElement(w.Z,null,a.createElement(z.Z,{size:"1.1rem"}),"Tracker")),i[m["分割"]].visible&&a.createElement(p.x,{style:{flexGrow:1,order:m["分割"]}}),i[m["数据统计"]].visible&&a.createElement(C.m.Tab,{value:"数据统计",style:{order:m["数据统计"]}},a.createElement(w.Z,null,a.createElement(D.Z,{size:"1.1rem"}),"数据统计"))),a.createElement("div",{style:{flexGrow:1,position:"relative"}},a.createElement(k.f,{visible:void 0!==e.torrentId&&l,transitionDuration:500,loaderProps:{size:"xl"},overlayOpacity:.35}),a.createElement(ae,{torrent:o})))}const oe=(0,a.memo)(le);r()}catch(se){r(se)}}))},9603:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{a:()=>g});var a=n(9597),l=n(1187),o=n(3822),s=n(9685),i=n(3579),c=n(5413),m=n(3450),d=n(5236),u=n(7294),p=n(6172),f=n(727),h=e([f]);f=(h.then?(await h)():h)[0];const E=[{icon:a.Z,extensions:["3gp","avi","flv","m4v","mkv","mov","mp4","mpeg","mpg","rm","swf","vob","webm","wmv"],color:"grape"},{icon:l.Z,extensions:["aac","aif","cda","flac","m4a","mid","midi","mp3","mpa","ogg","wav","wma","wpl"],color:"cyan"},{icon:o.Z,extensions:["ai","bmp","gif","ico","jpg","jpeg","png","ps","psd","svg","tif","tiff","webp"],color:"yellow"},{icon:s.Z,extensions:["7z","arc","arj","bz","bz2","cbz","cbr","deb","gz","pkg","rar","rpm","tar","z","zip"],color:"lime"},{icon:i.Z,extensions:["exe","bin","dmg","dll","apk","jar","msi","sys","cab"],color:"red"},{icon:c.Z,extensions:["doc","docx","rtf","txt","md","adoc","ass","epub","mobi","fb2"],color:"gray"},{icon:m.Z,extensions:["iso","vcd","toast","mdf","nrg","img"],color:"cyan"}].reduce(((e,t)=>{for(const n of t.extensions)e[n]=t;return e}),{});function g({name:e}){const t=(0,p.rZ)(),n=(0,f.jB)(),r=e.substring(e.lastIndexOf(".")+1).toLowerCase(),a=Object.prototype.hasOwnProperty.call(E,r)?E[r].icon:d.Z,l=Object.prototype.hasOwnProperty.call(E,r)?E[r].color:"gray",o="dark"===t.colorScheme||n?3:9;return u.createElement(a,{size:"1.1rem",color:t.colors[l][o]})}r()}catch(v){r(v)}}))},3940:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{t:()=>D,x:()=>V});var a=n(7294),l=n(8328),o=n(4908),s=n(1698),i=n(7028),c=n(291),m=n(99),d=n(1374),u=n(4390),p=n(8913),f=n(3515),h=n(4340),E=n(254),g=n(1938),v=n(2691),b=n(4168),w=n(9362),y=n(4095),C=n(7279),k=n(8645),S=n(6146),x=n(4637),T=e([x,p]);[x,p]=T.then?(await T)():T;const I=[{name:"全部",filter:e=>!0,icon:u.oT,required:!0},{name:"下载中",filter:e=>e.status===l.qb.downloading,icon:u.ys},{name:"已暂停",filter:e=>e.status===l.qb.stopped,icon:u.eC},{name:"已完成",filter:e=>e.status===l.qb.seeding||e.sizeWhenDone>0&&0===Math.max(e.sizeWhenDone-e.haveValid,0),icon:u.FG},{name:"正在校验",filter:e=>[l.qb.verifying,l.qb.queuedToVerify,l.qb.queuedToDownload].includes(e.status),icon:u.Pi},{name:"活动中",filter:e=>e.rateDownload>0||e.rateUpload>0,icon:u.ZS},{name:"未活动",filter:e=>0===e.rateDownload&&0===e.rateUpload&&e.status!==l.qb.stopped,icon:u.Rz},{name:"工作中",filter:e=>e.status!==l.qb.stopped,icon:u.bQ},{name:"错误",filter:e=>0!==e.error||""!==e.cachedError,icon:u.jj},{name:"磁力链接",filter:e=>e.status===l.qb.downloading&&0===e.pieceCount,icon:u.$0}],z={name:"<无标签>",filter:e=>0===e.labels?.length,icon:u.__},D=I[0].filter;function M(e,t){let n;const r=e.parentElement,a=parseInt(r.style.order);if(t)if(!0===e.nextElementSibling?.hasAttribute("tabIndex"))n=e.nextElementSibling;else for(const e of r.parentElement?.children??[])parseInt(e.style.order)===a+1&&(n=e.firstElementChild?.nextElementSibling);else if(!0===e.previousElementSibling?.hasAttribute("tabIndex"))n=e.previousElementSibling;else for(const e of r.parentElement?.children??[])parseInt(e.style.order)===a-1&&(n=e.lastElementChild);void 0!==n&&null!=n&&(n.focus(),n.click?.())}function R(e){"ArrowDown"===e.key&&(e.stopPropagation(),e.preventDefault(),M(e.currentTarget,!0)),"ArrowUp"===e.key&&(e.stopPropagation(),e.preventDefault(),M(e.currentTarget,!1))}const P=a.memo((function(e){const t=(0,k.EL)(),n=t.torrents.filter(e.filter.filter),r=(0,k.uM)();let l=e.showSize?(0,w.Iy)(n.reduce(((e,t)=>e+t.sizeWhenDone),0)):"";return a.createElement(f.k,{align:"center",gap:"sm",px:"xs",tabIndex:-1,style:{paddingLeft:1*(e.level||0)+"rem"},className:void 0!==e.currentFilters.find((t=>t.id===e.id))?"selected":"",onClick:t=>{e.setCurrentFilters({verb:(0,w.jb)(t)?"toggle":"set",filter:{id:e.id,filter:e.filter.filter}}),e.setSearchTracker("")},onDoubleClick:a=>{if(e.selectAllOnDbClk){let a=[];n.forEach((e=>{a.push(e.id)})),e.selectedReducer({verb:"set",ids:a}),n.length>0&&!r.has(t.current??-1)&&e.setCurrentTorrentId(n[0].id)}e.setSearchTracker("")},onKeyDown:R},e.filter.icon&&a.createElement("div",{className:"icon-container"},a.createElement(e.filter.icon,null)),a.createElement("div",{style:{flexShrink:1,overflow:"hidden",textOverflow:"ellipsis"},title:e.filter.name},e.filter.name),a.createElement("div",{style:{flexShrink:0,fontSize:"small",opacity:.8}},`(${e.count})`),e.showSize&&a.createElement("div",{style:{flexShrink:0,marginLeft:"auto",fontSize:"small",opacity:.8}},`[${l}]`))})),F=a.memo((function(e){return a.createElement(P,{...e,id:`label-${e.label}`,filter:{name:e.label,filter:t=>t.labels.includes(e.label),icon:u.__}})})),Z=a.memo((function(e){return a.createElement(P,{...e,id:`tracker-${e.tracker}`,filter:{name:e.tracker,filter:t=>t.cachedMainTracker===e.tracker,icon:u.fX}})})),N=a.memo((function(e){return a.createElement(P,{...e,id:`error-${e.error}`,filter:{name:e.error,filter:t=>t.cachedError===e.error,icon:u.jj}})}));function A(e){const t=(0,a.useCallback)((t=>{const n=t.downloadDir;return n.length+1===e.dir.path.length?e.dir.path.startsWith(n):n.startsWith(e.dir.path)}),[e.dir.path]),n=(0,a.useCallback)((t=>{const n=t.downloadDir;return(n.length+1===e.dir.path.length||n.length===e.dir.path.length)&&e.dir.path.startsWith(n)}),[e.dir.path]),r=(0,a.useCallback)((t=>{t.stopPropagation(),e.dir.expanded=!0,e.expandedReducer({verb:"add",value:e.dir.path})}),[e]),l=(0,a.useCallback)((t=>{t.stopPropagation(),e.dir.expanded=!1,e.expandedReducer({verb:"remove",value:e.dir.path})}),[e]),m=e.dir.subdirs.size>0,d=(0,k.EL)(),u=(0,k.uM)(),p=d.torrents.filter(t);let h=e.showSize?(0,w.Iy)(p.reduce(((e,t)=>e+t.sizeWhenDone),0)):"";const[E,g]=(0,a.useState)("green"),v=(0,w.Nw)(e.dir.path),b=(0,a.useCallback)((()=>{(0,x.copyToClipboard)(v),S.N9.show({message:"已复制路径到剪切板:"+v,color:"green"})}),[v]),y=(0,a.useCallback)((t=>{m&&!e.dir.expanded&&"ArrowRight"===t.key?(e.dir.expanded=!0,e.expandedReducer({verb:"add",value:e.dir.path})):m&&e.dir.expanded&&"ArrowLeft"===t.key?(e.dir.expanded=!1,e.expandedReducer({verb:"remove",value:e.dir.path})):R(t)}),[m,e]);return a.createElement(f.k,{align:"center",gap:"sm",px:"xs",tabIndex:-1,style:{paddingLeft:1.2*e.dir.level+.2+"rem",cursor:"default"},className:void 0!==e.currentFilters.find((t=>t.id===e.id))?"selected":"",onClick:r=>{e.setCurrentFilters({verb:(0,w.jb)(r)?"toggle":"set",filter:{id:e.id,filter:e.hideSubDirTorrents?n:t}}),e.setSearchTracker("")},onDoubleClick:t=>{if(e.selectAllOnDbClk){let t=[];p.forEach((e=>{t.push(e.id)})),e.selectedReducer({verb:"set",ids:t}),p.length>0&&!u.has(d.current??-1)&&e.setCurrentTorrentId(p[0].id)}e.setSearchTracker("")},onKeyDown:y},a.createElement("div",{className:"icon-container"},m?e.dir.expanded?a.createElement(o.Z,{size:"1.1rem",onClick:l,style:{cursor:"pointer"}}):a.createElement(s.Z,{size:"1.1rem",onClick:r,style:{cursor:"pointer"}}):a.createElement(i.Z,{size:"1.1rem"})),a.createElement("div",{style:{flexShrink:1,overflow:"hidden",textOverflow:"ellipsis"}},e.dir.name),a.createElement("div",{style:{flexShrink:0,fontSize:"small",opacity:.8}},`(${e.dir.count})`),e.showSize&&a.createElement("div",{style:{flexShrink:0,marginLeft:"auto",fontSize:"small",opacity:.8}},`[${h}]`),a.createElement(c.Z,{style:{flexShrink:0,marginLeft:e.showSize?void 0:"auto"},title:"点击复制："+v,size:"1.1rem",cursor:"pointer",opacity:.9,color:E,onMouseOver:()=>g("blue"),onMouseOut:()=>g("green"),onMouseDown:()=>g("gray"),onMouseUp:()=>g("green"),onClick:b}))}const L={name:"",path:"",subdirs:new Map,expanded:!0,count:0,level:-1};function O(e,t,n){const r={...L,subdirs:new Map};return e.forEach((e=>{const n=e.split("/");let a=r,l="";for(const e of n)l=l+e+"/",""!==e&&(a.subdirs.has(e)||a.subdirs.set(e,{name:e,path:l,subdirs:new Map,expanded:t.includes(l),count:0,level:a.level+1}),a=a.subdirs.get(e),a.count++)})),n?$(r):r}function $(e){const t=q(e);for(const[e,n]of t.subdirs){n.level=t.level+1;const r=$(n);t.subdirs.set(e,r)}return t}function q(e){let t=e;if(1===e.subdirs.size){const[n]=e.subdirs.values();e.count===n.count&&(n.name=e.name+"/"+n.name,n.level=e.level,t=q(n))}return t}function U(e){const t=[],n=e=>{e.subdirs.forEach((e=>{t.push(e),e.expanded&&n(e)}))};return n(e),t}const V=a.memo((function({torrents:e,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s}){const i=(0,a.useContext)(p.E_),c=(0,a.useContext)(p.Dk),k=(0,w.oU)(),S=(0,a.useCallback)((({verb:e,value:t})=>{if("add"===e)c.expandedDirFilters=[...c.expandedDirFilters,t];else{const e=c.expandedDirFilters.indexOf(t);c.expandedDirFilters=[...c.expandedDirFilters.slice(0,e),...c.expandedDirFilters.slice(e+1)]}k()}),[k,c]),x=(0,a.useMemo)((()=>e.map((e=>e.downloadDir)).sort()),[e]),T=(0,a.useMemo)((()=>U(O(x,c.expandedDirFilters,i.values.interface.compactDirectories))),[x,c.expandedDirFilters,i.values.interface.compactDirectories]),[M,R,L]=(0,a.useMemo)((()=>{const t={},n={},r={};return i.values.interface.preconfiguredLabels.forEach((e=>{t[e]=0})),e.forEach((e=>{e.labels?.forEach((e=>{e in t||(t[e]=0),t[e]=t[e]+1})),e.cachedMainTracker in n||(n[e.cachedMainTracker]=0),n[e.cachedMainTracker]=n[e.cachedMainTracker]+1,""!=e.cachedError&&(e.cachedError in r||(r[e.cachedError]=0),r[e.cachedError]=r[e.cachedError]+1)})),[t,n,r]}),[i,e]),[$,q]=(0,a.useReducer)(((e,t)=>(n({verb:"set",filter:{id:"",filter:D}}),t)),i.values.interface.filterSections),[V,_]=(0,a.useState)((0,C.s)($)),[j,W]=(0,a.useState)(i.values.interface.statusFiltersVisibility),[G,X]=(0,a.useState)(i.values.interface.compactDirectories),[B,K]=(0,a.useState)(i.values.interface.hideSubDirTorrents),[Y,Q]=(0,a.useState)(i.values.interface.showFilterGroupSize),[H,J]=(0,a.useState)(i.values.interface.selectFilterGroupOnDbClk);(0,a.useEffect)((()=>{i.values.interface.filterSections=$,i.values.interface.statusFiltersVisibility=j,i.values.interface.compactDirectories=G,i.values.interface.hideSubDirTorrents=B,i.values.interface.showFilterGroupSize=Y,i.values.interface.selectFilterGroupOnDbClk=H,_((0,C.s)($))}),[i,$,j,G,B,Y,H]);const[ee,te,ne]=(0,y.a)(),re=(0,a.useRef)(null),ae=(0,a.useRef)(null),[le,oe]=(0,a.useState)(!1),[se,ie]=(0,a.useState)((()=>new DOMRect(0,-1e3,0,0))),ce=(0,a.useCallback)((()=>{if(null==ae.current||null==re.current)return;const e=ae.current.querySelector(".mantine-Menu-dropdown")?.getBoundingClientRect();if(null==e)return;const t=re.current.getBoundingClientRect();ie(new DOMRect(e.x,t.y,e.width,t.height)),oe(!0)}),[]),me=(0,a.useCallback)((()=>{oe(!1),ie(new DOMRect(0,-1e3,0,0))}),[]),de=(0,a.useCallback)((e=>{const r=I[e].name,a=`status-${r}`,l={...j};l[r]=!j[r],W(l);const o=t.find((e=>e.id===a));null!=o&&n({verb:"toggle",filter:o})}),[j,t,n]),ue=(0,a.useCallback)((e=>{e.stopPropagation(),X(!G)}),[X,G]),pe=(0,a.useCallback)((e=>{e.stopPropagation(),K(!B)}),[K,B]),fe=(0,a.useCallback)((e=>{e.stopPropagation(),Q(!Y)}),[Q,Y]),he=(0,a.useCallback)((e=>{e.stopPropagation(),J(!H)}),[J,H]);return a.createElement(a.Fragment,null,a.createElement(h.v,{openDelay:100,closeDelay:400,opened:le,onChange:oe,middlewares:{shift:!0,flip:!0},position:"right-start",zIndex:301,offset:0,closeOnItemClick:!1},a.createElement(E.h,null,a.createElement(g.x,{onMouseDown:me,sx:{position:"absolute",left:0,top:0,height:"100vh",width:"100vw",zIndex:le?100:-1}}),a.createElement(h.v.Target,null,a.createElement(v.z,{unstyled:!0,sx:{position:"absolute",border:0,padding:0,background:"transparent"},style:{left:se.x,top:se.y,width:se.width,height:se.height}})),a.createElement(h.v.Dropdown,{miw:"10rem"},I.map(((e,t)=>!0!==e.required&&a.createElement(h.v.Item,{key:e.name,onClick:()=>{de(t)},icon:j[e.name]?a.createElement(m.Z,{size:"1rem"}):a.createElement(g.x,{miw:"1rem"})},e.name)))))),a.createElement(f.k,{direction:"column",onContextMenu:ne,sx:{width:"100%",minHeight:"100%",whiteSpace:"nowrap",cursor:"default",userSelect:"none"}},a.createElement(C.D,{sections:$,setSections:q,contextMenuInfo:ee,setContextMenuInfo:te,contextMenuContainerRef:ae,onSectionItemMouseEnter:me,closeOnClickOutside:!le},a.createElement(h.v.Divider,null),a.createElement(h.v.Item,{ref:re,icon:a.createElement(g.x,{miw:"1rem"}),rightSection:a.createElement(d.Z,{size:"12",style:{marginRight:"-0.4rem"}}),onMouseEnter:ce,onMouseDown:e=>{e.stopPropagation()}},"状态项"),a.createElement(h.v.Divider,null),a.createElement(h.v.Item,{icon:G?a.createElement(m.Z,{size:"1rem"}):a.createElement(g.x,{miw:"1rem"}),onMouseEnter:me,onMouseDown:ue},"目录简洁展示"),a.createElement(h.v.Item,{icon:B?a.createElement(m.Z,{size:"1rem"}):a.createElement(g.x,{miw:"1rem"}),onMouseEnter:me,onMouseDown:pe},"列表不显示子目录种子"),a.createElement(h.v.Item,{icon:Y?a.createElement(m.Z,{size:"1rem"}):a.createElement(g.x,{miw:"1rem"}),onMouseEnter:me,onMouseDown:fe},"显示分组体积"),a.createElement(h.v.Item,{icon:H?a.createElement(m.Z,{size:"1rem"}):a.createElement(g.x,{miw:"1rem"}),onMouseEnter:me,onMouseDown:he},"双击全选分组")),$[V["种子状态"]]?.visible&&a.createElement("div",{style:{order:V["种子状态"]}},a.createElement(b.i,{mx:"sm",label:"种子状态",labelPosition:"center"}),I.map((i=>{if(!0===i.required||j[i.name]){if("已暂停"===i.name){let c={name:" 已完成",filter:e=>e.status===l.qb.stopped&&e.sizeWhenDone>0&&0===Math.max(e.sizeWhenDone-e.haveValid,0),icon:u._B},m={name:" 未完成",filter:e=>e.status===l.qb.stopped&&!(e.sizeWhenDone>0&&0===Math.max(e.sizeWhenDone-e.haveValid,0)),icon:u.qd};return a.createElement("div",null,a.createElement(P,{key:`status-${i.name}`,id:`status-${i.name}`,filter:i,count:e.filter(i.filter).length,showSize:Y,selectAllOnDbClk:H,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s}),a.createElement(P,{key:`status-${c.name}`,id:`status-${c.name}`,filter:c,level:1,count:e.filter(c.filter).length,showSize:Y,selectAllOnDbClk:H,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s}),a.createElement(P,{key:`status-${m.name}`,id:`status-${m.name}`,filter:m,level:1,count:e.filter(m.filter).length,showSize:Y,selectAllOnDbClk:H,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s}))}return a.createElement(P,{key:`status-${i.name}`,id:`status-${i.name}`,filter:i,count:e.filter(i.filter).length,showSize:Y,selectAllOnDbClk:H,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s})}}))),$[V["数据目录"]]?.visible&&a.createElement("div",{style:{order:V["数据目录"]}},a.createElement(b.i,{mx:"sm",mt:"md",label:"数据目录",labelPosition:"center"}),T.map((l=>a.createElement(A,{key:`dir-${l.path}`,id:`dir-${l.path}`,showSize:Y,hideSubDirTorrents:B,selectAllOnDbClk:H,dir:l,expandedReducer:S,torrents:e,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s})))),$[V["用户标签"]]?.visible&&a.createElement("div",{style:{order:V["用户标签"]}},a.createElement(b.i,{mx:"sm",mt:"md",label:"用户标签",labelPosition:"center"}),a.createElement(P,{id:"nolabels",filter:z,count:e.filter(z.filter).length,showSize:Y,selectAllOnDbClk:H,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s}),Object.keys(M).sort().map((e=>a.createElement(F,{key:`labels-${e}`,label:e,count:M[e],showSize:Y,selectAllOnDbClk:H,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s})))),$[V["服务器分布"]]?.visible&&a.createElement("div",{style:{order:V["服务器分布"]}},a.createElement(b.i,{mx:"sm",mt:"md",label:"服务器分布",labelPosition:"center"}),Object.keys(R).sort().map((e=>a.createElement(Z,{key:`trackers-${e}`,tracker:e,count:R[e],showSize:Y,selectAllOnDbClk:H,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s})))),$[V["错误分布"]]?.visible&&a.createElement("div",{style:{order:V["错误分布"]}},a.createElement(b.i,{mx:"sm",mt:"md",label:"错误分布",labelPosition:"center"}),Object.keys(L).sort().map((e=>a.createElement(N,{key:`errors-${e}`,error:e,count:L[e],showSize:Y,selectAllOnDbClk:H,currentFilters:t,setCurrentFilters:n,setSearchTracker:r,setCurrentTorrentId:o,selectedReducer:s}))))))}));r()}catch(_){r(_)}}))},6612:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{eM:()=>v,eo:()=>g,lv:()=>b});var a=n(6972),l=n(2160),o=n(4252),s=n(4204),i=n(8397),c=n(4462),m=n(7294),d=n(1739),u=n(3795),p=n(1759),f=n(9362),h=n(4476),E=e([d,h]);function g(e){const{colorScheme:t,toggleColorScheme:n}=(0,a.X)(),r="dark"===t;return(0,u.A)([["mod + U",()=>{n()}]]),m.createElement(l.A,{variant:"default",size:e.btn,onClick:()=>{n()},title:`切换主题 (${(0,f.Qh)()} + U)`,my:"auto"},r?m.createElement(o.Z,{size:e.sz,color:"yellow"}):m.createElement(s.Z,{size:e.sz,color:"blue"}))}function v(e){const[t,{open:n,close:r}]=(0,p.q)(!1);return m.createElement(m.Fragment,null,m.createElement(d.F,{opened:t,close:r}),m.createElement(l.A,{size:e.btn,onClick:n,title:"版本信息",ml:"auto",my:"auto"},m.createElement(i.Z,{size:e.sz})))}function b(e){const{toggle:t}=(0,h.V1)();return(0,u.A)([["mod + =",()=>{t()}]]),m.createElement(l.A,{variant:"default",size:e.btn,onClick:()=>{t()},title:`调整字体大小 (${(0,f.Qh)()} + =)`,my:"auto"},m.createElement(c.Z,{width:"1.1rem",height:"1.1rem",fill:"currentColor"}))}[d,h]=E.then?(await E)():E,r()}catch(w){r(w)}}))},9872:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>$,n:()=>Z});var a=n(1972),l=n(391),o=n(4082),s=n(4128),i=n(4340),c=n(2691),m=n(3515),d=n(4168),u=n(1425),p=n(5918),f=n(1938),h=n(7294),E=n(3570),g=n(8328),v=n(8645),b=n(7129),w=n(2298),y=n(6146),C=n(3847),k=n(8913),S=n(9362),x=n(1535),T=n(9672),I=e([E,k,C,w]);[E,k,C,w]=I.then?(await I)():I;const{TAURI:z,dialogOpen:D,invoke:M}=await Promise.resolve().then(n.bind(n,4637));function R(e){const t=(0,v.Z2)();return h.createElement(h.Fragment,null,h.createElement(E.Es,{...e.location,inputLabel:"保存目录",disabled:e.disabled}),t>=17&&h.createElement(E.tx,{labels:e.labels,setLabels:e.setLabels,inputLabel:"用户标签",disabled:e.disabled}),e.isMagnet&&h.createElement(a.Z,{mt:"lg"},h.createElement(l.X,{my:"xl",pr:"xl",label:"种子下载间隔",checked:e.delay,onChange:()=>{e.setDelay(!e.delay)}}),h.createElement(o.Y,{w:"5rem",min:0,disabled:!e.delay,value:e.delayTime,onChange:t=>{e.setDelayTime("number"==typeof t?t:5)}}),"秒"),h.createElement(a.Z,null,h.createElement(l.X,{label:"自动开始",checked:e.start,disabled:e.disabled,onChange:t=>{e.setStart(t.currentTarget.checked)},my:"md",styles:{root:{flexGrow:1}}}),e.children,h.createElement(s.s,{color:g.vw.get(e.priority),value:String(e.priority),onChange:t=>{e.setPriority(+t)},disabled:e.disabled,data:Array.from(g.yN.entries()).map((([e,t])=>({value:String(e),label:t})))})))}function P(){const e=(0,E.KD)(),[t,n]=(0,h.useState)([]),[r,a]=(0,h.useState)(!1),[l,o]=(0,h.useState)(0),[s,i]=(0,h.useState)(!1),[c,m]=(0,h.useState)(5),d=(0,h.useMemo)((()=>({location:e,labels:t,setLabels:n,start:r,setStart:a,priority:l,setPriority:o,delay:s,setDelay:i,delayTime:c,setDelayTime:m})),[e,t,r,l,s,c]);return(0,h.useMemo)((()=>({location:e,start:r,priority:l,props:d})),[e,l,d,r])}function F({tabsRef:e}){const t=(0,h.useContext)(k.Dk),[n,r]=(0,h.useState)(t.name);(0,h.useEffect)((()=>{r(t.name)}),[t]);const a=(0,h.useCallback)((t=>{r(t);const n=e.current?.getOpenTabs().findIndex((e=>e===t));void 0!==n&&e.current?.switchTab(n)}),[e]);return null==e.current?h.createElement(h.Fragment,null):h.createElement(i.v,{shadow:"md",width:200,position:"bottom-start"},h.createElement(i.v.Target,null,h.createElement(c.z,{variant:"subtle",title:"选择服务器"},n)),h.createElement(i.v.Dropdown,null,e.current.getOpenTabs().map((e=>h.createElement(i.v.Item,{key:e,onClick:()=>{a(e)}},e)))))}function Z(e){const t=(0,v.EL)(),[n,r]=(0,h.useState)("");(0,h.useEffect)((()=>{if(e.opened){const t=e.uris?.[0];r("string"==typeof t?t:"")}}),[e.uris,e.opened]);const[l,o]=(0,h.useState)();(0,h.useEffect)((()=>{o((0,S.V6)(n))}),[n]);const[s,i]=(0,h.useState)();(0,h.useEffect)((()=>{if(void 0!==l&&""!==l.hash){const e=t.torrents.find((e=>e.hashString===l.hash));i(e)}else i(void 0)}),[t,e.serverName,l]);const p=P(),{close:f}=e,g=(0,C.Pd)((0,h.useCallback)((e=>{const t=e.arguments["torrent-duplicate"];void 0!==t&&y.N9.show({title:"种子已经存在",message:t.name,color:"green"});const n=e.arguments["torrent-added"];void 0!==n&&y.N9.show({title:"种子已添加",message:n.name,color:"green"})}),[]),(0,h.useCallback)((e=>{console.error("种子添加失败:",e),y.N9.show({title:"种子添加失败",message:String(e),color:"red"})}),[])),b=(0,C.Re)(),w=(0,h.useCallback)((()=>{const t=n.split("\n");let a=[];if(t.forEach((e=>{""!==(e=(0,T.Z)(e))&&a.push(e)})),0===a.length)return;let o=1;if(e.setStatus(new x.V(!1,"准备下载",a.map((e=>o+++": "+e)).join("\n"))),void 0===s){let t=[],n=1;a.forEach((r=>{t.push((()=>new Promise(((t,l)=>{const o="队列下载中 "+n+"/"+a.length,s=n>=a.length;n++,e.setStatus(new x.V(!1,o));const i=()=>{if(s||!p.props.delay||p.props.delayTime<=0)t();else{let n=p.props.delayTime,r=setInterval((()=>{e.setStatus(new x.V(!1,o+" - 等待 "+n+" 秒")),0==n--&&(clearInterval(r),t())}),1e3)}};g.mutate({url:(0,T.Z)(r),downloadDir:p.location.path,labels:p.props.labels,paused:!p.start,priority:p.priority},{onSuccess:i,onError:i})}))))})),t.reduce(((e,t)=>e.then(t)),Promise.resolve()).then((()=>{e.setStatus(new x.V(!1,"队列下载完成")),setTimeout((()=>e.setStatus(new x.V(!0))),3e3)})),p.location.addPath(p.location.path)}else b({torrentId:s.id,trackers:l?.trackers??[]},{onSuccess:()=>{y.N9.show({message:"服务器 Tracker 更新",color:"green"})}});r(""),f()}),[s,f,g,n,p,b,l,e.setStatus]),I=!(0,h.useContext)(k.E_).values.interface.skipAddDialog||"string"!=typeof e.uris?.[0];return(0,h.useEffect)((()=>{e.opened&&!I&&w()}),[w,e.opened,I]),h.createElement(h.Fragment,null,e.opened&&I&&h.createElement(E.zF,{opened:!0,onClose:f,centered:!0,size:"xl",styles:{title:{flexGrow:1}},title:h.createElement(m.k,{w:"100%",align:"center",justify:"space-between"},h.createElement("span",null,"添加种子磁力链接或者URL"),z&&h.createElement(F,{tabsRef:e.tabsRef}))},h.createElement(d.i,{my:"sm"}),h.createElement(u.g,{minRows:10,wrap:"off",style:{overflow:"auto"},label:"磁力链接或者URL，一行一个",w:"100%",value:n,onChange:e=>{r(e.currentTarget.value)},error:void 0===s?void 0:"种子已存在"}),h.createElement(R,{...p.props,isMagnet:!0,disabled:void 0!==s}),h.createElement(d.i,{my:"sm"}),h.createElement(a.Z,{position:"center",spacing:"md"},h.createElement(c.z,{onClick:w,variant:"filled",disabled:void 0!==s&&0===(l?.trackers.length??0)},void 0===s?"添加":"添加 Tracker"),h.createElement(c.z,{onClick:e.close,variant:"light"},"取消"))))}async function N(e){return await new Promise((t=>{const n=new FileReader;n.onloadend=()=>{const e=n.result.match(/data:[^/]*\/[^;]*;base64,(.*)/)?.[1];if(void 0===e)throw Error("读取文件错误");t(e)},n.readAsDataURL(e)}))}function A(e,t,n){(0,h.useEffect)((()=>{if(z&&e.opened&&void 0===t){const t=async e=>{if(null!=e)return Array.isArray(e)?await Promise.all(e.map((async e=>await M("read_file",{path:e})))):[await M("read_file",{path:e})]};let r=new Array;e.uris?.forEach((e=>{"string"==typeof e&&(e.startsWith("file://")?r.push(decodeURIComponent(e.substring(7))):r.push(e))})),(r.length>0?Promise.resolve(r):D({title:"选择种子文件",filters:[{name:"Torrent(种子文件)",extensions:["torrent"]}],multiple:!0})).then(t).then((t=>{n(t),void 0===t&&e.close()})).catch((t=>{y.N9.show({title:"读取种子失败",message:String(t),color:"red"}),e.close()}))}}),[e,n,t])}function L(e,t,n,r){(0,h.useEffect)((()=>{if(!z&&e.opened)if(void 0===e.uris||e.uris?.length<=0)null!=t.current&&(t.current.value="",t.current.click()),n();else{const t=e.uris;Promise.all(t.map(N)).then((e=>{r(e.map(((e,n)=>({torrentPath:"",metadata:e,name:t[n].name,hash:"",files:null,trackers:[],length:0}))))})).catch((e=>{y.N9.show({title:"读取文件失败",message:e,color:"red"}),n()}))}}),[e.opened,e.uris,n,t,r])}function O(e,t,n){(0,h.useEffect)((()=>{const r=e.current,a=e=>{const r=e.target;if(null==r.files)t();else{const e=[...r.files];Promise.all(e.map(N)).then((t=>{n(t.map(((t,n)=>({torrentPath:"",metadata:t,name:e[n].name,hash:"",files:null,trackers:[],length:0}))))})).catch((e=>{y.N9.show({title:"读取文件失败",message:e,color:"red"}),t()}))}};return z||r?.addEventListener("change",a),()=>{z||r?.removeEventListener("change",a)}}),[t,e,n])}function $(e){const t=(0,h.useContext)(k.E_),n=(0,v.EL)(),r=P(),[l,o]=(0,h.useState)(),s=(0,h.useMemo)((()=>{if(void 0!==l&&1===l.length)return n.torrents.find((e=>e.hashString===l[0].hash))}),[n.torrents,l]),{close:i}=e,u=(0,h.useRef)(null);O(u,i,o),L(e,u,i,o),A(e,l,o);const g=(0,h.useMemo)((()=>new b.l(l?.[0]?.hash??"",-1)),[l]),[x,T]=(0,h.useState)(0),{data:I,refetch:D}=(0,C.f$)("filetreebrief",g);(0,h.useEffect)((()=>{if(void 0!==l)if(1===l.length&&null!=l[0].files)g.parse(l[0],!0),T(g.getWantedSize()),D();else{const e=l.reduce(((e,{length:t})=>e+t),0);T(e)}}),[l,g,D]);const Z=(0,w.R)(g,!1),N=(0,h.useCallback)(((e,t)=>{Z(e,t),T(g.getWantedSize())}),[g,Z]),$=(0,h.useCallback)((e=>{N(g.tree.fullpath,e),D()}),[g,N,D]),q=(0,C.Pd)((0,h.useCallback)(((e,n)=>{const r=e.arguments["torrent-duplicate"];void 0!==r&&y.N9.show({title:"种子已存在",message:r.name,color:"green"});const a=e.arguments["torrent-added"];void 0!==a&&y.N9.show({title:"种子已添加",message:a.name,color:"green"}),z&&t.values.app.deleteAdded&&void 0!==n.filePath&&M("remove_file",{path:n.filePath})}),[t.values.app.deleteAdded]),(0,h.useCallback)((e=>{console.error("种子添加失败:",e),y.N9.show({title:"种子添加失败",message:String(e),color:"red"})}),[])),U=(0,C.Re)(),V=(0,h.useCallback)((()=>{void 0!==l&&(void 0===s?(Promise.all(l.map((async e=>await q.mutateAsync({metainfo:e.metadata,downloadDir:r.location.path,labels:r.props.labels,paused:!r.start,priority:r.priority,unwanted:null==e.files||l.length>1?void 0:g.getUnwanted(),filePath:e.torrentPath})))),r.location.addPath(r.location.path)):U({torrentId:s.id,trackers:l[0].trackers},{onSuccess:()=>{y.N9.show({message:"服务器 Tracker 更新",color:"green"})},onSettled:()=>{z&&t.values.app.deleteAdded&&void 0!==l[0].torrentPath&&M("remove_file",{path:l[0].torrentPath})}}),o(void 0),i())}),[l,s,i,r,q,g,U,t]),_=!t.values.interface.skipAddDialog&&void 0!==l;(0,h.useEffect)((()=>{void 0===l||_||V()}),[V,l,_]);const j=(0,h.useCallback)((()=>{o(void 0),i()}),[i]),W=(0,h.useMemo)((()=>void 0===l?[]:l.map((e=>e.name))),[l]),G=void 0!==s;return h.createElement(h.Fragment,null,!z&&h.createElement("input",{ref:u,type:"file",accept:".torrent",multiple:!0,style:{position:"absolute",top:"-20rem",zIndex:-1}}),_&&h.createElement(E.zF,{opened:!0,onClose:j,centered:!0,size:"xl",styles:{title:{flexGrow:1}},title:h.createElement(m.k,{w:"100%",align:"center",justify:"space-between"},h.createElement("span",null,"添加种子文件"),z&&h.createElement(F,{tabsRef:e.tabsRef}))},h.createElement(d.i,{my:"sm"}),G?h.createElement(p.x,{color:"red",fw:"bold",fz:"lg"},"种子已存在"):h.createElement(E.gO,{names:W,limit:5}),h.createElement("div",{style:{position:"relative"}},h.createElement(R,{...r.props,disabled:G},(x>0||null!=l[0].files)&&h.createElement(p.x,null,(0,S.Iy)(x)),l.length>1||null==l[0].files?h.createElement(h.Fragment,null):h.createElement(h.Fragment,null,h.createElement(c.z,{variant:"subtle",disabled:G,onClick:()=>{$(!0)},title:"选中所有文件"},"全选"),h.createElement(c.z,{variant:"subtle",disabled:G,onClick:()=>{$(!1)},title:"取消选中所有文件"},"全不选"))),l.length>1||null==l[0].files?h.createElement(h.Fragment,null):h.createElement(f.x,{w:"100%",h:"15rem"},h.createElement(w.r,{fileTree:g,data:I,brief:!0,onCheckboxChange:N}))),h.createElement(d.i,{my:"sm"}),h.createElement(a.Z,{position:"center",spacing:"md"},h.createElement(c.z,{onClick:V,variant:"filled","data-autofocus":!0,disabled:G&&0===l[0].trackers.length},G?"添加 Tracker":"添加"),h.createElement(c.z,{onClick:j,variant:"light"},"取消"))))}r()}catch(q){r(q)}}),1)},5488:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{$:()=>A});var a=n(7532),l=n(5918),o=n(4082),s=n(61),i=n(391),c=n(9538),m=n(2691),d=n(3330),u=n(3833),p=n(1972),f=n(1938),h=n(5663),E=n(384),g=n(8913),v=n(7294),b=n(3570),w=n(3847),y=n(6848),C=n(6146),k=n(8515),S=e([w,g,b,k]);[w,g,b,k]=S.then?(await S)():S;const{TAURI:x}=await Promise.resolve().then(n.bind(n,4637));function T({form:e}){return v.createElement(a.r,{align:"center"},v.createElement(a.r.Col,{span:12},v.createElement(l.x,null,"更新间隔设置 (秒)")),v.createElement(a.r.Col,{span:8},"会话更新"),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:1,max:3600,...e.getInputProps("intervals.session")})),v.createElement(a.r.Col,{span:2}),v.createElement(a.r.Col,{span:8},"种子详情"),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:1,max:3600,...e.getInputProps("intervals.details")})),v.createElement(a.r.Col,{span:2}),v.createElement(a.r.Col,{span:8},"活动种子"),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:1,max:3600,...e.getInputProps("intervals.torrents")})),v.createElement(a.r.Col,{span:2}),v.createElement(a.r.Col,{span:8},"未活动种子"),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:1,max:3600,...e.getInputProps("intervals.torrentsMinimized")})),v.createElement(a.r.Col,{span:2}))}function I({form:e,session:t}){return v.createElement(a.r,{align:"center"},v.createElement(a.r.Col,null,v.createElement(s.o,{label:"默认保存目录",...e.getInputProps("session.download-dir")})),v.createElement(a.r.Col,null,v.createElement(i.X,{label:"在未完成的文件名后加上“.part”后缀",...e.getInputProps("session.rename-partial-files",{type:"checkbox"})})),v.createElement(a.r.Col,null,v.createElement(i.X,{label:"启用临时目录",...e.getInputProps("session.incomplete-dir-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,null,v.createElement(s.o,{label:"临时目录",...e.getInputProps("session.incomplete-dir"),disabled:!0!==t["incomplete-dir-enabled"]})),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"默认分享率上限",...e.getInputProps("session.seedRatioLimited",{type:"checkbox"})})),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:0,precision:2,step:.05,...e.getInputProps("session.seedRatioLimit"),disabled:!0!==t.seedRatioLimited})),v.createElement(a.r.Col,{span:4}),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"默认停止无流量种子持续时间",...e.getInputProps("session.idle-seeding-limit-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:0,...e.getInputProps("session.idle-seeding-limit"),disabled:!0!==t["idle-seeding-limit-enabled"]})),v.createElement(a.r.Col,{span:4},"分钟"),v.createElement(a.r.Col,{span:6},"磁盘缓存大小"),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:0,...e.getInputProps("session.cache-size-mb")})),v.createElement(a.r.Col,{span:4},"MB"))}function z({opened:e,form:t,session:n}){const[r,p]=(0,v.useState)(!1),[f,h]=(0,v.useState)({label:"",color:"green"}),{data:E,status:g,fetchStatus:b,remove:y}=(0,w.XE)(r),k=(0,v.useCallback)((()=>{p(!0)}),[p]);(0,v.useEffect)((()=>{"fetching"!==b&&p(!1),h("success"===g?!0===E.arguments["port-is-open"]?{label:"端口连接成功",color:"green"}:{label:"端口不可连接",color:"red"}:"loading"===g?{label:"",color:"green"}:{label:"API 错误",color:"red"})}),[b,g,E]),(0,v.useEffect)((()=>{e||(h({label:"",color:"green"}),y())}),[e,h,y]);const{mutate:S,isLoading:x}=(0,w.ir)(),T=(0,v.useCallback)((()=>{S(void 0,{onError:e=>{console.log(e),C.N9.show({title:"更新黑名单列表失败",message:e.message,color:"red"})}})}),[S]);return v.createElement(a.r,{align:"center"},v.createElement(a.r.Col,{span:3},"连接端口号:"),v.createElement(a.r.Col,{span:3},v.createElement(o.Y,{min:1,max:65535,...t.getInputProps("session.peer-port"),disabled:!0===n["peer-port-random-on-start"]})),v.createElement(a.r.Col,{span:3},v.createElement(c.u,{withArrow:!0,label:"如果更改了端口，测试前请先进行保存。"},v.createElement(m.z,{w:"100%",onClick:k},"测试端口"))),v.createElement(a.r.Col,{span:3},"fetching"===b?v.createElement(d.a,{key:"pt",size:"1.5rem"}):v.createElement(l.x,{key:"pt",color:f.color},f.label)),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"启用随机端口",...t.getInputProps("session.peer-port-random-on-start",{type:"checkbox"})})),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"启用端口转发(UPnP)",...t.getInputProps("session.port-forwarding-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:3},"加密:"),v.createElement(a.r.Col,{span:3},v.createElement(u.p,{data:[{value:"tolerated",label:"允许加密"},{value:"preferred",label:"优先加密"},{value:"required",label:"强制加密"}],...t.getInputProps("session.encryption")})),v.createElement(a.r.Col,{span:6}),v.createElement(a.r.Col,{span:3},"全局最大链接数:"),v.createElement(a.r.Col,{span:3},v.createElement(o.Y,{min:0,...t.getInputProps("session.peer-limit-global")})),v.createElement(a.r.Col,{span:3},"单种最大链接数:"),v.createElement(a.r.Col,{span:3},v.createElement(o.Y,{min:0,...t.getInputProps("session.peer-limit-per-torrent")})),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"启用用户交换",...t.getInputProps("session.pex-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"启用分布式哈希表(DHT)",...t.getInputProps("session.dht-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"启用本地用户发现(LPD)",...t.getInputProps("session.lpd-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"启用带宽管理(µTP)",...t.getInputProps("session.utp-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"启用黑名单列表:",...t.getInputProps("session.blocklist-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:6},v.createElement(s.o,{...t.getInputProps("session.blocklist-url"),disabled:!0!==n["blocklist-enabled"]})),v.createElement(a.r.Col,{span:6},v.createElement(l.x,null,"可用规则数量 ",n["blocklist-size"]," 条")),v.createElement(a.r.Col,{span:3},v.createElement(c.u,{withArrow:!0,label:"如果有修改内容，更新之前先进行保存。"},v.createElement(m.z,{w:"100%",onClick:T,title:""},"更新黑名单"))),v.createElement(a.r.Col,{span:3},x&&v.createElement(d.a,{size:"1.5rem"})))}function D(e){const t=parseInt(e);return String(Math.floor(t/60)).padStart(2,"0")+":"+String(t%60).padStart(2,"0")}function M(e){const t=e.split(":");if(2!==t.length)return"";const n=parseInt(t[0]),r=parseInt(t[1]);return isNaN(n)||isNaN(r)?"":`${60*n+r}`}function R(e){return v.createElement(o.Y,{...e,parser:M,formatter:D})}const P=["星期天","星期一","星期二","星期三","星期四","星期五","星期六"];function F({form:e,day:t,session:n}){return v.createElement(i.X,{label:P[t],checked:(n["alt-speed-time-day"]&1<<t)>0,onChange:r=>{const a=n["alt-speed-time-day"];e.setFieldValue("session.alt-speed-time-day",r.currentTarget.checked?a|1<<t:a&~(1<<t))},disabled:!0!==n["alt-speed-time-enabled"]})}function Z({form:e,session:t}){return v.createElement(a.r,{align:"center"},v.createElement(a.r.Col,{span:6}),v.createElement(a.r.Col,{span:3},"正常"),v.createElement(a.r.Col,{span:3},"备用"),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"最大下载速度 (KB/s):",...e.getInputProps("session.speed-limit-down-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:3},v.createElement(o.Y,{min:0,...e.getInputProps("session.speed-limit-down"),disabled:!0!==t["speed-limit-down-enabled"]})),v.createElement(a.r.Col,{span:3},v.createElement(o.Y,{min:0,...e.getInputProps("session.alt-speed-down")})),v.createElement(a.r.Col,{span:6},v.createElement(i.X,{label:"最大上传速度 (KB/s):",...e.getInputProps("session.speed-limit-up-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:3},v.createElement(o.Y,{min:0,...e.getInputProps("session.speed-limit-up"),disabled:!0!==t["speed-limit-up-enabled"]})),v.createElement(a.r.Col,{span:3},v.createElement(o.Y,{min:0,...e.getInputProps("session.alt-speed-up")})),v.createElement(a.r.Col,null,v.createElement(i.X,{label:"启用备用带宽",...e.getInputProps("session.alt-speed-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,null,v.createElement(i.X,{label:"自动启用备用带宽设置(时间段内)",...e.getInputProps("session.alt-speed-time-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:1},"从:"),v.createElement(a.r.Col,{span:3},v.createElement(R,{min:0,max:1439,...e.getInputProps("session.alt-speed-time-begin"),disabled:!0!==t["alt-speed-time-enabled"]})),v.createElement(a.r.Col,{span:1},"到:"),v.createElement(a.r.Col,{span:3},v.createElement(R,{min:0,max:1439,...e.getInputProps("session.alt-speed-time-end"),disabled:!0!==t["alt-speed-time-enabled"]})),v.createElement(a.r.Col,{span:2}),v.createElement(a.r.Col,{span:12},v.createElement(p.Z,null,P.map(((n,r)=>v.createElement(F,{key:r,form:e,day:r,session:t}))))))}function N({form:e,session:t}){return v.createElement(a.r,{align:"center"},v.createElement(a.r.Col,{span:8},v.createElement(i.X,{label:"启用下载队列，最大同时下载数",...e.getInputProps("session.download-queue-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:0,...e.getInputProps("session.download-queue-size"),disabled:!0!==t["download-queue-enabled"]})),v.createElement(a.r.Col,{span:2}),v.createElement(a.r.Col,{span:8},v.createElement(i.X,{label:"启用上传队列，最大同时上传数",...e.getInputProps("session.seed-queue-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:0,...e.getInputProps("session.seed-queue-size"),disabled:!0!==t["seed-queue-enabled"]})),v.createElement(a.r.Col,{span:2}),v.createElement(a.r.Col,{span:8},v.createElement(i.X,{label:"种子超过该时间无流量，移出队列",...e.getInputProps("session.queue-stalled-enabled",{type:"checkbox"})})),v.createElement(a.r.Col,{span:2},v.createElement(o.Y,{min:0,...e.getInputProps("session.queue-stalled-minutes"),disabled:!0!==t["queue-stalled-enabled"]})),v.createElement(a.r.Col,{span:2},"分钟"))}function A(e){const{data:t,fetchStatus:n}=(0,w.tY)(e.opened),r=(0,w.Zx)(),a=(0,v.useContext)(g.E_),l=(0,v.useContext)(g.Dk),o=(0,y.c)({initialValues:{intervals:l.intervals,session:t,interface:a.values.interface}});(0,v.useEffect)((()=>{o.setFieldValue("session",t)}),[t]);const s=(0,v.useCallback)((()=>{l.intervals={...o.values.intervals},a.values.interface={...a.values.interface,...o.values.interface},void 0!==o.values.session?r.mutate(o.values.session,{onSuccess:()=>{C.N9.show({message:"配置保存成功",color:"green"}),e.close()},onError:e=>{C.N9.show({title:"配置保存失败",message:String(e),color:"red"})}}):e.close()}),[o.values,r,e,a,l]);return v.createElement(b.Fj,{opened:e.opened,size:"lg",onClose:e.close,onSave:s,saveLoading:r.isLoading,centered:!0,title:"参数设置"},v.createElement(f.x,{pos:"relative"},v.createElement(h.f,{visible:"fetching"===n,overlayBlur:2}),v.createElement(E.m,{defaultValue:"polling",mih:"25rem"},v.createElement(E.m.List,null,v.createElement(E.m.Tab,{value:"polling",p:"lg"},"轮询设置"),v.createElement(E.m.Tab,{value:"download",p:"lg"},"下载设置"),v.createElement(E.m.Tab,{value:"network",p:"lg"},"网络设置"),v.createElement(E.m.Tab,{value:"bandwidth",p:"lg"},"带宽设置"),v.createElement(E.m.Tab,{value:"queue",p:"lg"},"队列设置"),!x&&v.createElement(E.m.Tab,{value:"interface",p:"lg"},"其他设置")),void 0!==o.values.session?v.createElement(v.Fragment,null,v.createElement(E.m.Panel,{value:"polling",pt:"md"},v.createElement(T,{form:o})),v.createElement(E.m.Panel,{value:"download",pt:"md"},v.createElement(I,{form:o,session:o.values.session})),v.createElement(E.m.Panel,{value:"network",pt:"md"},v.createElement(z,{opened:e.opened,form:o,session:o.values.session})),v.createElement(E.m.Panel,{value:"bandwidth",pt:"md"},v.createElement(Z,{form:o,session:o.values.session})),v.createElement(E.m.Panel,{value:"queue",pt:"md"},v.createElement(N,{form:o,session:o.values.session})),!x&&v.createElement(E.m.Panel,{value:"interface",pt:"md"},v.createElement(k.Q,{form:o}))):v.createElement(v.Fragment,null))))}r()}catch(L){r(L)}}),1)},3043:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{a:()=>u});var a=n(5918),l=n(1938),o=n(3570),s=n(7294),i=n(3847),c=n(6146),m=n(8645),d=e([i,o]);function u(e){const{opened:t,close:n}=e,r=(0,m.EL)(),d=(0,m.uM)(),u=(0,m.Z2)(),[p,f]=(0,s.useState)([]),h=(0,s.useCallback)((()=>{const e=r.torrents.filter((e=>d.has(e.id)))??[],t=[];return e.forEach((e=>e.labels?.forEach((e=>{t.includes(e)||t.push(e)})))),t}),[r.torrents,d]);(0,s.useEffect)((()=>{t&&f(h())}),[h,t]);const{mutate:E}=(0,i.n5)(),g=(0,s.useCallback)((()=>{if(u<16)return c.N9.show({title:"用户标签设置失败",message:"用户标签设置仅支持 >= transmission 3.0",color:"red"}),void n();E({torrentIds:Array.from(d),fields:{labels:p}},{onSuccess:()=>{c.N9.show({message:"用户标签已更新",color:"green"})},onError:e=>{c.N9.show({title:"用户标签设置失败",message:String(e),color:"red"})}}),n()}),[u,E,d,p,n]);return s.createElement(s.Fragment,null,e.opened&&s.createElement(o.Fj,{opened:e.opened,size:"xl",onClose:e.close,onSave:g,centered:!0,title:"修改用户标签"},u<16?s.createElement(a.x,{color:"red",fz:"lg"},"标签功能仅支持 transmission 3.0 或以上版本"):s.createElement(s.Fragment,null,s.createElement(a.x,{mb:"md"},"输入新的用户标签"),s.createElement(o.nW,null)),s.createElement(l.x,{mih:"17rem"},s.createElement(o.tx,{labels:p,setLabels:f,disabled:u<16,initiallyOpened:!0}))))}[i,o]=d.then?(await d)():d,r()}catch(p){r(p)}}))},9298:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{Z:()=>h});var a=n(7294),l=n(3570),o=n(6848),s=n(3847),i=n(6146),c=n(5663),m=n(7532),d=n(391),u=n(4082),p=n(8645),f=e([s,l]);function h(e){const t=(0,p.Z2)(),n=(0,p.EL)(),r=(0,p.uM)(),f=(0,a.useMemo)((()=>void 0!==n.current&&r.has(n.current)?n.current:[...r][0]),[r,n]),{data:h,isLoading:E}=(0,s.if)(f??-1,void 0!==f&&e.opened,!1,!0),g=(0,o.c)({}),{setValues:v}=g;(0,a.useEffect)((()=>{void 0!==h&&v({downloadLimited:h.downloadLimited,downloadLimit:h.downloadLimit,uploadLimited:h.uploadLimited,uploadLimit:h.uploadLimit,peerLimit:h["peer-limit"],seedRatioMode:h.seedRatioMode,seedRatioLimit:h.seedRatioLimit,seedIdleMode:h.seedIdleMode,seedIdleLimit:h.seedIdleLimit,honorsSessionLimits:h.honorsSessionLimits,sequentialDownload:h.sequentialDownload})}),[v,h]);const{mutate:b}=(0,s.n5)(),w=(0,a.useCallback)((()=>{void 0!==f&&void 0!==h&&(b({torrentIds:[...r],fields:{...g.values,"peer-limit":g.values.peerLimit}},{onError:e=>{console.error("Failed to update torrent properties",e),i.N9.show({message:"Error updating torrent",color:"red"})}}),e.close())}),[f,h,b,r,g.values,e]);return a.createElement(a.Fragment,null,e.opened&&a.createElement(l.Fj,{opened:e.opened,size:"xl",onClose:e.close,onSave:w,centered:!0,title:"修改限速等限制属性",mih:"25rem"},a.createElement(c.f,{visible:E}),a.createElement(m.r,{align:"center"},a.createElement(m.r.Col,null,a.createElement(l.nW,null)),a.createElement(m.r.Col,{span:8},a.createElement(d.X,{my:"sm",label:"使用全局上传限制",...g.getInputProps("honorsSessionLimits",{type:"checkbox"})})),a.createElement(m.r.Col,{span:4},t>=18&&a.createElement(d.X,{my:"sm",label:"顺序下载",...g.getInputProps("sequentialDownload",{type:"checkbox"})})),a.createElement(m.r.Col,{span:8},a.createElement(d.X,{label:"启用最大下载速度限制",...g.getInputProps("downloadLimited",{type:"checkbox"})})),a.createElement(m.r.Col,{span:2},a.createElement(u.Y,{min:0,...g.getInputProps("downloadLimit"),disabled:!0!==g.values.downloadLimited})),a.createElement(m.r.Col,{span:2},"KB/s"),a.createElement(m.r.Col,{span:8},a.createElement(d.X,{label:"启用最大上传速度限制",...g.getInputProps("uploadLimited",{type:"checkbox"})})),a.createElement(m.r.Col,{span:2},a.createElement(u.Y,{min:0,...g.getInputProps("uploadLimit"),disabled:!0!==g.values.uploadLimited})),a.createElement(m.r.Col,{span:2},"KB/s"),a.createElement(m.r.Col,{span:8},"最大链接数"),a.createElement(m.r.Col,{span:2},a.createElement(u.Y,{min:0,...g.getInputProps("peerLimit")})),a.createElement(m.r.Col,{span:2}),a.createElement(m.r.Col,{span:8},a.createElement(d.X,{label:"分享率达到这个数时，自动停止做种",checked:g.values.seedRatioMode<2,indeterminate:0===g.values.seedRatioMode,onChange:()=>{g.setFieldValue("seedRatioMode",(g.values.seedRatioMode+1)%3)}})),a.createElement(m.r.Col,{span:2},a.createElement(u.Y,{min:0,step:.05,precision:2,...g.getInputProps("seedRatioLimit"),disabled:1!==g.values.seedRatioMode})),a.createElement(m.r.Col,{span:2}),a.createElement(m.r.Col,{span:8},a.createElement(d.X,{label:"超过这个时间没有流量时，自动停止做种",checked:g.values.seedIdleMode<2,indeterminate:0===g.values.seedIdleMode,onChange:()=>{g.setFieldValue("seedIdleMode",(g.values.seedIdleMode+1)%3)}})),a.createElement(m.r.Col,{span:2},a.createElement(u.Y,{min:0,...g.getInputProps("seedIdleLimit"),disabled:1!==g.values.seedIdleMode})),a.createElement(m.r.Col,{span:2},"分钟"))))}[s,l]=f.then?(await f)():f,r()}catch(E){r(E)}}))},216:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{m:()=>g});var a=n(7294),l=n(3570),o=n(6848),s=n(3847),i=n(6146),c=n(5663),m=n(7532),d=n(5918),u=n(2691),p=n(1425),f=n(8913),h=n(8645),E=e([f,s,l]);function g(e){const t=(0,h.Z2)(),n=(0,a.useContext)(f.E_),r=(0,h.EL)(),E=(0,h.uM)(),g=(0,a.useMemo)((()=>void 0!==r.current&&E.has(r.current)?r.current:[...E][0]),[E,r]),{data:v,isLoading:b}=(0,s.if)(g??-1,void 0!==g&&e.opened,!1,!0),w=(0,o.c)({}),{setValues:y}=w;(0,a.useEffect)((()=>{void 0!==v&&y({trackerList:t>=17?v.trackerList:v.trackerStats.map((e=>e.announce)).join("\n")})}),[t,y,v]);const{mutate:C}=(0,s.n5)(),k=(0,a.useCallback)((()=>{if(void 0===g||void 0===v)return;const n=[];for(const e of w.values.trackerList.split("\n"))""!==e&&n.includes(e)||""===e&&0===n.length||""===e&&""===n[n.length-1]||n.push(e);let r,a;if(t<17){const e=n.filter((e=>""!==e)),t=Object.fromEntries(v.trackerStats.map((e=>[e.announce,e.id])));r=e.filter((e=>!Object.prototype.hasOwnProperty.call(t,e))),a=v.trackerStats.filter((t=>!e.includes(t.announce))).map((e=>e.id)),0===r.length&&(r=void 0),0===a.length&&(a=void 0)}C({torrentIds:[...E],fields:{trackerList:n.join("\n"),trackerAdd:r,trackerRemove:a}},{onError:e=>{console.error("Failed to update torrent properties",e),i.N9.show({message:"Error updating torrent",color:"red"})}}),e.close()}),[g,v,t,C,E,w.values,e]),S=(0,a.useCallback)((()=>{let e=w.values.trackerList;e.endsWith("\n")||(e+="\n"),e+=n.values.interface.defaultTrackers.join("\n"),w.setFieldValue("trackerList",e)}),[n,w]);return a.createElement(a.Fragment,null,e.opened&&a.createElement(l.Fj,{opened:e.opened,size:"xl",onClose:e.close,onSave:k,centered:!0,title:"修改种子Tracker",h:"25rem"},a.createElement(c.f,{visible:b}),a.createElement(m.r,{align:"center"},a.createElement(m.r.Col,null,a.createElement(l.nW,null)),a.createElement(m.r.Col,{span:8},a.createElement(d.x,null,"Tracker列表，一行一个")),a.createElement(m.r.Col,{span:4},a.createElement(u.z,{onClick:S},"追加默认Trackers")),a.createElement(m.r.Col,null,a.createElement(p.g,{minRows:10,wrap:"off",style:{overflow:"auto"},...w.getInputProps("trackerList")})))))}[f,s,l]=E.then?(await E)():E,r()}catch(v){r(v)}}))},8515:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{Q:()=>w});var a=n(7294),l=n(6172),o=n(7532),s=n(3833),i=n(391),c=n(4082),m=n(5686),d=n(1425),u=n(7300),p=n(4476),f=n(8913),h=n(6612),E=n(3570),g=e([p,h,f,E]);[p,h,f,E]=g.then?(await g)():g;const{TAURI:v,invoke:b}=await Promise.resolve().then(n.bind(n,4637));function w(e){const t=(0,l.rZ)(),{style:n,setStyle:r}=(0,p.H6)(),[g,w]=(0,a.useState)(["Default"]);(0,a.useEffect)((()=>{v?b("list_system_fonts").then((e=>{e.sort(),w(["Default"].concat(e))})).catch(console.error):w(["Default","Arial","Verdana","Tahoma","Roboto","Helvetica","Lucida Family","Trebuchet MS","Georgia","Times","仿宋","华文中宋","华文仿宋","华文宋体","华文楷体","华文黑体","华文细黑","宋体","微软雅黑","微软雅黑 Light","新宋体","方正粗黑宋简体","楷体","黑体","等线","等线 Light"])}),[]);const{setFieldValue:y}=e.form;(0,a.useEffect)((()=>{y("interface.theme",t.colorScheme)}),[y,t]);const C=(0,a.useCallback)((e=>{const a={dark:{...n.dark},light:{...n.light},font:n.font};a[t.colorScheme].color=e,r(a),y("interface.styleOverrides",a)}),[n,t.colorScheme,r,y]),k=(0,a.useCallback)((e=>{const a={dark:{...n.dark},light:{...n.light},font:n.font};a[t.colorScheme].backgroundColor=e,r(a),y("interface.styleOverrides",a)}),[n,t.colorScheme,r,y]),S=(0,a.useCallback)((e=>{const t={dark:{...n.dark},light:{...n.light},font:"Default"===e?void 0:e};r(t),y("interface.styleOverrides",t)}),[n,r,y]),x="dark"===t.colorScheme?{color:"dark",shade:0,computed:t.colors.dark[0]}:{color:"dark",shade:9,computed:t.colors.dark[9]},T="dark"===t.colorScheme?{color:"dark",shade:7,computed:t.colors.dark[7]}:{color:"gray",shade:0,computed:t.colors.gray[0]},I=(0,a.useCallback)((e=>{y("interface.preconfiguredLabels",e)}),[y]);return a.createElement(o.r,{align:"center"},a.createElement(o.r.Col,{span:2},a.createElement("div",{style:{flexShrink:0,display:"flex",order:100}},a.createElement(h.eo,null),a.createElement(h.lv,null))),a.createElement(o.r.Col,{span:1},"字体"),a.createElement(o.r.Col,{span:3},a.createElement(s.p,{data:g,value:n.font,onChange:e=>{S(e.currentTarget.value)}})),a.createElement(o.r.Col,{span:2},"字体颜色"),a.createElement(o.r.Col,{span:1},a.createElement(u.Z,{value:n[t.colorScheme].color??x,onChange:C})),a.createElement(o.r.Col,{span:2},"背景颜色"),a.createElement(o.r.Col,{span:1},a.createElement(u.Z,{value:n[t.colorScheme].backgroundColor??T,onChange:k})),a.createElement(o.r.Col,{span:3},"删除数据文件"),a.createElement(o.r.Col,{span:3},a.createElement(s.p,{data:f.XS,value:e.form.values.interface.deleteTorrentData,onChange:e=>{y("interface.deleteTorrentData",e.target.value)}})),a.createElement(o.r.Col,{span:6},a.createElement(i.X,{label:"跳过添加种子对话框",...e.form.getInputProps("interface.skipAddDialog",{type:"checkbox"})})),a.createElement(o.r.Col,{span:4},"保存的下载目录的最大数量"),a.createElement(o.r.Col,{span:2},a.createElement(c.Y,{min:1,max:100,...e.form.getInputProps("interface.numLastSaveDirs")})),a.createElement(o.r.Col,{span:6},a.createElement(i.X,{label:"目录排序",...e.form.getInputProps("interface.sortLastSaveDirs",{type:"checkbox"})})),a.createElement(o.r.Col,{span:3},"进度条样式"),a.createElement(o.r.Col,{span:3},a.createElement(s.p,{data:f.bb,value:e.form.values.interface.progressbarStyle,onChange:e=>{y("interface.progressbarStyle",e.target.value)}})),a.createElement(o.r.Col,null,a.createElement(m.NU,{data:e.form.values.interface.preconfiguredLabels,value:e.form.values.interface.preconfiguredLabels,onChange:I,label:"预配置标签",withinPortal:!0,searchable:!0,creatable:!0,getCreateLabel:e=>`+ 新增 ${e}`,onCreate:t=>(I([...e.form.values.interface.preconfiguredLabels,t]),t),valueComponent:E.__})),a.createElement(o.r.Col,null,a.createElement(d.g,{minRows:6,label:"默认Tracker列表(BT下载使用)",value:e.form.values.interface.defaultTrackers.join("\n"),onChange:t=>{e.form.setFieldValue("interface.defaultTrackers",t.currentTarget.value.split("\n"))}})))}r()}catch(y){r(y)}}),1)},862:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{_:()=>h});var a=n(4168),l=n(5918),o=n(391),s=n(1972),i=n(2691),c=n(7294),m=n(3570),d=n(3847),u=n(6146),p=n(8645),f=e([m,d]);function h(e){const t=(0,p.EL)(),n=(0,p.uM)(),[r,f]=(0,c.useState)(!1),h=(0,m.KD)(),{setPath:E,addPath:g}=h,v=(0,d.YI)(),b=(0,c.useCallback)((()=>{v({torrentIds:Array.from(n),location:h.path,move:r},{onSuccess:()=>{g(h.path),u.N9.show({message:"移动种子完成",color:"green"})},onError:e=>{console.log("移动种子异常",e),u.N9.show({message:"移动种子异常",color:"red"})}}),e.close()}),[v,n,h.path,r,e,g]),w=(0,c.useCallback)((()=>{const[e]=[...n],r=t.torrents.find((t=>t.id===e));return r?.downloadDir??""}),[t.torrents,n]);return(0,c.useEffect)((()=>{e.opened&&E(w())}),[e.opened,E,w]),c.createElement(c.Fragment,null,e.opened&&c.createElement(m.zF,{opened:e.opened,onClose:e.close,title:"变更数据保存目录",centered:!0,size:"xl"},c.createElement(a.i,{my:"sm"}),c.createElement(m.nW,null),c.createElement(l.x,{mb:"md"},"输入新目录:"),c.createElement(m.Es,{...h,focusPath:!0}),c.createElement(o.X,{label:"同时移动数据(如果不钩选，则从新目录下查找文件)",checked:r,onChange:e=>{f(e.currentTarget.checked)},my:"xl"}),c.createElement(a.i,{my:"sm"}),c.createElement(s.Z,{position:"center",spacing:"md"},c.createElement(i.z,{onClick:b,variant:"filled"},"确定"),c.createElement(i.z,{onClick:e.close,variant:"light"},"取消"))))}[m,d]=f.then?(await f)():f,r()}catch(E){r(E)}}))},9682:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{n:()=>g});var a=n(4168),l=n(5918),o=n(391),s=n(1972),i=n(2691),c=n(3570),m=n(7294),d=n(3847),u=n(6146),p=n(8645),f=n(8913),h=n(9362),E=e([f,d,c]);function g(e){const t=(0,m.useContext)(f.E_),n=(0,p.uM)(),[r,E]=(0,m.useState)(!1),[g,v]=(0,m.useState)(!1);(0,m.useEffect)((()=>{e.opened&&("记住选择"!==t.values.interface.deleteTorrentData?E("默认开"===t.values.interface.deleteTorrentData):E(t.values.interface.deleteTorrentDataSelection),v(t.values.interface.deleteTorrentDataWhenOneSelection))}),[t,e.opened]);const b=(0,m.useCallback)((e=>{const n=e.currentTarget.checked;n&&v(!1),E(n),t.values.interface.deleteTorrentDataSelection=n}),[t]),w=(0,m.useCallback)((e=>{const n=e.currentTarget.checked;n&&E(!1),v(n),t.values.interface.deleteTorrentDataWhenOneSelection=n}),[t]),y=(0,d.Vt)(),C=(0,p.EL)(),k=(0,m.useCallback)((()=>{if(g){const e=C.torrents.filter((e=>n.has(e.id)));console.log(e);let t=new Map;e.forEach((e=>{const n=(0,h.Nw)(e.downloadDir)+(0,h.DO)(e.name);t.set(n,0)})),C.torrents.forEach((e=>{const n=(0,h.Nw)(e.downloadDir)+(0,h.DO)(e.name),r=t.get(n)??-1;r>=0&&t.set(n,r+1)})),e.forEach((e=>{const n=(0,h.Nw)(e.downloadDir)+(0,h.DO)(e.name),r=t.get(n)??-1;r>=0&&t.set(n,r-1)}));let r=[],a=[];e.forEach((e=>{const n=(0,h.Nw)(e.downloadDir)+(0,h.DO)(e.name);0==(t.get(n)??-1)?a.push(e.id):r.push(e.id)})),r.length>0&&y({torrentIds:r,deleteData:!1},{onSuccess:()=>{a.length<=0&&u.N9.show({message:"删除种子完成",color:"green"})},onError:e=>{console.log("删除种子出错",e),u.N9.show({message:"删除种子出错",color:"red"})}}),a.length>0&&y({torrentIds:a,deleteData:!0},{onSuccess:()=>{u.N9.show({message:"删除种子完成",color:"green"})},onError:e=>{console.log("删除种子(含数据)出错",e),u.N9.show({message:"删除种子(含数据)出错",color:"red"})}})}else y({torrentIds:Array.from(n),deleteData:r},{onSuccess:()=>{u.N9.show({message:"删除种子完成",color:"green"})},onError:e=>{console.log("删除种子出错",e),u.N9.show({message:"删除种子出错",color:"red"})}});e.close()}),[y,C,n,r,g,e]);return m.createElement(c.zF,{opened:e.opened,onClose:e.close,title:"删除种子确认",centered:!0,size:"xl"},m.createElement(a.i,{my:"sm"}),m.createElement(l.x,{mb:"md"},"确认要删除已选择的种子吗？"),m.createElement(c.nW,null),m.createElement(o.X,{label:"同时删除数据",disabled:g,checked:r,onChange:b,my:"xl"}),m.createElement(o.X,{label:"没有其他站点保种则删除数据",disabled:r,checked:g,onChange:w,my:"xl"}),m.createElement(a.i,{my:"sm"}),m.createElement(s.Z,{position:"center",spacing:"md"},m.createElement(i.z,{onClick:k,variant:"filled",color:"red","data-autofocus":!0},r?"删除种子和数据":g?"删除种子和无保种数据":"删除种子"),m.createElement(i.z,{onClick:e.close,variant:"light"},"取消")))}[f,d,c]=E.then?(await E)():E,r()}catch(v){r(v)}}))},8217:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{j:()=>v});var a=n(1759),l=n(7294),o=n(3043),s=n(9682),i=n(862),c=n(9872),m=n(5488),d=n(9298),u=n(216),p=e([o,s,i,c,m,u,d]);[o,s,i,c,m,u,d]=p.then?(await p)():p;const{TAURI:f,appWindow:h}=await Promise.resolve().then(n.bind(n,4637));function E(e){const[t,{open:n,close:r}]=(0,a.q)(!1);return[t,(0,l.useCallback)((()=>{e(!1),n()}),[e,n]),(0,l.useCallback)((()=>{r(),e(!0)}),[e,r])]}const g=l.forwardRef((function(e,t){const[n,{open:r,close:p}]=(0,a.q)(!1),[g,{open:v,close:b}]=(0,a.q)(!1),[w,y,C]=E(e.runUpdates),[k,S,x]=E(e.runUpdates),[T,I,z]=E(e.runUpdates),[D,M,R]=E(e.runUpdates),[P,F,Z]=E(e.runUpdates),[N,A,L]=E(e.runUpdates);(0,l.useImperativeHandle)(t,(()=>({setLabels:y,remove:S,move:I,addMagnet:r,addTorrent:v,daemonSettings:M,editTrackers:F,editTorrent:A})));const[O,$]=(0,l.useState)([]),[q,U]=(0,l.useState)([]),V=(0,l.useCallback)((e=>{if(h.show(),h.unminimize(),h.setFocus(),h.emit("window-shown"),e.length>0&&!n&&!g){const t=e[0];"string"==typeof t&&t.startsWith("magnet:?")?($(e),r()):(U(e),v())}}),[n,g,$,U,r,v]);(0,l.useEffect)((()=>{if(f){const e=h.listen("tauri://file-drop",(e=>{const t=e.payload.filter((e=>e.toLowerCase().endsWith(".torrent")));t.length>0&&V(t)}));return()=>{e.then((e=>{e()}))}}return document.ondragover=e=>{e.preventDefault()},document.ondrop=e=>{if(e.preventDefault(),void 0!==e.dataTransfer?.items){const t=[...e.dataTransfer.items].filter((e=>"file"===e.kind)).map((e=>e.getAsFile()));t.length>0&&V(t)}},()=>{document.ondragover=null,document.ondrop=null}}),[V]),(0,l.useEffect)((()=>{const e=h.listen("app-arg",(e=>{const t=JSON.parse(e.payload);console.log("Got app-arg:",t),V(t)})).then((e=>(h.emit("listener-start",{}),e)));return()=>{e.then((e=>{e()}))}}),[V]);const _=(0,l.useCallback)((()=>{p(),$([])}),[p,$]),j=(0,l.useCallback)((()=>{b(),U([])}),[b,U]);return l.createElement(l.Fragment,null,l.createElement(o.a,{opened:w,close:C}),l.createElement(s.n,{opened:k,close:x}),l.createElement(i._,{opened:T,close:z}),l.createElement(c.n,{serverName:e.serverName,uris:O,tabsRef:e.tabsRef,setStatus:e.setStatus,opened:n,close:_}),l.createElement(c.Z,{serverName:e.serverName,uris:q,tabsRef:e.tabsRef,setStatus:e.setStatus,opened:g,close:j}),l.createElement(m.$,{opened:D,close:R}),l.createElement(u.m,{opened:P,close:Z}),l.createElement(d.Z,{opened:N,close:L}))})),v=(0,l.memo)(g);r()}catch(b){r(b)}}),1)},6090:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{w:()=>A});var a=n(5157),l=n(1938),o=n(1972),s=n(2160),i=n(61),c=n(7532),m=n(4272),d=n(1425),u=n(5194),p=n(2691),f=n(4128),h=n(5918),E=n(384),g=n(3515),v=n(8913),b=n(7294),w=n(3570),y=n(1698),C=n(4908),k=n(8932),S=n(7119),x=n(6848),T=n(2238),I=n.n(T),z=n(8515),D=e([v,w,z]);[v,w,z]=D.then?(await D)():D;const{TAURI:M,invoke:R}=await Promise.resolve().then(n.bind(n,4637));function P({form:e,current:t,setCurrent:n}){return b.createElement(a.K,null,b.createElement(l.x,{sx:e=>({border:"1px solid",borderColor:e.colors.dark[3],flexGrow:1}),mb:"md",className:"scrollable"},b.createElement("div",null,e.values.servers.map(((r,a)=>{let o=!1;return e.values.servers.forEach(((e,t)=>{t!==a&&e.name===r.name&&(o=!0)})),b.createElement(l.x,{key:a,px:"sm",className:a===t?"selected":"",style:{textDecoration:o?"red wavy underline":void 0},onClick:()=>{n(a)}},r.name)})))),b.createElement(o.Z,{position:"apart",noWrap:!0},b.createElement(s.A,{variant:"light",onClick:()=>{e.insertListItem("servers",{connection:{url:"",username:"",password:""},name:"new",pathMappings:[],expandedDirFilters:[],lastSaveDirs:[],intervals:{session:60,torrents:5,torrentsMinimized:60,details:5}}),e.validate(),n(e.values.servers.length)}},b.createElement(y.Z,{size:"1.6rem",color:"royalblue"})),b.createElement(s.A,{variant:"light",onClick:()=>{t>=e.values.servers.length-1&&n(e.values.servers.length-2),e.removeListItem("servers",t)}},b.createElement(C.Z,{size:"1.6rem",color:"royalblue"})),b.createElement(s.A,{variant:"light",onClick:()=>{t>0&&(e.reorderListItem("servers",{from:t,to:t-1}),n(t-1))}},b.createElement(k.Z,{size:"1.6rem",color:"royalblue"})),b.createElement(s.A,{variant:"light",onClick:()=>{t<e.values.servers.length-1&&(e.reorderListItem("servers",{from:t,to:t+1}),n(t+1))}},b.createElement(S.Z,{size:"1.6rem",color:"royalblue"}))))}function F(e){const[t,n]=(0,b.useState)(""),r=e.form.values.servers[e.current];return(0,b.useEffect)((()=>{n(r.pathMappings.map((e=>`${e.from}=${e.to}`)).join("\n"))}),[r.pathMappings]),b.createElement("div",{style:{flexGrow:1}},b.createElement(i.o,{label:"名称",...e.form.getInputProps(`servers.${e.current}.name`)}),b.createElement(i.o,{label:"下载器 rpc 接口地址",...e.form.getInputProps(`servers.${e.current}.connection.url`),placeholder:"http://1.2.3.4:9091/transmission/rpc"}),b.createElement(c.r,null,b.createElement(c.r.Col,{span:6},b.createElement(i.o,{label:"用户名",...e.form.getInputProps(`servers.${e.current}.connection.username`)})),b.createElement(c.r.Col,{span:6},b.createElement(m.W,{label:"密码",...e.form.getInputProps(`servers.${e.current}.connection.password`)})),b.createElement(c.r.Col,{span:12},b.createElement(d.g,{label:'"remote=local" 格式的路径映射，一行一个',onChange:t=>{const r=t.target.value.split("\n").map((e=>{const t=e.indexOf("=")+1;return{from:e.substring(0,t-1),to:e.substring(t)}}));e.form.setFieldValue(`servers.${e.current}.pathMappings`,r),n(t.target.value)},value:t,minRows:4}))))}const Z={track:{flexGrow:1}};function N({form:e}){const t=(0,b.useMemo)((()=>(new(I())).getOS().name??"unknown"),[]),[n,r]=(0,b.useState)(!1),a=(0,b.useCallback)((()=>{R("app_integration",{mode:"torrent"})}),[]),l=(0,b.useCallback)((()=>{R("app_integration",{mode:"magnet"})}),[]);(0,b.useEffect)((()=>{"Windows"===t&&R("app_integration",{mode:"getautostart"}).then((e=>{r(e)})).catch(console.error)}),[t]);const o=(0,b.useCallback)((e=>{const t=e.target.checked;r(t),R("app_integration",{mode:t?"autostart":"noautostart"})}),[]);return b.createElement(c.r,{align:"center",gutter:"md"},b.createElement(c.r.Col,{span:6},"删除成功添加的torrent文件"),b.createElement(c.r.Col,{span:2},b.createElement(u.r,{onLabel:"开",offLabel:"关",size:"xl",styles:Z,...e.getInputProps("app.deleteAdded",{type:"checkbox"})})),b.createElement(c.r.Col,{span:4}),b.createElement(c.r.Col,{span:6},"显示已完成种子的通知"),b.createElement(c.r.Col,{span:2},b.createElement(u.r,{onLabel:"开",offLabel:"关",size:"xl",styles:Z,...e.getInputProps("app.toastNotifications",{type:"checkbox"})})),b.createElement(c.r.Col,{span:2},"播放提示音"),b.createElement(c.r.Col,{span:2},b.createElement(u.r,{onLabel:"开",offLabel:"关",size:"xl",styles:Z,...e.getInputProps("app.toastNotificationSound",{type:"checkbox"})})),"Windows"===t&&b.createElement(b.Fragment,null,b.createElement(c.r.Col,{span:6},"开机时启动"),b.createElement(c.r.Col,{span:2},b.createElement(u.r,{onLabel:"开",offLabel:"关",size:"xl",styles:Z,checked:n,onChange:o})),b.createElement(c.r.Col,{span:4}),b.createElement(c.r.Col,{span:6},"关联应用程序"),b.createElement(c.r.Col,{span:3},b.createElement(p.z,{onClick:a},".torrent 文件")),b.createElement(c.r.Col,{span:3},b.createElement(p.z,{onClick:l},"磁力链接"))),b.createElement(c.r.Col,{span:6},"显示托盘图标"),b.createElement(c.r.Col,{span:2},b.createElement(u.r,{onLabel:"开",offLabel:"关",size:"xl",styles:Z,checked:e.values.app.showTrayIcon,onChange:t=>{e.setFieldValue("app.showTrayIcon",t.currentTarget.checked),t.currentTarget.checked||(e.setFieldValue("app.onMinimize","最小化"),e.setFieldValue("app.onClose","退出"))}})),b.createElement(c.r.Col,{span:4},"(重新启动后生效)"),b.createElement(c.r.Col,{span:6},"最小化时"),b.createElement(c.r.Col,{span:6},b.createElement(f.s,{data:v.O0,disabled:!e.values.app.showTrayIcon,...e.getInputProps("app.onMinimize")})),b.createElement(c.r.Col,{span:6},"关闭时"),b.createElement(c.r.Col,{span:6},b.createElement(f.s,{data:v.nF,disabled:!e.values.app.showTrayIcon,...e.getInputProps("app.onClose")})),b.createElement(c.r.Col,null,b.createElement(h.x,{fz:"sm",fs:"italic"},"隐藏窗口可以保持前端运行，这会使用更多的RAM，但重新打开窗口几乎是即时的。"),b.createElement(h.x,{fz:"sm",fs:"italic"},"关闭窗口会关闭Web视图，在这种模式下，重新打开窗口的速度较慢。"),b.createElement(h.x,{fz:"sm",fs:"italic"},"您始终可以通过系统托盘图标访问该窗口。")))}function A(e){const t=(0,b.useContext)(v.E_),n=(0,x.c)({initialValues:{servers:t.getServers(),app:{...t.values.app},interface:{...t.values.interface}},validate:{servers:{name:(e,t,n)=>{let r=!1;return t.servers.forEach(((t,a)=>{`servers.${a}.name`!==n&&e===t.name&&(r=!0)})),r?"Server names must be unique":null},connection:{url:e=>{try{const t=new URL(e);if(!["http:","https:"].includes(t.protocol))return"Only http/https URLs are supported"}catch{return"Invalid URL"}return null}}}},validateInputOnChange:!0}),[r,a]=(0,b.useState)(-1),{setValues:l}=n;(0,b.useEffect)((()=>{e.opened&&(l({servers:t.getServers(),app:{...t.values.app}}),a(t.getServers().length>0?0:-1))}),[t,e.opened,l]);const o=(0,b.useCallback)((()=>{n.validate(),n.isValid()&&(t.setServers(n.values.servers),t.values.app={...t.values.app,...n.values.app},t.values.interface={...t.values.interface,...n.values.interface},e.onSave(n.values.servers),e.close())}),[t,n,e]);return b.createElement(w.Fj,{opened:e.opened,size:"lg",onClose:e.close,onSave:o,centered:!0,title:"应用设置"},b.createElement("form",null,b.createElement(E.m,{mih:"25rem",defaultValue:"servers"},b.createElement(E.m.List,null,b.createElement(E.m.Tab,{value:"servers",p:"lg"},"下载器列表"),b.createElement(E.m.Tab,{value:"integrations",p:"lg"},"程序设置"),M&&b.createElement(E.m.Tab,{value:"interface",p:"lg"},"其他设置")),b.createElement(E.m.Panel,{value:"servers",pt:"md",mih:"24rem"},b.createElement(g.k,{h:"100%",gap:"0.5rem",mih:"24rem"},b.createElement(P,{form:n,current:r,setCurrent:a}),-1===r?b.createElement(b.Fragment,null):b.createElement(F,{form:n,current:r}))),b.createElement(E.m.Panel,{value:"integrations",pt:"md",mih:"24rem"},b.createElement(N,{form:n})),M&&b.createElement(E.m.Panel,{value:"interface",pt:"md",mih:"24rem"},b.createElement(z.Q,{form:n})))))}r()}catch(L){r(L)}}),1)},1649:(e,t,n)=>{n.d(t,{T:()=>o});var r=n(7294),a=n(9612);const l=e=>e*window.devicePixelRatio;function o(e){const{width:t,height:n,ref:o}=(0,a.NB)({refreshMode:"throttle",refreshRate:1e3}),s=(0,r.useRef)(null),i=(0,r.useRef)(null),c=(0,r.useMemo)((()=>{const t=new Array(e.torrent.pieceCount),n=e.torrent.pieceSize,r=e.torrent.files.map((e=>e.length)),a=e.torrent.fileStats.map((e=>e.wanted));let l=0,o=0,s=0;for(;s<e.torrent.totalSize;){for(s+=r[l];(o+1)*n<s;)t[o]=t[o]||a[l],o++;t[o]=t[o]||a[l],(o+1)*n===s&&o++,l++}return t}),[e.torrent]),[m,d,u]=(0,r.useMemo)((()=>{if(void 0===t||void 0===n)return[5,1,1];const r=Math.floor(l(t)),a=Math.floor(l(n)),o=e.torrent.pieceCount,s=l(20),i=Math.ceil(r/s);if(o<i&&a>=s)return[s,1,o];const c=r/a;let m=Math.max(Math.ceil(Math.sqrt(o*c)),i),d=Math.ceil(o/m);for(;m<d*c;)m++,d=Math.ceil(o/m);return[r/m,d,m]}),[e.torrent.pieceCount,t,n]),p=(0,r.useMemo)((()=>{const t=window.atob(e.torrent.pieces),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}),[e]);(0,r.useEffect)((()=>{const t=i.current,n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);const r=d*u-e.torrent.pieceCount;n.beginPath(),n.lineWidth=l(m>l(5)?1:.5),n.strokeStyle="rgba(0, 0, 0, 0.5)";for(let e=0;e<d;e++)n.moveTo(0,e*m),n.lineTo(u*m,e*m);n.moveTo(0,d*m),n.lineTo((u-r)*m,d*m);for(let e=0;e<=u-r;e++)n.moveTo(e*m,0),n.lineTo(e*m,d*m);for(let e=u-r+1;e<=u;e++)n.moveTo(e*m,0),n.lineTo(e*m,(d-1)*m);n.stroke()}),[i,d,u,t,n,e.torrent.pieceCount,m]),(0,r.useEffect)((()=>{const t=s.current,n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);for(let t=0;t<d;t++){let r=0;for(let a=0;a<u&&(r=t*u+a,!(r>=e.torrent.pieceCount));a++){const e=p[Math.floor(r/8)]&128>>r%8;n.fillStyle=e>0?"steelblue":c[r]?"paleturquoise":"silver",n.fillRect(a*m,t*m,m,m)}if(r>=e.torrent.pieceCount)break}}),[s,d,u,t,n,m,p,c,e.torrent.pieceCount]);const f=Math.floor(l(t??1)),h=Math.floor(l(n??1)),E={width:t??1,height:n??1,position:"absolute",top:0,left:0};return r.createElement("div",{ref:o,style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"}},r.createElement("canvas",{ref:s,width:f,height:h,style:E}),r.createElement("canvas",{ref:i,width:f,height:h,style:E}))}},7279:(e,t,n)=>{n.d(t,{D:()=>f,s:()=>p});var r=n(7294),a=n(4095),l=n(5948),o=n(9362),s=n(8579),i=n(1972),c=n(4340),m=n(1938),d=n(99),u=n(7826);function p(e){return Object.fromEntries(e.map(((e,t)=>[e.section,t])))}const f=r.memo((function(e){const{setSections:t}=e,n=(0,r.useCallback)((n=>{const r=[...e.sections];r[n].visible=!r[n].visible,t(r)}),[e.sections,t]),p=(0,r.useCallback)((n=>{if(null!=n.destination){const r=(0,o.l)(e.sections,n.source.index,n.destination.index);t(r)}}),[e.sections,t]);return r.createElement(a.x,{contextMenuInfo:e.contextMenuInfo,setContextMenuInfo:e.setContextMenuInfo,closeOnItemClick:!1,containerRef:e.contextMenuContainerRef,closeOnClickOutside:e.closeOnClickOutside},r.createElement(l.Z5,{onDragEnd:p},r.createElement(s.J,{droppableId:"filterscontextmenu"},(t=>r.createElement("div",{ref:t.innerRef,...t.droppableProps},e.sections.map(((t,a)=>r.createElement(l._l,{draggableId:t.section,index:a,key:t.section},(l=>r.createElement(i.Z,{ref:l.innerRef,onMouseEnter:e.onSectionItemMouseEnter,...l.draggableProps,noWrap:!0},r.createElement(c.v.Item,{icon:t.visible?r.createElement(d.Z,{size:"1rem"}):r.createElement(m.x,{miw:"1rem"}),onClick:()=>{n(a)}},t.section),r.createElement("div",{...l.dragHandleProps},r.createElement(u.Z,{size:"12"}))))))),t.placeholder)))),e.children)}))},874:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{x:()=>M}),n(9687);var a=n(3515),l=n(5870),o=n(3330),s=n(4331),i=n(1938),c=n(7294),m=n(8913),d=n(8645),u=n(773),p=n(3940),f=n(2285),h=n(4572),E=n(102),g=n(3847),v=n(8217),b=n(5409),w=n(4277),y=n(1759),C=n(9895),k=n(5509),S=n(1535),x=n(9362),T=e([p,h,g,m,v,E,w,u,f]);function I(e,t){if("set"===t.verb)return[t.filter];const n=e.filter((e=>e.id!==t.filter.id));return n.length===e.length&&n.push(t.filter),n}function z(){const e=(0,b.QU)(),t=(0,c.useRef)((()=>{})),[n,r]=(0,c.useReducer)(((n,r)=>{let a=new Set(n);const l=r.ids.map((e=>+e));if("set"===r.verb){a.clear();for(const e of l)a.add(e)}else if("add"===r.verb)for(const e of l)a.add(e);else if("filter"===r.verb)a=new Set(Array.from(a).filter((e=>l.includes(e)))),a.size===n.size&&(a=n);else if("toggle"===r.verb)for(const e of l)a.delete(e)||a.add(e);return"filter"!==r.verb&&(e.handlers.selectAll=()=>{t.current?.()}),a}),new Set);return(0,c.useEffect)((()=>()=>{e.handlers.selectAll=()=>{}}),[e]),{selectedTorrents:n,selectedReducer:r,selectAll:t}}function D(e){return c.createElement(d.Fe.Provider,{value:e.data},c.createElement(d.R8.Provider,{value:e.selected},c.createElement(d.aq.Provider,{value:e.rpc},e.children)))}function M({hostname:e,tabsRef:t}){(0,b.ht)();let n=new S.V;const[r,d]=(0,c.useState)(n.ide),[T,M]=(0,c.useState)(n.title),[R,P]=(0,c.useState)(n.content),[F,Z]=(0,c.useState)(!1),[N,A]=(0,c.useReducer)(I,[{id:"",filter:p.t}]),[L,O]=(0,c.useState)([]),[$,q]=(0,c.useState)(""),U=(0,c.useCallback)((e=>{const t=e.name.toLowerCase();for(const e of L)if(!t.includes(e))return!1;return""===$||e.cachedMainTracker===$}),[L,$]),[V,_]=(0,c.useState)(!0),[j,W]=(0,c.useState)((0,h.rZ)()),{data:G,isLoading:X,isError:B,error:K}=(0,g.kP)(V),{data:Y}=(0,g.cO)(V,j),[Q,H]=(0,c.useState)(),J=(0,c.useCallback)((e=>{H(+e)}),[H]),{selectedTorrents:ee,selectedReducer:te,selectAll:ne}=z(),[re,ae]=(0,c.useState)([]);(0,c.useEffect)((()=>{-1===(Y?.findIndex((e=>e.id===Q))??-1)&&H(void 0);const e=Y?.filter((e=>void 0===N.find((t=>!t.filter(e))))).filter(U)??[],t=e.map((e=>e.id));te({verb:"filter",ids:t}),ae(e),Z("status-活动中"===N?.[0]?.id)}),[Y,N,U,Q,te,Z]),ne.current=(0,c.useCallback)((()=>{const e=re.map((e=>e.id))??[];te({verb:"set",ids:e})}),[re,te]);const[le,oe]=(0,c.useState)();(0,c.useEffect)((()=>{void 0!==Q&&oe({id:`${Q}`})}),[N,Q]);const se=(0,c.useRef)(null),ie=G?.["rpc-version"]??0,ce=B||X||ie<14,me=(0,c.useMemo)((()=>({torrents:Y??[],current:Q})),[Y,Q]),de=(0,c.useContext)(m.E_),ue=(0,c.useContext)(m.Dk),[pe,{toggle:fe}]=(0,y.q)(de.values.interface.showFiltersPanel),[he,{toggle:Ee}]=(0,y.q)(de.values.interface.showDetailsPanel),[ge,{toggle:ve}]=(0,y.q)(de.values.interface.showRunStatus),[be,we]=(0,C.O)([de.values.interface.mainSplit,"vertical"===de.values.interface.mainSplit?"horizontal":"vertical"]);(0,c.useEffect)((()=>{de.values.interface.showFiltersPanel=pe,de.values.interface.showDetailsPanel=he,de.values.interface.mainSplit=be,de.values.interface.showRunStatus=ge}),[de,pe,he,be,ge]),(0,c.useEffect)((()=>{if(r&&ee){let e=ee;const t=re.filter((t=>e.has(t.id)));if(t.length>0){const n="当前选中 ("+e.size+") ["+(0,x.Iy)(t.reduce(((e,t)=>e+t.sizeWhenDone),0))+"]";let r=1;const a=t.map((e=>r+++": "+e.name)).join("\n");M(n),P(a)}else M("无任务"),P("")}}),[ee,re,r,M,P]);const ye=(0,c.useCallback)((e=>{d(e.ide),void 0!==e.title&&M(e.title),void 0!==e.content&&P(e.content)}),[d,M,P]),Ce=(0,c.useMemo)((()=>{const e={};return(Y?.filter((e=>void 0===N.find((t=>!t.filter(e)))))??[]).forEach((t=>{t.cachedMainTracker in e||(e[t.cachedMainTracker]={count:0,speed:0}),e[t.cachedMainTracker].count=e[t.cachedMainTracker].count+1,e[t.cachedMainTracker].speed=e[t.cachedMainTracker].speed+t.rateUpload})),e[$]||q(""),e}),[Y,N,$,q]);return c.createElement(D,{data:me,selected:ee,rpc:ie},c.createElement(a.k,{direction:"column",w:"100%",h:"100%",sx:{position:"relative"}},c.createElement(v.j,{ref:se,runUpdates:_,tabsRef:t,serverName:ue.name,setStatus:ye}),ce&&c.createElement(l.a,{blur:10},c.createElement(a.k,{align:"center",justify:"center",h:"100%",direction:"column",gap:"xl"},X?c.createElement(o.a,{size:"xl"}):B?c.createElement(c.Fragment,null,c.createElement(s.D,{color:"red",order:1},"加载会话失败"),c.createElement(s.D,{color:"red",order:3},K.message)):void 0===G?.["rpc-version"]?c.createElement(s.D,{color:"red",order:1},"获取 transmission 版本失败"):ie<14?c.createElement(s.D,{color:"red",order:1},"Transmission 版本低于 2.40"):c.createElement(c.Fragment,null))),c.createElement(i.x,{p:"sm",sx:e=>({borderBottom:"1px solid",borderColor:e.colors.dark[3]})},c.createElement(E.N,{setSearchTerms:O,searchTracker:$,setSearchTracker:q,showTrackerSpeed:F,trackers:Ce,modals:se,altSpeedMode:G?.["alt-speed-enabled"]??!1,toggleFiltersPanel:fe,toggleDetailsPanel:Ee,toggleMainSplit:we,toggleShowRunStatus:ve})),c.createElement(w.K,{key:`split-${pe?"1":"0"}-0-${be}-${ge}`,mainSplit:be,left:pe?c.createElement(k.Z,{direction:"vertical",sizes:ge?[80,20]:[100],snapOffset:0,gutterSize:6,className:"split-vertical"},c.createElement(i.x,{className:"scrollable"},c.createElement(p.x,{torrents:Y??[],currentFilters:N,setCurrentFilters:A,setSearchTracker:q,setCurrentTorrentId:H,selectedReducer:te})),ge&&c.createElement(a.k,{direction:"column",h:"100%",w:"100%"},c.createElement("span",{style:{width:"100%",height:"auto",fontSize:"small",paddingLeft:"0.2rem"}},T),c.createElement("textarea",{style:{width:"100%",height:"100%",lineHeight:1.3,overflow:"auto",top:0,left:0,resize:"none",fontSize:"small"},wrap:"off",readOnly:!0,value:R}))):void 0,right:pe?c.createElement(w.K,{key:`split-${pe?"1":"0"}-0-${be}`,mainSplit:be,left:void 0,right:c.createElement(h.hU,{modals:se,torrents:re,setCurrentTorrent:J,selectedReducer:te,onColumnVisibilityChange:W,scrollToRow:le,setStatus:ye}),bottom:he?c.createElement(u.f,{torrentId:Q,updates:V}):void 0}):c.createElement(h.hU,{modals:se,torrents:re,setCurrentTorrent:J,selectedReducer:te,onColumnVisibilityChange:W,scrollToRow:le,setStatus:ye}),bottom:!pe&&he?c.createElement(u.f,{torrentId:Q,updates:V}):void 0}),c.createElement(i.x,{px:"xs",sx:e=>({borderTop:"1px solid",borderColor:e.colors.dark[3]})},c.createElement(f.X,{session:G,filteredTorrents:re,selectedTorrents:ee,hostname:e,torrents:Y??[]}))))}[p,h,g,m,v,E,w,u,f]=T.then?(await T)():T,r()}catch(R){r(R)}}))},5877:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{V:()=>h});var a=n(8913),l=n(7294),o=n(9019),s=n(458),i=n(384),c=n(4340),m=n(2160),d=n(3795),u=e([a]);a=(u.then?(await u)():u)[0];const{appWindow:p,invoke:f}=await Promise.resolve().then(n.bind(n,4637)),h=l.forwardRef((function(e,t){const n=(0,l.useContext)(a.E_),[r,u]=(0,l.useState)({openTabs:n.getOpenTabs(),currentTab:n.values.app.lastTab});(0,l.useEffect)((()=>{n.setOpenTabs(r.openTabs,r.currentTab),r.currentTab<0&&p.setTitle("Transmission GUI")}),[n,r]),(0,l.useEffect)((()=>{const e=r.openTabs.filter(((e,t)=>t!==r.currentTab)).map((e=>{const t=n.getServer(e);if(void 0!==t)return{name:t.name,connection:t.connection,interval:t.intervals.torrentsMinimized}})).filter((e=>void 0!==e));f("set_poller_config",{configs:e,toast:n.values.app.toastNotifications,sound:n.values.app.toastNotificationSound})}),[n,e.servers,n.values.app,r]);const{setCurrentServer:h}=e,E=(0,l.useCallback)((e=>{h(n.getServer(r.openTabs[e])),u({...r,currentTab:e})}),[n,h,r]);(0,d.A)([["mod + TAB",(0,l.useCallback)((e=>{e.preventDefault(),E((r.currentTab+1)%r.openTabs.length)}),[E,r])],["mod + shift + TAB",(0,l.useCallback)((e=>{e.preventDefault(),E((r.currentTab+r.openTabs.length-1)%r.openTabs.length)}),[E,r])]]);const g=(0,l.useCallback)((t=>{r.openTabs.includes(t)||(e.clientManager.open(t,n.values.app.toastNotifications,n.values.app.toastNotificationSound),h(n.getServer(t)),u({...r,openTabs:[...r.openTabs,t],currentTab:r.openTabs.length}))}),[r,e.clientManager,h,n]),v=(0,l.useCallback)((t=>{if(t>=r.openTabs.length)return;e.clientManager.close(r.openTabs[t]);const a={openTabs:r.openTabs.filter(((e,n)=>n!==t)),currentTab:r.currentTab};(r.currentTab>t||r.currentTab===t&&a.currentTab===r.openTabs.length-1)&&(a.currentTab-=1),h(n.getServer(a.openTabs[a.currentTab])),u(a)}),[r,e.clientManager,h,n]),b=(0,l.useMemo)((()=>e.servers.filter((e=>!r.openTabs.includes(e.name))).map((e=>e.name))),[e.servers,r.openTabs]);(0,l.useImperativeHandle)(t,(()=>({openTab:g,getOpenTabs:()=>r.openTabs,switchTab:E})));const w=(0,l.useRef)();return w.current=(0,l.useCallback)((t=>{const a=[];let l=0;r.openTabs.forEach((o=>{e.clientManager.close(o),void 0!==t.find((e=>e.name===o))&&(e.clientManager.open(o,n.values.app.toastNotifications,n.values.app.toastNotificationSound),a.push(o),o===r.openTabs[r.currentTab]&&(l=a.length-1))})),u({openTabs:a,currentTab:l}),h(n.getServer(a[l]))}),[r,h,n,e.clientManager]),(0,l.useEffect)((()=>{w.current?.(e.servers)}),[e.servers]),l.createElement(i.m,{variant:"outline",radius:"lg",value:String(r.currentTab),onTabChange:e=>{E(Number(e))},styles:e=>({tab:{flexBasis:"12rem",flexShrink:1,borderColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[2],"&[data-active]":{borderColor:"dark"===e.colorScheme?e.colors.dark[3]:e.colors.gray[5]}},tabLabel:{marginInline:"auto",color:e.colors.gray[6],"[data-active] &":{color:"dark"===e.colorScheme?e.colors.gray[3]:e.colors.dark[8]}},tabRightSection:{padding:"0.2rem"},tabsList:{flexWrap:"nowrap"}})},l.createElement(i.m.List,{px:"sm"},r.openTabs.map(((e,t)=>l.createElement(i.m.Tab,{key:t,value:String(t),rightSection:l.createElement(o.Z,{size:"1.1rem",onClick:e=>{e.stopPropagation(),e.preventDefault(),v(t)}})},e))),b.length>0?l.createElement(c.v,{shadow:"md",width:200,position:"bottom-start"},l.createElement(c.v.Target,null,l.createElement(m.A,{variant:"subtle",color:"secondaryColorName",my:"auto"},l.createElement(s.Z,{size:"1.1rem"}))),l.createElement(c.v.Dropdown,null,l.createElement(c.v.Label,null,"Connect"),b.map((e=>l.createElement(c.v.Item,{key:e,onClick:()=>{g(e)}},e))))):l.createElement(l.Fragment,null),e.children))}));r()}catch(e){r(e)}}),1)},4277:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{K:()=>c});var a=n(1938),l=n(8913),o=n(7294),s=n(5509),i=e([l]);function c({mainSplit:e,left:t,right:n,bottom:r}){const i=(0,o.useContext)(l.E_),c=(0,o.useCallback)((e=>{i.setSashSizes("vertical",e)}),[i]),m=(0,o.useCallback)((e=>{i.setSashSizes("horizontal",e)}),[i]),d=void 0===t?n:o.createElement(s.Z,{direction:"horizontal",sizes:i.getSashSizes("horizontal"),snapOffset:0,gutterSize:6,className:"split-horizontal",onDragEnd:m},t,n);return o.createElement(a.x,{sx:e=>({flexGrow:1,"& .gutter":{backgroundColor:"dark"===e.colorScheme?e.colors.gray[7]:e.colors.gray[3]}})},void 0===r?d:o.createElement(s.Z,{direction:e,sizes:i.getSashSizes("vertical"),snapOffset:0,gutterSize:6,className:`split-${e}`,onDragEnd:c},d,r))}l=(i.then?(await i)():i)[0],r()}catch(m){r(m)}}))},2285:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{X:()=>C});var a=n(7294),l=n(9362),o=n(99),s=n(5861),i=n(5476),c=n(7493),m=n(5398),d=n(3951),u=n(3515),p=n(4340),f=n(1938),h=n(6612),E=n(8913),g=n(4095),v=n(7279),b=e([E,h]);[E,h]=b.then?(await b)():b;const{TAURI:w,appWindow:y}=await Promise.resolve().then(n.bind(n,4637));function C({session:e,torrents:t,filteredTorrents:n,selectedTorrents:r,hostname:b}){const C=(0,a.useContext)(E.E_),k=(0,a.useContext)(E.Dk),S=(0,a.useMemo)((()=>({downRateLimit:void 0!==e?!0===e["alt-speed-enabled"]?e["alt-speed-down"]:!0===e["speed-limit-down-enabled"]?e["speed-limit-down"]:-1:-1,upRateLimit:void 0!==e?!0===e["alt-speed-enabled"]?e["alt-speed-up"]:!0===e["speed-limit-up-enabled"]?e["speed-limit-up"]:-1:-1,free:e?.["download-dir-free-space"]??0})),[e]),[x,T,I]=(0,a.useMemo)((()=>{const e=n.filter((e=>r.has(e.id)));return[(0,l.Iy)(e.reduce(((e,t)=>e+t.sizeWhenDone),0)),(0,l.Iy)(e.reduce(((e,t)=>e+t.haveValid),0)),(0,l.Iy)(e.reduce(((e,t)=>e+Math.max(t.sizeWhenDone-t.haveValid,0)),0))]}),[n,r]),[z,D]=(0,a.useState)(C.values.interface.statusBarGlobalSpeeds),[M,R]=(0,a.useState)(C.values.interface.statusBarSections),[P,F]=(0,a.useState)((0,v.s)(M));(0,a.useEffect)((()=>{C.values.interface.statusBarGlobalSpeeds=z,C.values.interface.statusBarSections=M,F((0,v.s)(M))}),[C,z,M]);const[Z,N,A]=(0,a.useMemo)((()=>[(0,l.Iy)((z?t:n).reduce(((e,t)=>e+t.rateDownload),0)),(0,l.Iy)((z?t:n).reduce(((e,t)=>e+t.rateUpload),0)),(0,l.Iy)(n.reduce(((e,t)=>e+t.sizeWhenDone),0))]),[z,t,n]);(0,a.useEffect)((()=>{const e=`↓${Z}/s ↑${N}/s`;document.title=`${e} - TrguiNG`,w&&y.setTitle(`Transmission GUI - ${k.name} (${e})`)}),[k,Z,N]);const[L,O,$]=(0,g.a)();return a.createElement(u.k,{className:"statusbar",sx:{flexWrap:"nowrap"},onContextMenu:$,gap:"md"},a.createElement(v.D,{sections:M,setSections:R,contextMenuInfo:L,setContextMenuInfo:O},a.createElement(p.v.Divider,null),a.createElement(p.v.Item,{icon:z?a.createElement(o.Z,{size:"1rem"}):a.createElement(f.x,{miw:"1rem"}),onMouseDown:e=>{e.stopPropagation(),D(!z)}},"显示全局速度")),M[P["连接状态"]].visible&&a.createElement("div",{style:{flex:"1 1 20%",order:P["连接状态"]}},a.createElement(f.x,{component:"span",my:"auto",mr:"xs"},a.createElement(s.Z,null)),a.createElement("span",null,`${e?.version??"<未连接>"} at ${b}`)),M[P["下载速度"]].visible&&a.createElement("div",{style:{flex:"1 1 10%",order:P["下载速度"]}},a.createElement(f.x,{component:"span",my:"auto",mr:"xs"},z&&a.createElement(i.Z,null),a.createElement(c.Z,null)),a.createElement("span",null,`${Z}/s (${(0,l.qj)(1024*S.downRateLimit)})`)),M[P["上传速度"]].visible&&a.createElement("div",{style:{flex:"1 1 15%",order:P["上传速度"]}},a.createElement(f.x,{component:"span",my:"auto",mr:"xs"},z&&a.createElement(i.Z,null),a.createElement(m.Z,null)),a.createElement("span",null,`${N}/s (${(0,l.qj)(1024*S.upRateLimit)})`)),M[P["剩余空间"]].visible&&a.createElement("div",{style:{flex:"1 1 12%",order:P["剩余空间"]}},a.createElement(f.x,{component:"span",my:"auto",mr:"xs"},a.createElement(d.Z,null)),a.createElement("span",null,`剩余空间: ${(0,l.Iy)(S.free)}`)),M[P["列表总大小"]].visible&&a.createElement("div",{style:{flex:"1 1 12%",order:P["列表总大小"]}},`列表总大小: ${A}`),M[P["选中大小"]].visible&&a.createElement("div",{style:{flex:"1 1 20%",order:P["选中大小"]}},`选中大小: ${x}, 完成 ${T}, 剩余 ${I}`),a.createElement("div",{style:{flexShrink:0,display:"flex",order:100}},a.createElement(h.eo,{sz:"0.9rem",btn:"md"}),a.createElement(h.lv,{sz:"0.9rem",btn:"md"}),a.createElement(h.eM,{sz:"0.9rem",btn:"md"})))}r()}catch(k){r(k)}}),1)},4390:(e,t,n)=>{n.d(t,{ZS:()=>z,oT:()=>x,FG:()=>I,D1:()=>$,ys:()=>T,jj:()=>Z,Rz:()=>D,__:()=>A,$0:()=>O,bQ:()=>M,n6:()=>q,eC:()=>R,_B:()=>P,qd:()=>F,fX:()=>L,Pi:()=>N});var r,a=n(6172),l=n(7294),o=n(7703),s=n(4349),i=n(8342),c=n(4778),m=n(6410),d=n(552),u=n(5311),p=n(5042),f=n(394),h=n(107),E=n(5544),g=n(9387),v=n(6973),b=n(8328);function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},w.apply(this,arguments)}const y=function(e){return l.createElement("svg",w({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 6.35 6.35"},e),r||(r=l.createElement("path",{d:"M.9.26A.64.64 0 0 0 .26.9v4.54c0 .35.3.64.64.64h4.54c.35 0 .64-.29.64-.64V.9a.64.64 0 0 0-.64-.64zM.9.7h4.54c.12 0 .2.09.2.2v2.04l-1.44.01a.22.22 0 0 0-.2.15l-.4 1.07-.84-2.82a.22.22 0 0 0-.42 0l-.47 1.6H.7V.9C.7.8.8.7.9.7m1.65 1.48.83 2.75a.22.22 0 0 0 .41.01l.57-1.55h1.28v2.05a.2.2 0 0 1-.2.2H.9a.2.2 0 0 1-.2-.2V3.38h1.34a.22.22 0 0 0 .2-.16Z"})))};var C;function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},k.apply(this,arguments)}const S=function(e){return l.createElement("svg",k({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 6.35 6.35"},e),C||(C=l.createElement("path",{d:"M.9.26A.64.64 0 0 0 .26.9v4.55c0 .35.3.64.64.64h4.55c.35 0 .64-.3.64-.64V.9a.64.64 0 0 0-.64-.64zM2.26 1.6a.4.4 0 0 1 .39.4v2.38a.4.4 0 0 1-.4.4.4.4 0 0 1-.4-.4v-2.4a.4.4 0 0 1 .4-.4zm1.85 0a.4.4 0 0 1 .4.4L4.5 4.36a.4.4 0 0 1-.4.4.4.4 0 0 1-.4-.4l.01-2.39a.4.4 0 0 1 .4-.4z"})))};function x(){const e=(0,a.rZ)();return l.createElement(o.Z,{size:"1rem",stroke:e.colors.orange[3],fill:e.colors.yellow[3]})}function T(){const e=(0,a.rZ)();return l.createElement(s.Z,{size:"1rem",fill:e.colors.indigo[4]})}function I(){const e=(0,a.rZ)();return l.createElement(i.Z,{size:"1rem",fill:e.colors.green[7]})}function z(){const e=(0,a.rZ)();return l.createElement(y,{width:"1rem",height:"1rem",fill:e.colors.red[6]})}function D(){const e=(0,a.rZ)();return l.createElement(c.Z,{size:"1rem",fill:e.colors.cyan[4]})}function M(){const e=(0,a.rZ)();return l.createElement(m.Z,{size:"1rem",fill:e.colors.lime[7]})}function R(){const e=(0,a.rZ)();return l.createElement(S,{width:"1rem",height:"1rem",fill:e.colors.yellow[6]})}function P(){const e=(0,a.rZ)();return l.createElement(d.Z,{size:"1rem",fill:e.colors.green[6]})}function F(){const e=(0,a.rZ)();return l.createElement(u.Z,{width:"1rem",height:"1rem",fill:e.colors.red[6]})}function Z(){const e=(0,a.rZ)();return l.createElement(p.Z,{size:"1rem",fill:e.colors.red[6]})}function N(){const e=(0,a.rZ)();return l.createElement(f.Z,{size:"1rem",fill:e.colors.cyan[4]})}function A(){const e=(0,a.rZ)();return l.createElement(h.Z,{size:"1rem",stroke:e.colors.indigo[9],fill:e.colors.blue[4]})}function L(){const e=(0,a.rZ)();return l.createElement(E.Z,{size:"1rem",stroke:e.colors.indigo[9],fill:e.colors.blue[4]})}function O(){const e=(0,a.rZ)();return l.createElement(g.Z,{size:"1rem",fill:e.colors.indigo[4]})}function $(){const e=(0,a.rZ)();return l.createElement(v.Z,{size:"1rem",fill:e.colors.green[9]})}const q={[b.qb.stopped]:R,[b.qb.queuedToVerify]:N,[b.qb.queuedToDownload]:N,[b.qb.queuedToSeed]:N,[b.qb.verifying]:N,[b.qb.downloading]:T,[b.qb.seeding]:I}},8579:(e,t,n)=>{n.d(t,{J:()=>l});var r=n(7294),a=n(5948);const l=({children:e,...t})=>{const[n,l]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=requestAnimationFrame((()=>{l(!0)}));return()=>{cancelAnimationFrame(e),l(!1)}}),[]),n?r.createElement(a.bK,{...t},e):null}},727:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{$8:()=>D,GL:()=>q,PY:()=>$,jB:()=>F});var a=n(1938),l=n(1972),o=n(4340),s=n(61),i=n(2160),c=n(7396),m=n(99),d=n(7826),u=n(2134),p=n(4094),f=n(7060),h=n(9353),E=n(4095),g=n(8913),v=n(7294),b=n(5948),w=n(8579),y=n(9362),C=n(4476),k=e([g,C]);[g,C]=k.then?(await k)():k;const S={minSize:30,size:150,maxSize:2e3};function x(e,t,n,r,a,l,o){const s=(0,v.useContext)(g.E_),[i,c]=(0,v.useState)(s.getTableColumnVisibility(e)),[m,d]=(0,v.useState)(s.getTableColumnOrder(e)),[u,h]=(0,v.useState)(s.getTableColumnSizes(e)),[E,b]=(0,v.useState)(s.getTableSortBy(e)),[w,y]=(0,v.useState)({}),[C,k]=(0,v.useState)(new Set);(0,v.useEffect)((()=>{s.setTableColumnVisibility(e,i),o?.(i)}),[s,i,o,e]),(0,v.useEffect)((()=>{s.setTableColumnOrder(e,m)}),[s,m,e]),(0,v.useEffect)((()=>{s.setTableColumnSizes(e,u)}),[s,u,e]),(0,v.useEffect)((()=>{s.setTableSortBy(e,E)}),[s,E,e]),(0,v.useEffect)((()=>{y(Object.fromEntries(r.map((e=>[e,!0]))))}),[r]);const x=(0,p.b7)({columns:t,data:n,defaultColumn:S,getRowId:a,enableExpanding:void 0!==l,getSubRows:l,enableHiding:!0,onColumnVisibilityChange:c,onColumnOrderChange:d,enableColumnResizing:!0,columnResizeMode:"onChange",onColumnSizingChange:h,enableSorting:!0,onSortingChange:b,enableRowSelection:!0,state:{columnVisibility:i,columnOrder:m,columnSizing:u,sorting:E,rowSelection:w},getCoreRowModel:(0,f.sC)(),getExpandedRowModel:(0,f.rV)(),getSortedRowModel:(0,f.tj)()});return(0,v.useEffect)((()=>{0===m.length&&d(x.getAllLeafColumns().map((e=>e.id)))}),[m,x]),(0,v.useEffect)((()=>{if(!x.getCanSomeRowsExpand())return;const e=new Set,t=n=>{if(w[n.id])return!0;let r=!1;return n.subRows.forEach((e=>{t(e)&&(r=!0)})),!!r&&(e.add(n.id),!0)};x.getCoreRowModel().rows.forEach(t),k(e)}),[x,w]),[x,i,c,m,d,u,E,C]}function T(e,t,n,r){const[a,l]=(0,v.useState)(-1),o=(0,v.useCallback)(((a,o,s)=>{const i=e.getRowModel().rows;if(!(o<0||o>=i.length)){if(a.shiftKey&&a.modKey&&-1!==s){const e=c();t({verb:"add",ids:e})}else if(a.shiftKey&&-1!==s){const e=c();t({verb:"set",ids:e})}else a.modKey?t({verb:"toggle",ids:[n(i[o].original)]}):a.isRmb&&i[o].getIsSelected()||t({verb:"set",ids:[n(i[o].original)]});a.shiftKey?document.getSelection()?.removeAllRanges():l(o),void 0!==r&&r(n(i[o].original))}function c(){const e=Math.min(o,s),t=Math.max(o,s),r=[];for(let a=e;a<=t;a++)r.push(n(i[a].original));return r}}),[n,t,r,e]);return[a,o]}function I(e){const t=(0,v.useRef)(null),{value:n}=(0,C.V1)(),r=Math.ceil(16*n*1.6),a=(0,h.MG)({count:e,getScrollElement:()=>t.current,overscan:3,estimateSize:(0,v.useCallback)((()=>r),[r])}),{measure:l}=a;return(0,v.useEffect)((()=>{l()}),[r,l]),[t,r,a]}function z(e,t){const n=(0,v.useCallback)((()=>{null!=e.current&&null!=t.current&&(t.current.style.translate=-e.current.scrollLeft+"px")}),[e,t]),r=(0,v.useCallback)((e=>{t.current=e,n()}),[n,t]);return[(0,v.useCallback)((t=>{e.current=t,n()}),[n,e]),r,n]}function D(){const[e,t]=(0,v.useReducer)(((e,t)=>{if("set"===t.verb)return t.ids;if("toggle"===t.verb){const n=new Set(e);return t.ids.forEach((e=>{n.has(e)?n.delete(e):n.add(e)})),Array.from(n)}{const n=new Set(e);return t.ids.forEach((e=>n.add(e))),Array.from(n)}}),[]);return[e,t]}function M(e){return v.createElement(v.Fragment,null,e.row.getVisibleCells().map((e=>v.createElement("div",{key:e.id,className:"td",style:{width:e.column.getSize()}},(0,p.ie)(e.column.columnDef.cell,e.getContext())))))}const R=(0,v.memo)(M,((e,t)=>e.row.original===t.row.original&&e.expanded===t.expanded&&e.columnSizing===t.columnSizing&&e.columnVisibility===t.columnVisibility&&e.columnOrder===t.columnOrder)),P=v.createContext(!1);function F(){return(0,v.useContext)(P)}function Z(e){const{onRowDoubleClick:t,row:n}=e,r=(0,v.useCallback)((()=>{void 0!==t&&t(n.original)}),[t,n.original]),{onRowClick:a,index:l,lastIndex:o}=e,s=(0,v.useCallback)((e=>{a({modKey:(0,y.jb)(e),shiftKey:e.shiftKey,isRmb:2===e.button},l,o)}),[l,o,a]),i=(0,v.useRef)(null),c=(0,v.useCallback)((e=>{let t=l;if("ArrowDown"===e.key)t+=1;else if("ArrowUp"===e.key)t-=1;else if("ContextMenu"!==e.key)return;if(e.preventDefault(),null!=i.current){if("ArrowDown"===e.key&&null!=i.current.nextElementSibling){const e=i.current.nextElementSibling;e.scrollIntoView({behavior:"instant",block:"nearest"}),e.focus()}if("ArrowUp"===e.key&&null!=i.current.previousElementSibling){const e=i.current.previousElementSibling;e.scrollIntoView({behavior:"instant",block:"nearest"}),e.focus()}}a({modKey:(0,y.jb)(e),shiftKey:e.shiftKey,isRmb:"ContextMenu"===e.key},t,o)}),[l,o,a]);return v.createElement("div",{ref:i,className:"tr"+(e.selected?" selected":e.descendantSelected?" descendant-selected":""),style:{height:`${e.height}px`,transform:`translateY(${e.start}px)`},onClick:s,onContextMenu:s,onDoubleClick:r,onKeyDown:c,tabIndex:-1},v.createElement(P.Provider,{value:e.selected},v.createElement(R,{...e})))}const N=(0,v.memo)(Z);function A({headerGroup:e,height:t,resizerOffset:n,columnVisibility:r,setColumnVisibility:s,columnOrder:i,setColumnOrder:u,columns:p}){const[f,h,g]=(0,E.a)(),C=(0,v.useCallback)(((e,t)=>{s({...r,[e]:t})}),[r,s]),k=(0,v.useMemo)((()=>p.map((e=>e.id))),[p]),S=(0,v.useCallback)((e=>{if(null!=e.destination){let t=i.filter((e=>k.includes(e)));k.forEach((e=>{t.includes(e)||t.push(e)})),t=(0,y.l)(t,e.source.index,e.destination.index),u(t)}}),[k,i,u]);return v.createElement(a.x,{className:"tr",onContextMenu:g,h:`${t}px`},v.createElement(E.x,{contextMenuInfo:f,setContextMenuInfo:h,closeOnItemClick:!1},v.createElement(b.Z5,{onDragEnd:S},v.createElement(w.J,{droppableId:"tableheadercontextmenu"},(e=>v.createElement("div",{ref:e.innerRef,...e.droppableProps},p.map(((e,t)=>{const n=!(e.id in r)||r[e.id];return v.createElement(b._l,{draggableId:e.id,index:t,key:e.id},(t=>v.createElement(l.Z,{ref:t.innerRef,...t.draggableProps,noWrap:!0},v.createElement(o.v.Item,{icon:"name"===e.id?v.createElement(c.Z,{size:"1rem"}):n?v.createElement(m.Z,{size:"1rem"}):v.createElement(a.x,{miw:"1rem"}),onClick:()=>{"name"!==e.id&&C(e.id,!n)}},e.columnDef.header),v.createElement("div",{...t.dragHandleProps},v.createElement(d.Z,{size:"12"})))))})),e.placeholder))))),e.headers.map((e=>v.createElement(O,{key:e.id,header:e,resizerOffset:n}))))}const L=(0,v.memo)(A);function O({header:e,resizerOffset:t}){return v.createElement("div",{className:"th",style:{width:e.getSize()}},v.createElement("div",{onClick:e.column.getToggleSortingHandler(),style:{flexGrow:1}},v.createElement("span",null,!1!==e.column.getIsSorted()?"desc"===e.column.getIsSorted()?"▼ ":"▲ ":""),(0,p.ie)(e.column.columnDef.header,e.getContext())),v.createElement("div",{onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler(),className:"resizer "+(e.column.getIsResizing()?"isResizing":"")},null!=t&&v.createElement("div",{className:"resizer-guide"})))}function $(e){const[t,n,r,l,o,s,i,c]=x(e.tablename,e.columns,e.data,e.selected,e.getRowId,e.getSubRows,e.onVisibilityChange);void 0!==e.tableRef&&(e.tableRef.current={setExpanded:t.toggleAllRowsExpanded});const[m,d]=T(t,e.selectedReducer,e.getRowId,e.setCurrent),[u,p,f]=I(t.getRowModel().rows.length),h=(0,v.useMemo)((()=>t.getRowModel().rows.findIndex((t=>e.getRowId(t.original)===e.scrollToRow?.id))),[e,t]);(0,v.useEffect)((()=>{h>=0&&f.scrollToIndex(h,{align:"auto"})}),[h,f]);const E=t.getTotalSize(),g=(0,v.useRef)(null),[b,w,y]=z(u,g);return v.createElement("div",{className:"torrent-table-container"},v.createElement(a.x,{ref:w,sx:e=>({height:`${p}px`,width:`${E}px`,backgroundColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[2],flexShrink:0,position:"relative"})},t.getHeaderGroups().map((e=>v.createElement(L,{key:e.id,headerGroup:e,height:p,resizerOffset:t.getState().columnSizingInfo.deltaOffset,columnVisibility:n,setColumnVisibility:r,columnOrder:l,setColumnOrder:o,sorting:i,columns:t.getAllLeafColumns()})))),v.createElement("div",{ref:b,className:"torrent-table-rows",onScroll:y,tabIndex:-1},v.createElement("div",{className:"torrent-table",style:{height:`${f.getTotalSize()}px`,width:`${E}px`}},f.getVirtualItems().filter(((e,t)=>0!==t||e.index%2==0)).map((r=>{const a=t.getRowModel().rows[r.index];return v.createElement(N,{key:e.getRowId(a.original),row:a,selected:a.getIsSelected(),descendantSelected:c.has(a.id),expanded:a.getIsExpanded(),index:r.index,lastIndex:m,start:r.start,onRowClick:d,onRowDoubleClick:e.onRowDoubleClick,height:p,columnSizing:s,columnVisibility:n,columnOrder:l})})))))}function q(e){const t=(0,v.useRef)(null),[n,r]=(0,v.useState)(""),[l,o]=(0,v.useState)(!1),[c,m]=(0,v.useState)(!1),d=(0,v.useCallback)((t=>{t?.stopPropagation(),m(!0),r(e.currentName.split("/").pop()??"")}),[e.currentName]),p=(0,v.useRef)(null),f=(0,v.useCallback)((r=>{"Enter"===r.key&&e.onUpdate?.(n,(()=>{null!=t.current&&(t.current.readOnly=!0)}),(()=>{m(!1)})),"Escape"===r.key&&(m(!1),p.current?.focus())}),[n,e]);(0,v.useEffect)((()=>{c&&null!=t.current&&(t.current.focus(),t.current.select())}),[c]),(0,v.useEffect)((()=>{if(null!=p.current){const e=p.current.parentNode?.parentNode;return e.onfocus=()=>{p.current?.focus({preventScroll:!0})},()=>{e.onfocus=null}}}),[]);const{onArrowLeftRight:h}=e,E=(0,v.useCallback)((e=>{"F2"!==e.key||c?void 0!==h&&["ArrowLeft","ArrowRight"].includes(e.key)&&h(e.key):d()}),[c,h,d]);return v.createElement(a.x,{ref:p,onKeyDown:E,tabIndex:-1,onMouseEnter:()=>{o(!0)},onMouseLeave:()=>{o(!1)},sx:{display:"flex",alignItems:"center",width:"100%",height:"100%"}},e.children,c?v.createElement(s.o,{ref:t,value:n,sx:{flexGrow:1,height:"100%"},styles:{input:{height:"1.5rem",minHeight:"1.5rem",lineHeight:"1.3rem"}},onChange:e=>{r(e.target.value)},onBlur:()=>{m(!1)},onKeyDown:f,onClick:e=>{e.stopPropagation()},onDoubleClick:e=>{e.stopPropagation()}}):v.createElement(a.x,{pl:"xs",sx:{flexGrow:1,textOverflow:"ellipsis",overflow:"hidden"}},e.currentName),l&&!c&&void 0!==e.onUpdate?v.createElement(i.A,{onClick:d,title:"Rename (F2)",sx:e=>({flexShrink:0,".selected &":{color:e.colors.gray[2]},"@media (hover: hover)":{"&:hover":{color:"dark"===e.colorScheme?e.white:e.colors.dark[8],backgroundColor:"rgba(127, 127, 127, 0.15)"},".selected &:hover":{color:e.white}}})},v.createElement(u.Z,{size:"1rem"})):v.createElement(v.Fragment,null))}r()}catch(U){r(U)}}))},2298:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{R:()=>j,r:()=>X});var a=n(7294),l=n(7129),o=n(8913),s=n(8328),i=n(9362),c=n(6716),m=n(4908),d=n(1698),u=n(1298),p=n(9019),f=n(6767),h=n(4789),E=n(552),g=n(727),v=n(6172),b=n(1938),w=n(3330),y=n(391),C=n(1950),k=n(61),S=n(2160),x=n(3515),T=n(4340),I=n(5918),z=n(3847),D=n(6146),M=n(4095),R=n(5409),P=n(1821),F=n(8645),Z=n(9603),N=e([z,g,Z,o]);[z,g,Z,o]=N.then?(await N)():N;const{TAURI:A,invoke:L}=await Promise.resolve().then(n.bind(n,4637)),O=[{name:"name",label:"名称",component:$,briefField:!0},{name:"size",label:"总大小",component:q,briefField:!0},{name:"done",label:"已下载",component:q},{name:"percent",label:"进度",component:U},{name:"priority",label:"优先级",component:V}];function $(e){const{entry:t,fileTree:n}=e,r=t.subrows.length>0,l=(0,a.useCallback)((t=>{t.stopPropagation(),e.row.toggleExpanded()}),[e]),o=(0,v.rZ)(),s=(0,z.qL)(),c=(0,a.useCallback)(((t,r,a)=>{r(),t=(0,i.DO)(t),s.mutate({torrentId:n.torrentId,path:e.entry.fullpath,name:t},{onSettled:a,onError:()=>{D.N9.show({color:"red",message:"Failed to update file path"})},onSuccess:()=>{n.updatePath(e.entry.fullpath,t),(0,z.xS)(e.treeName)}})}),[s,n,e.entry.fullpath,e.treeName]),u=(0,F.Z2)(),p=(0,a.useCallback)((t=>{0!==e.row.subRows.length&&("ArrowLeft"===t&&e.row.getIsExpanded()&&e.row.toggleExpanded(),"ArrowRight"!==t||e.row.getIsExpanded()||e.row.toggleExpanded())}),[e.row]);return a.createElement(g.GL,{currentName:e.entry.name,onArrowLeftRight:p,onUpdate:"filetree"===e.treeName&&u>=15?c:void 0},a.createElement(b.x,{sx:{width:1.6*e.entry.level+"rem",flexShrink:0}}),a.createElement(b.x,{w:"1.4rem",mx:"auto",sx:{flexShrink:0}},e.entry.wantedUpdating?a.createElement(w.a,{size:"1.2rem",color:"dark"===o.colorScheme?o.colors.cyan[4]:o.colors.cyan[9]}):a.createElement(y.X,{checked:!0===e.entry.want||void 0===e.entry.want,indeterminate:void 0===e.entry.want,onChange:t=>{e.onCheckboxChange(e.entry.fullpath,t.currentTarget.checked),(0,z.xS)(e.treeName)},onClick:e=>{e.stopPropagation()},onDoubleClick:e=>{e.stopPropagation()}})),a.createElement(b.x,{ml:"xs",className:"icon-container"},r?e.row.getIsExpanded()?a.createElement(m.Z,{size:"1.1rem",onClick:l,style:{cursor:"pointer"}}):a.createElement(d.Z,{size:"1.1rem",onClick:l,style:{cursor:"pointer"}}):a.createElement(Z.a,{name:e.entry.name})))}function q(e){const t=(0,a.useMemo)((()=>(0,i.Iy)(e.entry[e.fieldName])),[e]);return a.createElement("div",null,t)}function U(e){const t=(0,a.useContext)(o.E_),n=e.entry.percent??0;let r="default";return"多颜色"===t.values.interface.progressbarStyle&&(!1===e.entry.want?r="grey":100===n&&(r="dark-green")),a.createElement(c.k,{now:n,className:"white-outline",variant:r})}function V(e){const t=e.entry.priority;return a.createElement(C.C,{radius:"md",variant:"filled",bg:void 0===t?"gray":s.vw.get(t)},void 0===t?"mixed":s.yN.get(t))}function _(e,t){const n=e.fullpath.toLowerCase().substring(e.fullpath.indexOf("/")+1);return t.every((e=>n.includes(e)))}function j(e,t){return(0,a.useCallback)(((n,r)=>{e.setWanted(n,r,t)}),[e,t])}function W(e,t,n){const[r,l]=(0,a.useReducer)(((e,t)=>{if(e.length===t.length){for(let n=0;n<e.length;n++)if(e[n]!==t[n])return t;return e}return t}),[]),o=(0,a.useRef)((e=>[]));o.current=(0,a.useCallback)((r=>{const a=[],l=e=>{!r&&!0!==t.findEntry(e.fullpath)?.isSelected||0!==e.subrows.length&&!_(e,n)?e.subrows.forEach(l):a.push(e.fullpath)};return e.forEach(l),a}),[e,t,n]),(0,a.useEffect)((()=>{0!==n.length&&(t.selectAction({verb:"set",ids:o.current(!1)}),l(t.getSelected()))}),[t,n]);const s=(0,a.useRef)((()=>{})),i=(0,R.QU)();return s.current=(0,a.useCallback)((()=>{t.selectAction({verb:"set",ids:o.current(!0)}),l(t.getSelected())}),[t]),(0,a.useEffect)((()=>()=>{i.handlers.selectAll=()=>{}}),[i]),{selected:r,selectedReducer:(0,a.useCallback)((e=>{t.selectAction(e),l(t.getSelected()),!0!==e.isReset&&(i.handlers.selectAll=()=>{s.current?.()})}),[t,i])}}function G({setSearchTerms:e}){const t=(0,v.rZ)(),n=(0,a.useMemo)((()=>(0,P.Z)(e,500,{trailing:!0,leading:!1})),[e]),r=(0,a.useRef)(null),l=(0,a.useCallback)((()=>{null!=r.current&&(r.current.value=""),e([])}),[e]),o=(0,a.useCallback)((e=>{n(e.currentTarget.value.split(" ").map((e=>e.trim().toLowerCase())).filter((e=>""!==e)))}),[n]);return a.createElement(b.x,null,a.createElement(k.o,{ref:r,icon:a.createElement(u.Z,{size:"1rem"}),rightSection:a.createElement(S.A,{onClick:l,title:"Clear"},a.createElement(p.Z,{size:"1rem",color:t.colors.red[6]})),placeholder:"搜索文件",onInput:o,styles:{root:{height:"1.5rem"},input:{minHeight:"1.5rem",height:"1.5rem",lineHeight:"1rem"}}}))}function X(e){const t=(0,a.useContext)(o.E_),n=(0,a.useContext)(o.Dk),r=e.onCheckboxChange,l=(0,a.useCallback)(((e,t)=>{const[n,r]=[e.original,t.original];return n.fullpath<r.fullpath?-1:1}),[]),s=(0,a.useMemo)((()=>O.filter((t=>!0===t.briefField||!0!==e.brief)).map((t=>{const n={header:t.label,accessorKey:t.name,cell:n=>a.createElement(t.component,{fileTree:e.fileTree,fieldName:t.name,entry:n.row.original,row:n.row,treeName:!0===e.brief?"filetreebrief":"filetree",onCheckboxChange:r})};return"name"===t.name&&(n.sortingFn=l),n}))),[e.brief,e.fileTree,l,r]),c=(0,a.useCallback)((e=>e.fullpath),[]),m=(0,a.useCallback)((e=>e.subrows),[]),d=(0,a.useCallback)(((t,r=!1)=>{if(A){if(void 0===e.downloadDir||""===e.downloadDir)return;let a=e.downloadDir;a.endsWith("/")||a.endsWith("\\")||(a+="/"),a+=t,a=(0,i.QY)(a,n),L("shell_open",{path:a,reveal:r}).catch((e=>{D.N9.show({title:"打开失败",message:a,color:"red"})}))}}),[e.downloadDir,n]),u=(0,a.useCallback)((e=>{const t=e.fullpath+(e.subrows.length>0?"/":"");d(t)}),[d]),[p,f,h]=(0,M.a)(),E=(0,a.useRef)(),[v,b]=(0,a.useState)([]),w=(0,a.useMemo)((()=>{if(0===v.length)return e.data;const t=e=>{const n=[];return e.forEach((e=>{if(e.subrows.length>0){const r={...e};r.subrows=t(r.subrows),(r.subrows.length>0||_(r,v))&&n.push(r)}else _(e,v)&&n.push(e)})),n};return t(e.data)}),[v,e.data]);(0,a.useEffect)((()=>{v.length>0?E.current?.setExpanded(!0):E.current?.setExpanded(!1)}),[v]);const[y,C]=(0,a.useState)(""),{selected:k,selectedReducer:S}=W(w,e.fileTree,v);(0,a.useEffect)((()=>{S({verb:"set",ids:[],isReset:!0}),C("")}),[e.fileTree.torrenthash,S]);const[T,I]=(0,a.useReducer)((e=>{const n=!e;return n||b([]),t.values.interface.showFilesSearchBox=n,n}),t.values.interface.showFilesSearchBox);return a.createElement(x.k,{w:"100%",h:"100%",onContextMenu:h,direction:"column"},!0===e.brief?a.createElement(a.Fragment,null):a.createElement(B,{contextMenuInfo:p,setContextMenuInfo:f,fileTree:e.fileTree,selected:k,currentRow:y,onEntryOpen:d,setExpanded:E.current?.setExpanded,toggleFileSearchBox:I}),T&&a.createElement(G,{setSearchTerms:b}),a.createElement("div",{style:{flexGrow:1}},a.createElement(g.PY,{tablename:!0===e.brief?"filetreebrief":"filetree",tableRef:E,columns:s,data:w,selected:k,getRowId:c,getSubRows:m,selectedReducer:S,setCurrent:C,onRowDoubleClick:u})))}function B(e){const t=(0,a.useContext)(o.E_),{onEntryOpen:n}=e,r=(0,a.useCallback)((t=>{const r=e.fileTree.findEntry(e.currentRow);if(void 0===r)return;const a=r.fullpath+((0,l.o)(r)?"/":"");n(a,t)}),[n,e.fileTree,e.currentRow]),{mutate:s}=(0,z.n5)(),i=(0,a.useCallback)((t=>{const n=Array.from(e.selected.map((t=>e.fileTree.getChildFilesIndexes(t))).reduce(((e,t)=>(t.forEach((t=>e.add(t))),e)),new Set));s({torrentIds:[e.fileTree.torrentId],fields:{[t]:n}},{onSuccess:()=>{D.N9.show({message:"Priority updated",color:"green"})}})}),[s,e.fileTree,e.selected]),c=(0,a.useCallback)((t=>{const n=Array.from(e.selected.map((t=>e.fileTree.getChildFilesIndexes(t))).reduce(((e,t)=>(t.forEach((t=>e.add(t))),e)),new Set));s({torrentIds:[e.fileTree.torrentId],fields:{[t?"files-wanted":"files-unwanted"]:n}},{onSuccess:()=>{D.N9.show({message:"Files updated",color:"green"})}})}),[s,e.fileTree,e.selected]),[p,g]=(0,a.useReducer)((e=>(e=!e,t.values.interface.flatFileTree=e,(0,z.xS)("filetree"),e)),t.values.interface.flatFileTree);return a.createElement(M.x,{contextMenuInfo:e.contextMenuInfo,setContextMenuInfo:e.setContextMenuInfo},A&&a.createElement(a.Fragment,null,a.createElement(T.v.Item,{onClick:()=>{r(!1)},icon:a.createElement(f.Z,{size:"1.1rem"}),disabled:""===e.currentRow},a.createElement(I.x,{weight:"bold"},"打开文件")),a.createElement(T.v.Item,{onClick:()=>{r(!0)},icon:a.createElement(h.Z,{size:"1.1rem"}),disabled:""===e.currentRow},a.createElement(I.x,null,"打开目录")),a.createElement(T.v.Divider,null)),a.createElement(T.v.Item,{onClick:()=>{i("priority-high")},icon:a.createElement(E.Z,{color:"tomato",size:"1.1rem"}),disabled:0===e.selected.length},"优先级-高"),a.createElement(T.v.Item,{onClick:()=>{i("priority-normal")},icon:a.createElement(E.Z,{color:"seagreen",size:"1.1rem"}),disabled:0===e.selected.length},"优先级-正常"),a.createElement(T.v.Item,{onClick:()=>{i("priority-low")},icon:a.createElement(E.Z,{color:"gold",size:"1.1rem"}),disabled:0===e.selected.length},"优先级-低"),a.createElement(T.v.Divider,null),a.createElement(T.v.Item,{onClick:()=>{c(!0)},icon:a.createElement(y.X,{checked:!0,readOnly:!0}),disabled:0===e.selected.length},"包含"),a.createElement(T.v.Item,{onClick:()=>{c(!1)},icon:a.createElement(y.X,{readOnly:!0}),disabled:0===e.selected.length},"不包含"),a.createElement(T.v.Divider,null),a.createElement(T.v.Item,{onClick:()=>{e.setExpanded?.(!0)},icon:a.createElement(d.Z,{size:"1.1rem"})},"展开所有"),a.createElement(T.v.Item,{onClick:()=>{e.setExpanded?.(!1)},icon:a.createElement(m.Z,{size:"1.1rem"})},"折叠所有"),a.createElement(T.v.Divider,null),a.createElement(T.v.Item,{onClick:e.toggleFileSearchBox,icon:a.createElement(u.Z,{size:"1.1rem"})},"打开/关闭搜索"),a.createElement(T.v.Item,{onClick:g,icon:a.createElement(y.X,{checked:!p,readOnly:!0})},"树形列表"))}r()}catch(K){r(K)}}),1)},7554:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{g:()=>g});var a=n(7294),l=n(9362),o=n(727),s=n(6716),i=n(3515),c=n(8913),m=e([c,o]);[c,o]=m.then?(await m)():m;const{TAURI:d}=await Promise.resolve().then(n.bind(n,4637));d&&await Promise.all([n.e(276),n.e(717)]).then(n.bind(n,2435));const u=[{name:"address",label:"IP"},{name:"port",label:"端口"},{name:"clientName",label:"客户端"},{name:"flagStr",label:"Flags"},{name:"progress",label:"进度",component:h},{name:"rateToPeer",label:"上传速度",component:f},{name:"rateToClient",label:"下载速度",component:f},{name:"cachedEncrypted",label:"加密"},{name:"cachedFrom",label:"来源"},{name:"cachedConnection",label:"方向"},{name:"cachedProtocol",label:"协议"},{name:"cachedStatus",label:"状态"}];function p(e){const t=e.entry.cachedCountryIso;return a.createElement(i.k,{gap:"sm",style:{width:"100%"}},void 0!==t&&a.createElement("span",{className:`fi fi-${t.toLowerCase()}`}),a.createElement("span",null,e.entry.cachedCountryName))}function f(e){const t=e.entry[e.fieldName],n=(0,a.useMemo)((()=>t>0?`${(0,l.Iy)(t)}/s`:""),[t]);return a.createElement("div",{style:{width:"100%",textAlign:"right"}},n)}function h(e){const t=(0,a.useContext)(c.E_),n=100*e.entry[e.fieldName],r=e.entry.rateToClient>0||e.entry.rateToPeer>0;return a.createElement(s.k,{now:n,className:"white-outline",animate:"动态"===t.values.interface.progressbarStyle&&r,variant:"多颜色"===t.values.interface.progressbarStyle&&r?"green":"default"})}d&&u.splice(1,0,{name:"cachedCountryName",label:"国家",columnId:"country",component:p});const E=u.map((e=>({header:e.label,accessorKey:e.name,id:e.columnId,accessorFn:e.accessorFn,cell:t=>void 0!==e.component?a.createElement(e.component,{entry:t.row.original,fieldName:e.name}):a.createElement("div",null,t.getValue())})));function g(e){const t=(0,a.useCallback)((e=>`${e.address}:${e.port}`),[]),[n,r]=(0,o.$8)();return a.createElement(o.PY,{tablename:"peers",columns:E,data:e.torrent.peers,selected:n,getRowId:t,selectedReducer:r})}r()}catch(v){r(v)}}),1)},4572:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{F9:()=>ie,Nn:()=>ce,XW:()=>se,hU:()=>ve,it:()=>ae,rZ:()=>ge}),n(6154);var a=n(7294),l=n(8645),o=n(8328),s=n(9362),i=n(6716),c=n(727),m=n(1938),d=n(1950),u=n(6172),p=n(4340),f=n(254),h=n(2691),E=n(5918),g=n(1411),v=n(8913),b=n(4390),w=n(3847),y=n(6146),C=n(4095),k=n(9696),S=n(7461),x=n(7271),T=n(6677),I=n(6767),z=n(4789),D=n(3327),M=n(311),R=n(955),P=n(8481),F=n(8001),Z=n(5544),N=n(4569),A=n(6534),L=n(9387),O=n(3603),$=n(1374),q=n(107),U=n(7932),V=n(5409),_=e([w,c,v]);[w,c,v]=_.then?(await _)():_;const{TAURI:j,invoke:W,copyToClipboard:G}=await Promise.resolve().then(n.bind(n,4637));function X(e){return void 0!==e.accessorFn}const B=(0,a.memo)((function(e){return e.fieldName in e.torrent?a.createElement("div",null,(0,s.e$)(e.torrent[e.fieldName])):a.createElement(a.Fragment,null)}),((e,t)=>{const n=e.torrent[e.fieldName],r=t.torrent[t.fieldName];return Math.abs((n-r)/r)<1/60/60})),K=[{name:"name",label:"名称",component:Y,requiredFields:["name","error","trackerStats","leftUntilDone"]},{name:"totalSize",label:"总大小",component:de},{name:"sizeWhenDone",label:"选定大小",component:de},{name:"leftUntilDone",label:"剩余",component:de},{name:"haveValid",label:"有效",component:de},{name:"downloadedEver",label:"已下载",component:de},{name:"uploadedEver",label:"已上传",component:de},{name:"uploadedEver",label:"已上传/已下载",component:ee,accessorFn:e=>0===e.uploadedEver?0:e.uploadedEver/e.downloadedEver,columnId:"simpleRatio",requiredFields:["uploadedEver","downloadedEver"]},{name:"percentDone",label:"进度",component:pe,requiredFields:["percentDone","rateDownload","rateUpload"]},{name:"rateDownload",label:"下载速度",component:ue},{name:"rateUpload",label:"上传速度",component:ue},{name:"status",label:"状态",component:ie},{name:"addedDate",label:"添加时间",component:ce},{name:"peersSendingToUs",label:"种子|活跃",component:te,columnId:"peersSendingToUs",accessorFn:e=>1e6*e.peersSendingToUs+e.cachedSeedsTotal},{name:"peersGettingFromUs",label:"下载|活跃",component:ne,columnId:"peersGettingFromUs",accessorFn:e=>1e6*e.peersGettingFromUs+e.cachedPeersTotal},{name:"eta",label:"剩余时间",component:re},{name:"uploadRatio",label:"分享率",component:J},{name:"trackerStats",label:"服务器",component:ae,columnId:"tracker",accessorFn:e=>e.cachedMainTracker},{name:"trackerStats",label:"服务器状态",component:le,columnId:"trackerStatus",accessorFn:e=>e.cachedTrackerStatus},{name:"doneDate",label:"完成时间",component:ce},{name:"activityDate",label:"最后活动时间",component:me},{name:"downloadDir",label:"保存目录",component:Q},{name:"bandwidthPriority",label:"优先级",component:oe},{name:"id",label:"ID",component:Q},{name:"queuePosition",label:"队列位置",component:H},{name:"secondsSeeding",label:"做种时长",component:B},{name:"isPrivate",label:"私有",component:Q},{name:"labels",label:"用户标签",component:se},{name:"group",label:"备用带宽",component:Q},{name:"file-count",label:"文件数目",component:H},{name:"pieceCount",label:"块数目",component:H},{name:"metadataPercentComplete",label:"元数据",component:pe}];function Y(e){let t=b.n6[e.torrent.status];e.torrent.status===o.qb.downloading&&0===e.torrent.pieceCount&&(t=b.$0),e.torrent.status===o.qb.stopped&&e.torrent.sizeWhenDone>0&&0===e.torrent.leftUntilDone&&(t=b.D1),(void 0!==e.torrent.error&&e.torrent.error>0||""!==e.torrent.cachedError)&&(t=b.jj);const n=(0,a.useMemo)((()=>e.torrent[e.fieldName]),[e.fieldName,e.torrent]),r=(0,w.qL)(),i=(0,a.useCallback)(((t,n,a)=>{n();const l=(0,s.DO)(e.torrent.name);(t=(0,s.DO)(t))===l?a():r.mutate({torrentId:e.torrent.id,path:l,name:t},{onSettled:a,onError:()=>{y.N9.show({color:"red",message:"Failed to rename torrent"})}})}),[r,e.torrent.id,e.torrent.name]),d=(0,l.Z2)();return a.createElement(c.GL,{currentName:n,onUpdate:d>=15?i:void 0},a.createElement(m.x,{pb:"xs",className:"icon-container"},a.createElement(t,null)))}function Q(e){return a.createElement("div",null,e.torrent[e.fieldName])}function H(e){const t=e.torrent[e.fieldName];return a.createElement("div",{style:{width:"100%",textAlign:"right"}},t<0?"":t)}function J(e){const t=e.torrent[e.fieldName];return a.createElement("div",{style:{width:"100%",textAlign:"right"}},t<0?"":Number(t).toFixed(2))}function ee(e){return a.createElement("div",{style:{width:"100%",textAlign:"right"}},0===e.torrent.uploadedEver?"-":0===e.torrent.downloadedEver?"∞":(e.torrent.uploadedEver/e.torrent.downloadedEver).toFixed(2))}function te(e){const t=e.torrent.peersSendingToUs,n=e.torrent.cachedSeedsTotal;return a.createElement("div",{style:{width:"100%",textAlign:"right"}},n<0?`${t}`:`${n} (${t})`)}function ne(e){const t=e.torrent.peersGettingFromUs,n=e.torrent.cachedPeersTotal;return a.createElement("div",{style:{width:"100%",textAlign:"right"}},n<0?`${t}`:`${n} (${t})`)}function re(e){const t=e.torrent[e.fieldName];return t>=0?a.createElement(B,{...e}):-1===t?a.createElement(a.Fragment,null):a.createElement("div",null,"∞")}function ae(e){return a.createElement("div",null,e.torrent.cachedMainTracker)}function le(e){return a.createElement("div",null,e.torrent.cachedTrackerStatus)}function oe(e){const t=e.torrent[e.fieldName];return a.createElement(d.C,{radius:"md",variant:"filled",bg:o.vw.get(t)},o.yN.get(t))}function se(e){const t=e.torrent.labels;return a.createElement(a.Fragment,null,t?.map((e=>a.createElement(d.C,{key:e,radius:"md",variant:"filled",className:"torrent-label white-outline"},e))))}function ie(e){let t=o.l7[e.torrent.status];e.torrent.status===o.qb.downloading&&0===e.torrent.pieceCount&&(t="Magnetizing");const n=e.torrent.status===o.qb.downloading&&!0===e.torrent.sequentialDownload?" sequentially":"";return a.createElement("div",null,t+n)}function ce(e){const t=e.torrent[e.fieldName]>0?(0,s.dh)(e.torrent[e.fieldName]):"";return a.createElement("div",null,t)}function me(e){const t=e.torrent[e.fieldName]>0?(0,s.dh)(e.torrent[e.fieldName]):"",n=Math.floor(Date.now()/1e3)-e.torrent[e.fieldName];return a.createElement("div",{title:t,style:{width:"100%",textAlign:"right"}},n<30?"now":""===t?"":`${(0,s.e$)(n)} ago`)}function de(e){const t=e.torrent[e.fieldName],n=(0,a.useMemo)((()=>(0,s.Iy)(t)),[t]);return a.createElement("div",{style:{width:"100%",textAlign:"right"}},n)}function ue(e){const t=e.torrent[e.fieldName],n=(0,a.useMemo)((()=>t>0?`${(0,s.Iy)(t)}/s`:""),[t]);return a.createElement("div",{style:{width:"100%",textAlign:"right"}},n)}function pe(e){const t=(0,a.useContext)(v.E_),n=100*e.torrent[e.fieldName],r=e.torrent.rateDownload>0||e.torrent.rateUpload>0;let l="default";return"多颜色"===t.values.interface.progressbarStyle&&(void 0!==e.torrent.error&&e.torrent.error>0||""!==e.torrent.cachedError?l="red":r?l="green":e.torrent.status===o.qb.stopped&&e.torrent.sizeWhenDone>0&&0===e.torrent.leftUntilDone&&(l="dark-green")),a.createElement(i.k,{now:n,className:"white-outline",animate:"动态"===t.values.interface.progressbarStyle&&r,variant:l})}const fe=K.map((e=>{const t=t=>a.createElement(e.component,{fieldName:e.name,torrent:t.row.original});return X(e)?{header:e.label,accessorFn:e.accessorFn,id:e.columnId,cell:t}:{header:e.label,accessorKey:e.name,cell:t}})),he=K.map((e=>({id:e.columnId??e.name,requires:e.requiredFields??[e.name]})));function Ee(e){const t=he.reduce(((t,n)=>(n.id in e&&!e[n.id]||n.requires.forEach((e=>t.add(e))),t)),new Set);return o.QK.forEach((e=>t.add(e))),j&&t.add("hashString"),Array.from(t).sort()}function ge(){const e=(0,a.useContext)(v.E_);return(0,a.useMemo)((()=>Ee(e.getTableColumnVisibility("torrents"))),[e])}function ve(e){const t=(0,a.useContext)(v.Dk),n=(0,a.useCallback)((e=>String(e.id)),[]),{onColumnVisibilityChange:r}=e,o=(0,a.useCallback)((e=>{r(Ee(e))}),[r]),i=(0,a.useCallback)(((n,r=!1)=>{if(j){if(void 0===n.downloadDir||""===n.downloadDir)return;let e=n.downloadDir;e.endsWith("/")||e.endsWith("\\")||(e+="/"),e+=(0,s.DO)(n.name),e=(0,s.QY)(e,t),W("shell_open",{path:e,reveal:r}).catch((t=>{y.N9.show({title:"打开失败",message:e,color:"red"})}))}else e.modals.current?.editTorrent()}),[e.modals,t]),d=(0,l.uM)(),u=(0,a.useMemo)((()=>Array.from(d).map(String)),[d]),[p,f,h]=(0,C.a)();return a.createElement(m.x,{w:"100%",h:"100%",onContextMenu:h},a.createElement(we,{contextMenuInfo:p,setContextMenuInfo:f,modals:e.modals,onRowDoubleClick:i,setStatus:e.setStatus}),a.createElement(c.PY,{tablename:"torrents",columns:fe,data:e.torrents,getRowId:n,selected:u,selectedReducer:e.selectedReducer,setCurrent:e.setCurrentTorrent,onVisibilityChange:o,onRowDoubleClick:i,scrollToRow:e.scrollToRow}))}function be(e){const t=(0,l.EL)(),n=(0,l.uM)(),{onRowDoubleClick:r}=((0,l.Z2)(),e),o=(0,a.useCallback)((e=>{const n=t.torrents.find((e=>e.id===t.current));void 0!==n&&r(n,e)}),[r,t]),i=(0,w.vM)(),c=(0,a.useCallback)(((e,t)=>{i({method:e,torrentIds:Array.from(n)},{onSuccess:()=>{y.N9.show({message:t,color:"green"})}})}),[i,n]),[d,v]=(0,a.useState)(!1),b=(0,a.useRef)(null),[_,W]=(0,a.useState)((()=>new DOMRect(0,-100,0,0))),X=(0,a.useCallback)((()=>{null!=b.current&&0!==n.size&&(W(b.current.getBoundingClientRect()),v(!0))}),[n]),B=(0,a.useCallback)((()=>{v(!1),W(new DOMRect(0,-100,0,0))}),[]),K=(0,a.useCallback)((()=>{if(0===n.size)return;let e=new Map;t.torrents.forEach((t=>{n.has(t.id)&&(e.has(t.name)||e.set(t.name,0))})),G(Array.from(e.keys()).join("\n")),y.N9.show({message:"名称已复制到剪切板",color:"green"})}),[t.torrents,n]),Y=(0,a.useCallback)((()=>{if(0===n.size)return;let e=new Map;t.torrents.forEach((t=>{const r=(0,s.Nw)(t.downloadDir)+(0,s.DO)(t.name);n.has(t.id)&&(e.has(r)||e.set(r,0))})),G(Array.from(e.keys()).join("\n")),y.N9.show({message:"路径已复制到剪切板",color:"green"})}),[t.torrents,n]),Q=(0,a.useCallback)((()=>{if(0===n.size)return;const e=t.torrents.filter((e=>n.has(e.id))).map((e=>e.magnetLink));G(e.join("\n")),y.N9.show({message:"磁力链接已复制到剪切板",color:"green"})}),[t.torrents,n]),H=(0,V.QU)();(0,a.useEffect)((()=>(H.handlers.copyToClipboard=K,()=>{H.handlers.copyToClipboard=()=>{}})),[K,H]);const J=(0,u.rZ)();return a.createElement(a.Fragment,null,a.createElement(p.v,{openDelay:100,closeDelay:400,opened:d,onChange:v,middlewares:{shift:!0,flip:!0},position:"right-start",zIndex:301},a.createElement(f.h,null,a.createElement(m.x,{onMouseDown:B,sx:{position:"absolute",left:0,top:0,height:"100vh",width:"100vw",zIndex:d?100:-1}}),a.createElement(p.v.Target,null,a.createElement(h.z,{unstyled:!0,sx:{position:"absolute",border:0,padding:0,background:"transparent"},style:{left:_.x,top:_.y,width:`calc(${_.width}px + 0.5em)`,height:_.height}})),a.createElement(p.v.Dropdown,{miw:"10rem"},a.createElement(p.v.Item,{onClick:()=>{c("queue-move-top","队列已更新")},icon:a.createElement(k.Z,{size:"1.1rem"})},"队列排到最前"),a.createElement(p.v.Item,{onClick:()=>{c("queue-move-up","队列已更新")},icon:a.createElement(S.Z,{size:"1.1rem"})},"队列向上移动"),a.createElement(p.v.Item,{onClick:()=>{c("queue-move-down","队列已更新")},icon:a.createElement(x.Z,{size:"1.1rem"})},"队列向下移动"),a.createElement(p.v.Item,{onClick:()=>{c("queue-move-bottom","队列已更新")},icon:a.createElement(T.Z,{size:"1.1rem"})},"队列排到最后")))),a.createElement(C.x,{contextMenuInfo:e.contextMenuInfo,setContextMenuInfo:e.setContextMenuInfo},a.createElement(m.x,{miw:"14rem"},j&&a.createElement(a.Fragment,null,a.createElement(p.v.Item,{onClick:()=>{o(!1)},onMouseEnter:B,icon:a.createElement(I.Z,{size:"1.1rem"}),disabled:void 0===t.current},a.createElement(E.x,{weight:"bold"},"打开文件")),a.createElement(p.v.Item,{onClick:()=>{o(!0)},onMouseEnter:B,icon:a.createElement(z.Z,{size:"1.1rem"}),disabled:void 0===t.current},a.createElement(E.x,null,"打开目录")),a.createElement(p.v.Divider,null)),a.createElement(p.v.Item,{onClick:()=>{c("torrent-start-now","强制开始")},onMouseEnter:B,icon:a.createElement(D.Z,{size:"1.1rem"}),disabled:0===n.size},"强制开始选中的种子"),a.createElement(p.v.Item,{onClick:()=>{c("torrent-start","开始")},onMouseEnter:B,icon:a.createElement(M.Z,{size:"1.1rem"}),rightSection:a.createElement(g.T,null,"F3"),disabled:0===n.size},"开始选中的种子"),a.createElement(p.v.Item,{onClick:()=>{c("torrent-stop","暂停")},onMouseEnter:B,icon:a.createElement(R.Z,{size:"1.1rem"}),rightSection:a.createElement(g.T,null,"F4"),disabled:0===n.size},"暂停选中的种子"),a.createElement(p.v.Divider,null),a.createElement(p.v.Item,{onClick:()=>e.modals.current?.remove(),onMouseEnter:B,icon:a.createElement(P.Z,{size:"1.1rem",color:J.colors.red[6]}),disabled:0===n.size,rightSection:a.createElement(g.T,null,"del")},"删除选中的任务"),a.createElement(p.v.Item,{onClick:()=>{c("torrent-verify","开始校验")},onMouseEnter:B,icon:a.createElement(F.Z,{size:"1.1rem"}),disabled:0===n.size},"重新校验选中的种子"),a.createElement(p.v.Divider,null),a.createElement(p.v.Item,{onClick:()=>{c("torrent-reannounce","重新汇报")},onMouseEnter:B,icon:a.createElement(Z.Z,{size:"1.1rem"}),disabled:0===n.size},"重新汇报(获取更多Peer)"),a.createElement(p.v.Item,{onClick:()=>e.modals.current?.move(),onMouseEnter:B,icon:a.createElement(N.Z,{size:"1.1rem"}),disabled:0===n.size,rightSection:a.createElement(g.T,null,"F6")},"变更数据保存目录"),a.createElement(p.v.Divider,null),a.createElement(p.v.Item,{onClick:K,onMouseEnter:B,icon:a.createElement(A.Z,{size:"1.1rem"}),disabled:0===n.size,rightSection:a.createElement(g.T,null,`${(0,s.Qh)()} C`)},"复制选中种子的名称"),a.createElement(p.v.Item,{onClick:Y,onMouseEnter:B,icon:a.createElement(A.Z,{size:"1.1rem"}),disabled:0===n.size},"复制选中种子的路径"),a.createElement(p.v.Item,{onClick:Q,onMouseEnter:B,icon:a.createElement(L.Z,{size:"1.1rem"}),disabled:0===n.size},"复制选中种子的磁力链接"),a.createElement(p.v.Divider,null),a.createElement(p.v.Item,{ref:b,icon:a.createElement(O.Z,{size:"1.1rem"}),rightSection:a.createElement($.Z,{size:"0.8rem"}),onMouseEnter:X,disabled:0===n.size},"队列"),a.createElement(p.v.Item,{onClick:()=>e.modals.current?.setLabels(),onMouseEnter:B,icon:a.createElement(q.Z,{size:"1.1rem"}),disabled:0===n.size,rightSection:a.createElement(g.T,null,"F7")},"设置用户标签"),a.createElement(p.v.Divider,null),a.createElement(p.v.Item,{onClick:()=>e.modals.current?.editTrackers(),icon:a.createElement(Z.Z,{size:"1.1rem"}),onMouseEnter:B,disabled:0===n.size},"修改Tracker..."),a.createElement(p.v.Item,{onClick:()=>e.modals.current?.editTorrent(),icon:a.createElement(U.Z,{size:"1.1rem"}),onMouseEnter:B,disabled:0===n.size},"修改限速等限制属性..."))))}const we=(0,a.memo)(be);r()}catch(ye){r(ye)}}),1)},1202:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{I:()=>u});var a=n(7294),l=n(8645),o=n(9362),s=n(727),i=e([s]);s=(i.then?(await i)():i)[0];const c=[{name:"announce",label:"URL"},{name:"announceState",label:"状态",columnId:"status",accessorFn:l.bx},{name:"nextAnnounceTime",label:"下次汇报",component:m},{name:"seederCount",label:"做种数",component:d},{name:"leecherCount",label:"用户数",component:d},{name:"downloadCount",label:"下载数",component:d}].map((e=>({header:e.label,accessorKey:e.name,accessorFn:e.accessorFn,cell:t=>void 0!==e.component?a.createElement(e.component,{entry:t.row.original,fieldName:e.name}):a.createElement("div",null,t.getValue())})));function m(e){if(1!==e.entry.announceState)return a.createElement("div",null,"-");const t=e.entry[e.fieldName]-Math.floor(Date.now()/1e3);return t>0?a.createElement("div",null,(0,o.e$)(t)):a.createElement("div",null,"-")}function d(e){const t=e.entry[e.fieldName];return a.createElement("div",{style:{width:"100%",textAlign:"right"}},t>=0?t:"")}function u(e){const t=(0,a.useCallback)((e=>String(e.id)),[]),[n,r]=(0,s.$8)();return a.createElement(s.PY,{tablename:"trackers",columns:c,data:e.torrent.trackerStats,selected:n,getRowId:t,selectedReducer:r})}r()}catch(p){r(p)}}))},102:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{N:()=>U});var a=n(2691),l=n(6172),o=n(3515),s=n(4340),i=n(1411),c=n(61),m=n(2160),d=n(3833),u=n(1821),p=n(7294),f=n(6955),h=n(9387),E=n(311),g=n(955),v=n(8481),b=n(6543),w=n(8564),y=n(4569),C=n(107),k=n(552),S=n(962),x=n(1298),T=n(9019),I=n(2102),z=n(5961),D=n(1333),M=n(8328),R=n(3847),P=n(6146),F=n(5409),Z=n(3795),N=n(9362),A=n(8645),L=e([R]);R=(L.then?(await L)():L)[0];const O=(0,p.forwardRef)((function({children:e,depressed:t,...n},r){return p.createElement(a.z,{variant:"light",compact:!0,h:"2.5rem",...n,ref:r,styles:e=>({root:{backgroundColor:"dark"===e.colorScheme?e.colors.gray[!0===t?8:9]:e.colors.gray[!0===t?3:1],transform:!0===t?"scale(-1, 1)":"none",color:"dark"===e.colorScheme?e.colors.gray[3]:e.colors.gray[8]}})},e)}));function $(e,t,n){const r=(0,A.uM)(),a=(0,R.vM)(),{mutate:l}=(0,R.n5)(),o=(0,p.useMemo)((()=>{const t=e=>()=>{r.size>0&&e?.()},n=e=>()=>{a({method:e,torrentIds:Array.from(r)},{onError:t=>{console.log("更新执行出错",e,t),P.N9.show({message:"执行出错",color:"red"})}})},o=e=>()=>{l({torrentIds:Array.from(r),fields:{bandwidthPriority:e}},{onSuccess:()=>{P.N9.show({message:"优先级已更新",color:"green"})},onError:e=>{P.N9.show({title:"优先级更新失败",message:String(e),color:"red"})}})};return{start:t(n("torrent-start")),pause:t(n("torrent-stop")),remove:t(e.modals.current?.remove),queueDown:t(n("queue-move-down")),queueUp:t(n("queue-move-up")),move:t(e.modals.current?.move),setLabels:t(e.modals.current?.setLabels),setPriorityHigh:t(o(M.ze.high)),setPriorityNormal:t(o(M.ze.normal)),setPriorityLow:t(o(M.ze.low)),daemonSettings:()=>{e.modals.current?.daemonSettings()}}}),[a,l,e.modals,r]),s=(0,R.Zx)(),i=(0,p.useCallback)((()=>{s.mutate({"alt-speed-enabled":!0!==t},{onError:(e,t)=>{n(!0!==t["alt-speed-enabled"])}}),n(!0!==t)}),[t,s,n]),c=(0,F.QU)();return(0,p.useEffect)((()=>(c.handlers={...c.handlers,...o},()=>{Object.keys(o).forEach((e=>{c.handlers[e]=()=>{}}))})),[c,o]),{...o,toggleAltSpeedMode:i}}function q(e){const t=(0,p.useMemo)((()=>(0,u.Z)(e.setSearchTerms,500,{trailing:!0,leading:!1})),[e.setSearchTerms]),[n,r]=(0,p.useState)();(0,p.useEffect)((()=>{void 0!==e.altSpeedMode&&r(e.altSpeedMode)}),[e.altSpeedMode]);const M=(0,p.useCallback)((e=>{t(e.target.value.split(" ").map((e=>e.trim().toLowerCase())).filter((e=>""!==e)))}),[t]),R=(0,p.useMemo)((()=>{if(e.showTrackerSpeed){let t=0;const n=Object.keys(e.trackers).sort().map((n=>{const r=e.trackers[n];return t+=r.speed,{value:n,label:n+" ("+r.count+") "+`[${(0,N.Iy)(r.speed)}/s]`}}));return[{value:"",label:`<All Trackers> [${(0,N.Iy)(t)}/s]`},...n]}return[{value:"",label:"<All Trackers>"},...Object.keys(e.trackers).sort().map((t=>({value:t,label:t+" ("+e.trackers[t].count+")"})))]}),[e.showTrackerSpeed,e.trackers]),P=(0,p.useCallback)((t=>{""==t?e.setSearchTracker(""):e.setSearchTracker(t)}),[e]),L=(0,p.useRef)(null),q=(0,p.useCallback)((()=>{null!=L.current&&(L.current.value=""),e.setSearchTerms([])}),[e]),U=(0,l.rZ)(),V=$(e,n,r),_=(0,F.QU)();(0,p.useEffect)((()=>(_.handlers.focusSearch=()=>L.current?.focus(),()=>{_.handlers.focusSearch=()=>{}})),[_]),(0,Z.A)([["mod + P",e.toggleMainSplit],["mod + O",e.toggleFiltersPanel],["mod + I",e.toggleDetailsPanel],["mod + R",e.toggleShowRunStatus]]);const j=(0,A.uM)(),W=(0,p.useMemo)((()=>j?.size>0),[j]);return p.createElement(o.k,{w:"100%",align:"stretch"},p.createElement(a.z.Group,{mx:"sm"},p.createElement(O,{title:"添加种子文件",onClick:()=>{e.modals.current?.addTorrent()}},p.createElement(f.Z,{size:"1.5rem",color:U.colors.green[8]})),p.createElement(O,{title:"添加种子链接",onClick:()=>{e.modals.current?.addMagnet()}},p.createElement(h.Z,{size:"1.5rem",color:U.colors.green[8]}))),p.createElement(a.z.Group,{mx:"sm"},p.createElement(O,{title:"开始 (F3)",disabled:!W,onClick:V.start},p.createElement(E.Z,{size:"1.5rem",color:W?U.colors.blue[6]:U.colors.gray[5]})),p.createElement(O,{title:"暂停 (F4)",disabled:!W,onClick:V.pause},p.createElement(g.Z,{size:"1.5rem",color:W?U.colors.blue[6]:U.colors.gray[5]})),p.createElement(O,{title:"删除 (del)",disabled:!W,onClick:V.remove},p.createElement(v.Z,{size:"1.5rem",color:W?U.colors.red[6]:U.colors.gray[5]}))),p.createElement(a.z.Group,{mx:"sm"},p.createElement(O,{title:"队列上移",disabled:!W,onClick:V.queueUp},p.createElement(b.Z,{size:"1.5rem",color:W?U.colors.green[8]:U.colors.gray[5]})),p.createElement(O,{title:"队列下移",onClick:V.queueDown},p.createElement(w.Z,{size:"1.5rem",color:W?U.colors.green[8]:U.colors.gray[5]}))),p.createElement(a.z.Group,{mx:"sm"},p.createElement(O,{title:"修改目录 (F6)",disabled:!W,onClick:V.move},p.createElement(y.Z,{size:"1.5rem",color:W?U.colors.yellow[4]:U.colors.gray[5],stroke:W?U.colors.yellow[5]:U.colors.gray[5]})),p.createElement(O,{title:"设置用户标签 (F7)",disabled:!W,onClick:V.setLabels},p.createElement(C.Z,{size:"1.5rem",color:W?U.colors.blue[6]:U.colors.gray[5]})),p.createElement(s.v,{shadow:"md",width:"10rem",withinPortal:!0,middlewares:{shift:!0,flip:!1}},p.createElement(s.v.Target,null,p.createElement(O,{title:"调整优先级",disabled:!W},p.createElement(D.Z,{width:"1.5rem",height:"1.5rem",fill:W?U.colors.yellow["dark"===U.colorScheme?4:6]:U.colors.gray[5]}))),p.createElement(s.v.Dropdown,null,p.createElement(s.v.Item,{icon:p.createElement(k.Z,{color:U.colors.orange[7]}),onClick:V.setPriorityHigh,rightSection:p.createElement(i.T,null,`${(0,N.Qh)()} H`)},"高"),p.createElement(s.v.Item,{icon:p.createElement(k.Z,{color:U.colors.teal[9]}),onClick:V.setPriorityNormal,rightSection:p.createElement(i.T,null,`${(0,N.Qh)()} N`)},"正常"),p.createElement(s.v.Item,{icon:p.createElement(k.Z,{color:U.colors.yellow[6]}),onClick:V.setPriorityLow,rightSection:p.createElement(i.T,null,`${(0,N.Qh)()} L`)},"低")))),p.createElement(O,{title:`开启备用带宽限速 ${!0===n?"off":"on"} (F8)`,onClick:V.toggleAltSpeedMode,depressed:n},p.createElement(S.Z,{size:"1.5rem"})),p.createElement(c.o,{mx:"sm",ref:L,icon:p.createElement(x.Z,{size:"1rem"}),placeholder:`搜索种子 (${(0,N.Qh)()} + f)`,rightSection:p.createElement(m.A,{onClick:q,title:"Clear"},p.createElement(T.Z,{size:"1rem",color:U.colors.red[6]})),onInput:M,styles:{root:{flexGrow:1},input:{height:"auto"}}}),p.createElement(d.p,{w:"auto",miw:e.showTrackerSpeed?"25rem":"20rem",data:R,value:e.searchTracker,onChange:e=>{P(e.currentTarget.value)}}),p.createElement(s.v,{shadow:"md",width:"16rem",withinPortal:!0,middlewares:{shift:!0,flip:!0}},p.createElement(s.v.Target,null,p.createElement(O,{title:"布局"},p.createElement(I.Z,{size:"1.5rem",style:{transform:"rotate(-90deg)"}}))),p.createElement(s.v.Dropdown,null,p.createElement(s.v.Item,{onClick:e.toggleMainSplit,rightSection:p.createElement(i.T,null,`${(0,N.Qh)()} P`)},"切换布局"),p.createElement(s.v.Item,{onClick:e.toggleFiltersPanel,rightSection:p.createElement(i.T,null,`${(0,N.Qh)()} O`)},"隐藏/展示分组"),p.createElement(s.v.Item,{onClick:e.toggleDetailsPanel,rightSection:p.createElement(i.T,null,`${(0,N.Qh)()} I`)},"隐藏/展示详情"),p.createElement(s.v.Item,{onClick:e.toggleShowRunStatus,rightSection:p.createElement(i.T,null,`${(0,N.Qh)()} R`)},"隐藏/展示运行状态"))),p.createElement(O,{title:"设置 (F9)",onClick:V.daemonSettings},p.createElement(z.Z,{size:"1.5rem"})))}const U=(0,p.memo)(q);r()}catch(V){r(V)}}))},3847:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{Eh:()=>f,Pd:()=>S,Re:()=>z,Vt:()=>x,XE:()=>F,YI:()=>I,ZC:()=>P,Zx:()=>R,cO:()=>v,f$:()=>N,if:()=>b,ir:()=>Z,kP:()=>D,n5:()=>y,qL:()=>C,tY:()=>M,vM:()=>T,xS:()=>A});var a=n(8601),l=n(9451),o=n(4469),s=n(8913),i=n(7294),c=n(2969),m=n(8645),d=e([s]);s=(d.then?(await d)():d)[0];const{TAURI:u,appWindow:p}=await Promise.resolve().then(n.bind(n,4637)),f=new a.S,h={all:e=>[e,"torrent"],listAll:(e,t)=>[...h.all(e),"list",{fields:t}],details:(e,t)=>[...h.all(e),{torrentId:t}]},E={all:e=>[e,"session"],full:e=>[...E.all(e),"full"]},g={all:e=>[e,"sessionStats"]};function v(e,t){const n=(0,i.useContext)(s.Dk),r=(0,c.CG)(),[a,o]=(0,i.useState)(!1);(0,i.useEffect)((()=>{if(u){const e=p.listen("window-hidden",(()=>{o(!0)})),t=p.listen("window-shown",(()=>{o(!1)}));return()=>{e.then((e=>{e()})).catch((()=>{})),t.then((e=>{e()})).catch((()=>{}))}}{const e=()=>{o("hidden"===document.visibilityState)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}}),[]);const d=1e3*(a?n.intervals.torrentsMinimized:n.intervals.torrents);return(0,l.a)({queryKey:h.listAll(n.name,t),refetchInterval:d,refetchIntervalInBackground:!0,staleTime:1e3,enabled:e,queryFn:(0,i.useCallback)((async()=>{const e=await r.getTorrents(t);return await Promise.all(e.map((async e=>await(0,m.Of)(e,!1,r))))}),[r,t])})}function b(e,t,n,r){const a=(0,i.useContext)(s.Dk),o=(0,c.CG)();return(0,l.a)({queryKey:h.details(a.name,e),refetchInterval:!0!==r&&1e3*a.intervals.details,staleTime:5e3,enabled:t,queryFn:(0,i.useCallback)((async()=>await(0,m.Of)(await o.getTorrentDetails(e),u&&n,o)),[o,e,n])})}function w(e,t,n){f.setQueriesData({predicate:t=>{const n=t.queryKey;return 4===n.length&&n[0]===e&&"torrent"===n[1]&&"list"===n[2]}},(e=>{if(void 0!==e)return e.map((e=>t.includes(e.id)?{...e,...n}:e))})),f.setQueriesData({type:"active",predicate:n=>{const r=n.queryKey;return 3===r.length&&r[0]===e&&"torrent"===r[1]&&t.includes(r[2].torrentId)}},(e=>void 0===e?void 0:{...e,...n}))}function y(){const e=(0,i.useContext)(s.Dk),t=(0,c.CG)();return(0,o.D)({mutationFn:async({torrentIds:e,fields:n})=>{await t.setTorrents(e,n)},onSuccess:(t,{torrentIds:n,fields:r})=>{w(e.name,n,r),f.invalidateQueries(h.all(e.name))}})}function C(){const e=(0,i.useContext)(s.Dk),t=(0,c.CG)();return(0,o.D)({mutationFn:async({torrentId:e,path:n,name:r})=>{await t.torrentRenamePath(e,n,r)},onSuccess:(t,{torrentId:n,path:r,name:a})=>{r.includes("/")?f.invalidateQueries(h.details(e.name,n)):(w(e.name,[n],{name:a}),f.invalidateQueries(h.all(e.name)))}})}function k(e){const t=(0,i.useContext)(s.Dk);return(0,o.D)({mutationFn:e,onSuccess:()=>{f.invalidateQueries(h.all(t.name))}}).mutate}function S(e,t){const n=(0,i.useContext)(s.Dk),r=(0,c.CG)();return(0,o.D)({mutationFn:async e=>await r.torrentAdd(e),onSuccess:(t,r)=>{e(t,r),f.invalidateQueries(h.all(n.name))},onError:t})}function x(){const e=(0,c.CG)();return k((async({torrentIds:t,deleteData:n})=>{await e.torrentRemove(t,n)}))}function T(){const e=(0,c.CG)();return k((async({method:t,torrentIds:n})=>{await e.torrentAction(t,n)}))}function I(){const e=(0,c.CG)();return k((async({torrentIds:t,location:n,move:r})=>{await e.torrentMove(t,n,r)}))}function z(){const e=(0,c.CG)();return k((async({torrentId:t,trackers:n})=>{await e.addTrackers(t,n)}))}function D(e){const t=(0,i.useContext)(s.Dk),n=(0,c.CG)();return(0,l.a)({queryKey:E.all(t.name),refetchInterval:1e3*t.intervals.session,staleTime:6e4,enabled:e,queryFn:(0,i.useCallback)((async()=>await n.getSession()),[n])})}function M(e){const t=(0,i.useContext)(s.Dk),n=(0,c.CG)();return(0,l.a)({queryKey:E.full(t.name),staleTime:6e4,enabled:e,queryFn:(0,i.useCallback)((async()=>await n.getSessionFull()),[n])})}function R(){const e=(0,i.useContext)(s.Dk),t=(0,c.CG)();return(0,o.D)({mutationFn:async e=>{await t.setSession(e)},onSuccess:()=>{f.invalidateQueries(E.all(e.name))}})}function P(e){const t=(0,i.useContext)(s.Dk),n=(0,c.CG)();return(0,l.a)({queryKey:g.all(t.name),refetchInterval:1e3*t.intervals.session,staleTime:6e4,enabled:e,queryFn:(0,i.useCallback)((async()=>await n.getSessionStats()),[n])})}function F(e){const t=(0,i.useContext)(s.Dk),n=(0,c.CG)();return(0,l.a)({queryKey:[t.name,"test-port"],staleTime:1,enabled:e,queryFn:(0,i.useCallback)((async()=>await n.testPort()),[n])})}function Z(){const e=(0,i.useContext)(s.Dk),t=(0,c.CG)();return(0,o.D)({mutationFn:async()=>await t.updateBlocklist(),onSuccess:()=>{f.refetchQueries(E.full(e.name))}})}function N(e,t){const n=(0,i.useContext)(s.E_),r=(0,i.useMemo)((()=>t.getView(n.values.interface.flatFileTree)),[t,n]);return(0,l.a)({queryKey:[e],initialData:r,staleTime:1/0,refetchOnWindowFocus:!1,queryFn:()=>t.getView(n.values.interface.flatFileTree)})}function A(e){f.refetchQueries({queryKey:[e]})}r()}catch(L){r(L)}}),1)},2969:(e,t,n)=>{n.d(t,{CG:()=>p,RY:()=>u,Xm:()=>d});var r=n(8764),a=n(8328),l=n(7294),o=n(8561),s=n(9362);const i="http://127.0.0.1:44321";class c extends Error{}function m(e){return"result"in e&&"string"==typeof e.result}class d{url;hostname;headers;timeout;sessionInfo;ipsBatcher;constructor(e,t,n,a=15){if(this.url=encodeURIComponent(e.url),this.headers={"Content-Type":"application/json"},t&&(this.headers["X-TrguiNG-toast"]="true"),n&&(this.headers["X-TrguiNG-sound"]="true"),""===e.url){const e=new URL(document.documentURI);""===e.username&&""===e.password||(window.location.href=window.location.protocol+"//"+window.location.host)}if(""!==e.username||""!==e.password){const t="Basic "+r.lW.from(e.username+":"+e.password,"utf-8").toString("base64");this.headers.Authorization=t}this.timeout=a,this.sessionInfo={},this.hostname="unknown";try{this.hostname=""===e.url?window.location.host:new URL(e.url).hostname}catch{}this.ipsBatcher=(0,o.Ue)({fetcher:async e=>await this.lookupIps(e),resolver:(0,o.rp)("ip")})}getHeader(e,t){for(const n in e)if(t.toLowerCase()===n.toLowerCase())return e[n];return null}async _sendRpc(e){const t=""===this.url?"../rpc":`${i}/${"torrent-get"===e.method?"torrentget":"post"}?url=${this.url}`,n=JSON.stringify(e);let r=await fetch(t,{method:"POST",redirect:"manual",headers:this.headers,body:n});if(409===r.status){const e=r.headers.get("X-Transmission-Session-Id");if(null==e)throw new c("Got 409 response without session id header");this.headers["X-Transmission-Session-Id"]=e,r=await fetch(t,{method:"POST",redirect:"manual",headers:this.headers,body:n})}if(r.ok){const e=await r.json();if("success"!==e.result)throw console.log("Full response with error:",e),new c(e.result);return e}throw"opaqueredirect"===r.type?new Error("Server makes a redirect"):"error"===r.type?new Error("Network error"):(console.log(r),new Error(`Server returned error: ${r.status} (${r.statusText})`))}async getTorrents(e){const t={method:"torrent-get",arguments:{fields:e}},n=await this._sendRpc(t);if(!m(n))throw new c("torrent-get response is not torrents");return n.arguments.torrents}async getTorrentDetails(e){const t={method:"torrent-get",arguments:{fields:a.ED,ids:[e]}},n=await this._sendRpc(t);if(!m(n))throw new c("torrent-get response is not torrents");const r=n.arguments.torrents.find((t=>t.id===e));if(void 0===r)throw new c(`Torrent with id ${e} was not found`);return r}async _getSession(e){const t={method:"session-get",arguments:{fields:e}},n=await this._sendRpc(t);if(!m(n))throw new c("session-get response is not a session");return n.arguments}async getSession(){const e=void 0===this.sessionInfo["rpc-version"]?a.y9:a.pX,t=await this._getSession(e);return this.sessionInfo={...this.sessionInfo,...t},this.sessionInfo}async getSessionFull(){const e=await this._getSession(a.y9);return this.sessionInfo=e,this.sessionInfo}async setSession(e){const t={method:"session-set",arguments:e};await this._sendRpc(t)}async getSessionStats(){return(await this._sendRpc({method:"session-stats"})).arguments}async setTorrents(e,t){const n={method:"torrent-set",arguments:{...t,ids:e}};await this._sendRpc(n)}async torrentAction(e,t){const n={method:e,arguments:{ids:t}};await this._sendRpc(n)}async torrentRemove(e,t){const n={method:"torrent-remove",arguments:{ids:e,"delete-local-data":t}};await this._sendRpc(n)}async torrentMove(e,t,n){const r={method:"torrent-set-location",arguments:{ids:e,location:t,move:n}};await this._sendRpc(r)}async torrentRenamePath(e,t,n){const r={method:"torrent-rename-path",arguments:{ids:[e],path:t,name:n}};await this._sendRpc(r)}async torrentAdd(e){const{url:t,unwanted:n,downloadDir:r,...a}=e,l={method:"torrent-add",arguments:{filename:t,"download-dir":""!==r?r:void 0,"files-unwanted":n,...a}};return await this._sendRpc(l)}async testPort(){return await this._sendRpc({method:"port-test"})}async updateBlocklist(){return(await this._sendRpc({method:"blocklist-update"})).arguments["blocklist-size"]}async getBandwidthGroups(){return(await this._sendRpc({method:"group-get"})).arguments.group}async setBandwidthGroup(e){const t={method:"group-set",arguments:e};return await this._sendRpc(t)}async addTrackers(e,t){const n={method:"torrent-get",arguments:{fields:["trackerList"],ids:[e]}},r=await this._sendRpc(n);if(!m(r))throw new c("torrent-get response is not torrents");const a=r.arguments.torrents;if(!Array.isArray(a)||a.length<1)throw new c("Torrent not found");const l=a[0].trackerList.split("\n\n").map((e=>e.split("\n").filter((e=>""!==e)))),o=t.join("\n").split("\n\n").map((e=>e.split("\n"))),i=(0,s.Tx)(l,o);await this.setTorrents([e],{trackerList:i.map((e=>e.join("\n"))).join("\n\n")})}async lookupIps(e){const t=`${i}/iplookup`,n=JSON.stringify(e),r=await fetch(t,{method:"POST",body:n,headers:{"Content-Type":"application/json"}});if(r.ok)return await r.json();throw console.log(r),new Error(`Server returned error: ${r.status} (${r.statusText})`)}}const u=l.createContext(new d({url:"",username:"",password:""},!1,!1));function p(){return(0,l.useContext)(u)}},1535:(e,t,n)=>{n.d(t,{V:()=>r});class r{ide=!0;title="";content="";constructor(e=!0,t=void 0,n=void 0){this.ide=e,this.title=t,this.content=n}}},4637:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{TAURI:()=>a,appWindow:()=>c,copyToClipboard:()=>E,dialogOpen:()=>d,invoke:()=>m,makeCreateTorrentView:()=>u,readConfigText:()=>f,writeConfigText:()=>h});const a=Object.prototype.hasOwnProperty.call(window,"__TAURI__"),l=a?(await n.e(974).then(n.bind(n,3344))).appWindow:void 0,o=a?(await n.e(974).then(n.bind(n,3344))).WebviewWindow:void 0,s=a?(await n.e(974).then(n.bind(n,4292))).fs:void 0,i=a?(await n.e(974).then(n.bind(n,4292))).clipboard:void 0,c={emit:async(e,t)=>await(l?.emit(e,t)),listen:async(e,t)=>await(l?.listen(e,t))??(()=>{}),once:async(e,t)=>await(l?.once(e,t)),onCloseRequested:async e=>await(l?.onCloseRequested(e)),onFocusChanged:async e=>await(l?.onFocusChanged(e)),onResized:async e=>await(l?.onResized(e)),onMoved:async e=>await(l?.onMoved(e)),setSize:async e=>{if(void 0!==l){const t=(await n.e(974).then(n.bind(n,3344))).PhysicalSize;await l.setSize(new t(...e))}},setPosition:async e=>{if(void 0!==l){const t=(await n.e(974).then(n.bind(n,3344))).PhysicalPosition;await l.setPosition(new t(...e))}},isMinimized:async()=>await(l?.isMinimized())??!1,hide:async()=>await(l?.hide()),show:async()=>await(l?.show()),center:async()=>await(l?.center()),unminimize:async()=>await(l?.unminimize()),setFocus:async()=>await(l?.setFocus()),setTitle:async e=>await(l?.setTitle(e))},m=a?(await n.e(974).then(n.bind(n,4292))).invoke:async(e,t)=>await Promise.reject(new Error("Running outside of tauri app")),d=a?(await n.e(974).then(n.bind(n,8890))).open:async e=>await Promise.reject(new Error("Running outside of tauri app"));async function u(){if(void 0!==o){const e=new o(`createtorrent-${Math.floor(Math.random()*2**30)}`,{url:"createtorrent.html",width:550,height:700,visible:!0,center:!0,maximizable:!1,title:"Create torrent"});await e.once("tauri://error",(e=>{console.log("Webview error",e)}))}}const p="trguing.json";async function f(){return void 0!==s?await s.readTextFile(p,{dir:s.BaseDirectory.Config}):localStorage.getItem("trguing-config")??"{}"}async function h(e){void 0!==s?await s.writeFile({path:p,contents:e},{dir:s.BaseDirectory.Config}):localStorage.setItem("trguing-config",e)}function E(e){if(a)i?.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.log("Can not copy to clipboard.")}document.body.removeChild(t)}}r()}catch(g){r(g)}}),1)},4476:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{H6:()=>u,S9:()=>c,V1:()=>m,g4:()=>d});var a=n(9895),l=n(8913),o=n(7294),s=e([l]);l=(s.then?(await s)():s)[0];const i=o.createContext({value:.9,toggle:e=>{}});function c(e){const t=(0,o.useContext)(l.E_),n=(0,o.useMemo)((()=>{const e=t.values.app.fontSizeBase,n=1e-6,r=10/9;let a=Math.max(t.values.app.fontSize,e/r/r);const l=[];for(;l.length<5&&a<e*r*r+n;)l.push(a),a*=r;for(a=e/r/r;l.length<5&&a<e*r*r+n;)l.push(a),a*=r;return l}),[t]),[r,s]=(0,a.O)(n);return(0,o.useEffect)((()=>{s(t.values.app.fontSize)}),[t,s]),(0,o.useEffect)((()=>{t.values.app.fontSize=r}),[t,r]),o.createElement(i.Provider,{value:{value:r,toggle:s}},e.children)}function m(){return(0,o.useContext)(i)}const d=o.createContext({style:{dark:{},light:{}},setStyle:()=>{}});function u(){return(0,o.useContext)(d)}r()}catch(p){r(p)}}))}}]);